<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Jason Curl" />
  <meta name="dcterms.date" content="2022-02-04" />
  <meta name="keywords" content="Windows, System V ABI, C, Assembly, Intel, x86, x64, x86-64, stdcall, fastcall" />
  <title>System Calling Conventions for Interfacing with Assembly</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">
html {
font-size: 100%;
overflow-y: scroll;
-webkit-text-size-adjust: 100%;
-ms-text-size-adjust: 100%;
}
body {
color: #444;
font-family: Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif;
font-size: 13px;
line-height: 1.7;
padding: 1em;
margin: auto;
max-width: 20cm;
background: #fefefe;
}
a {
color: #0645ad;
text-decoration: none;
}
a:visited {
color: #0b0080;
}
a:hover {
color: #06e;
}
a:active {
color: #faa700;
}
a:focus {
outline: thin dotted;
}
*::-moz-selection {
background: rgba(255, 255, 0, 0.3);
color: #000;
}
*::selection {
background: rgba(255, 255, 0, 0.3);
color: #000;
}
a::-moz-selection {
background: rgba(255, 255, 0, 0.3);
color: #0645ad;
}
a::selection {
background: rgba(255, 255, 0, 0.3);
color: #0645ad;
}
p {
margin: 1em 0;
}
img {
max-width: 100%;
}
h1, h2, h3, h4, h5, h6 {
color: #111;
line-height: 125%;
margin-top: 2em;
font-weight: normal;
}
h4, h5, h6 {
font-weight: bold;
}
h1 {
font-size: 2.5em;
}
h2 {
font-size: 2em;
}
h3 {
font-size: 1.5em;
}
h4 {
font-size: 1.2em;
}
h5 {
font-size: 1em;
}
h6 {
font-size: 0.9em;
}
blockquote {
color: #666666;
margin: 0;
padding-left: 3em;
border-left: 0.5em #EEE solid;
}
hr {
display: block;
height: 2px;
border: 0;
border-top: 1px solid #aaa;
border-bottom: 1px solid #eee;
margin: 1em 0;
padding: 0;
}
pre, code, kbd, samp {
color: #000;
background-color: #eee;
font-family: monospace, monospace;
_font-family: 'courier new', monospace;
font-size: 0.90em;
overflow: visible;
}
pre code {

white-space: pre !important;
white-space: pre-wrap !important; 
white-space: -moz-pre-wrap !important; 
white-space: -pre-wrap !important; 
white-space: -o-pre-wrap !important; 
word-wrap: break-word !important; 
}
pre {
font-size: 0.75em;
}
b, strong {
font-weight: bold;
}
dfn {
font-style: italic;
}
ins {
background: #ff9;
color: #000;
text-decoration: none;
}
mark {
background: #e0a0f0;
color: #000;
font-style: italic;
font-weight: bold;
}
sub, sup {
font-size: 75%;
line-height: 0;
position: relative;
vertical-align: baseline;
}
sup {
top: -0.5em;
}
sub {
bottom: -0.25em;
}
ul, ol {
margin: 1em 0;
padding: 0 0 0 2em;
}
li p:last-child {
margin-bottom: 0;
}
ul ul, ol ol {
margin: .3em 0;
}
dl {
margin-bottom: 1em;
}
dt {
font-weight: bold;
margin-bottom: .8em;
}
dd {
margin: 0 0 .8em 2em;
}
dd:last-child {
margin-bottom: 0;
}
img {
border: 0;
-ms-interpolation-mode: bicubic;
vertical-align: middle;
}
figure {
display: block;
text-align: center;
margin: 1em 0;
}
figure img {
border: none;
margin: 0 auto;
}
figcaption {
font-size: 0.8em;
font-style: italic;
margin: 0 0 .8em;
}
table {
margin-bottom: 2em;
border-bottom: 1px solid #ddd;
border-right: 1px solid #ddd;
border-spacing: 0;
border-collapse: collapse;
font-size: 12px;
}
table th {
padding: .2em 1em;
background-color: #eee;
border-top: 1px solid #ddd;
border-left: 1px solid #ddd;
}
table td {
padding: .2em 1em;
border-top: 1px solid #ddd;
border-left: 1px solid #ddd;
vertical-align: top;
}
.author {
font-size: 1.2em;
text-align: center;
}

@media print {
* {
background: transparent !important;
color: black !important;
filter: none !important;
-ms-filter: none !important;
}
body {
max-width: 100%;
}
a, a:visited {
text-decoration: underline;
}
hr {
height: 1px;
border: 0;
border-bottom: 1px solid black;
}
a[href]:after {
content: " (" attr(href) ")";
}
abbr[title]:after {
content: " (" attr(title) ")";
}
.ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after {
content: "";
}
pre, blockquote {
border: 1px solid #999;
padding-right: 1em;
page-break-inside: avoid;
}
tr, img {
page-break-inside: avoid;
}
img {
max-width: 100% !important;
}
@page :left {
margin: 15mm 20mm 15mm 10mm;
}
@page :right {
margin: 15mm 10mm 15mm 20mm;
}
p, h2, h3 {
orphans: 3;
widows: 3;
}
h2, h3 {
page-break-after: avoid;
}
}</style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">System Calling Conventions for Interfacing with Assembly</h1>
<p class="subtitle">Intel Linux and Windows Calling Conventions</p>
<p class="author">Jason Curl</p>
<p class="date">2022-02-04</p>
</header>
<nav id="TOC">
<ul>
<li><a href="#software-calling-conventions---foreword"><span class="toc-section-number">1</span> Software Calling Conventions - Foreword</a><ul>
<li><a href="#copyright"><span class="toc-section-number">1.1</span> Copyright</a></li>
<li><a href="#revision-history"><span class="toc-section-number">1.2</span> Revision History</a></li>
</ul></li>
<li><a href="#introduction"><span class="toc-section-number">2</span> Introduction</a><ul>
<li><a href="#definitions-acronyms-and-abbreviations"><span class="toc-section-number">2.1</span> Definitions, Acronyms and Abbreviations</a></li>
<li><a href="#typographical-conventions"><span class="toc-section-number">2.2</span> Typographical Conventions</a></li>
</ul></li>
<li><a href="#intel-architecture"><span class="toc-section-number">3</span> Intel Architecture</a><ul>
<li><a href="#intel-architecture-for-32-bit"><span class="toc-section-number">3.1</span> Intel Architecture for 32-bit</a><ul>
<li><a href="#bit-registers"><span class="toc-section-number">3.1.1</span> 32-bit Registers</a></li>
<li><a href="#stack-frames"><span class="toc-section-number">3.1.2</span> Stack Frames</a></li>
</ul></li>
<li><a href="#intel-architecture-for-64-bit"><span class="toc-section-number">3.2</span> Intel Architecture for 64-bit</a><ul>
<li><a href="#bit-registers-1"><span class="toc-section-number">3.2.1</span> 64-bit Registers</a></li>
</ul></li>
<li><a href="#flags"><span class="toc-section-number">3.3</span> Flags</a><ul>
<li><a href="#condition-names"><span class="toc-section-number">3.3.1</span> Condition Names</a></li>
</ul></li>
<li><a href="#word-sizes"><span class="toc-section-number">3.4</span> Word Sizes</a></li>
</ul></li>
<li><a href="#windows---intel-architecture"><span class="toc-section-number">4</span> Windows - Intel Architecture</a><ul>
<li><a href="#stdcall-standard-calling-convention"><span class="toc-section-number">4.1</span> stdcall: Standard Calling Convention</a><ul>
<li><a href="#naming-convention"><span class="toc-section-number">4.1.1</span> Naming Convention</a></li>
<li><a href="#parameter-passing-and-return-values"><span class="toc-section-number">4.1.2</span> Parameter Passing and Return Values</a></li>
<li><a href="#scratch-registers"><span class="toc-section-number">4.1.3</span> Scratch Registers</a></li>
<li><a href="#examples"><span class="toc-section-number">4.1.4</span> Examples</a></li>
</ul></li>
<li><a href="#bit-windows-abi"><span class="toc-section-number">4.2</span> 64-bit Windows ABI</a><ul>
<li><a href="#naming-convention-1"><span class="toc-section-number">4.2.1</span> Naming Convention</a></li>
<li><a href="#parameter-passing-and-return-values-1"><span class="toc-section-number">4.2.2</span> Parameter Passing and Return Values</a></li>
<li><a href="#scratch-registers-1"><span class="toc-section-number">4.2.3</span> Scratch Registers</a></li>
<li><a href="#examples-1"><span class="toc-section-number">4.2.4</span> Examples</a></li>
</ul></li>
</ul></li>
<li><a href="#linux---intel-architecture"><span class="toc-section-number">5</span> Linux - Intel Architecture</a><ul>
<li><a href="#gcc-32-bit-sys-v-abi"><span class="toc-section-number">5.1</span> GCC: 32-bit Sys V ABI</a><ul>
<li><a href="#naming-convention-2"><span class="toc-section-number">5.1.1</span> Naming Convention</a></li>
<li><a href="#parameter-passing-and-return-values-2"><span class="toc-section-number">5.1.2</span> Parameter Passing and Return Values</a></li>
<li><a href="#scratch-registers-2"><span class="toc-section-number">5.1.3</span> Scratch Registers</a></li>
<li><a href="#examples-2"><span class="toc-section-number">5.1.4</span> Examples</a></li>
</ul></li>
<li><a href="#gcc-64-bit-9.3.0-ubuntu-20.04"><span class="toc-section-number">5.2</span> GCC: 64-bit 9.3.0 Ubuntu 20.04</a><ul>
<li><a href="#naming-convention-3"><span class="toc-section-number">5.2.1</span> Naming Convention</a></li>
<li><a href="#register-usage"><span class="toc-section-number">5.2.2</span> Register Usage</a></li>
<li><a href="#stack-alignment"><span class="toc-section-number">5.2.3</span> Stack Alignment</a></li>
<li><a href="#the-stack-red-zone"><span class="toc-section-number">5.2.4</span> The Stack Red Zone</a></li>
<li><a href="#parameter-passing"><span class="toc-section-number">5.2.5</span> Parameter Passing</a></li>
<li><a href="#intel-cet-instructions"><span class="toc-section-number">5.2.6</span> Intel CET Instructions</a></li>
<li><a href="#examples-3"><span class="toc-section-number">5.2.7</span> Examples</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<h1 id="software-calling-conventions---foreword"><span class="header-section-number">1</span> Software Calling Conventions - Foreword</h1>
<p>I wrote this document initially in October 2012 using LaTeX. I was motivated by how to implement a calling convention in assembly, so I could write functions in assembly and link with my C libraries. The work was for my <a href="https://github.com/jcurl/RJCP.DLL.CpuId">RJCP.DLL.CpuId</a> project.</p>
<p>Now 10 years have passed, and I’d like to publish my original work. As part of that effort, I wanted to convert it to Markdown format, which has become immensely popular with the usage of <a href="https://github.com/">GitHub</a> and <a href="https://bitbucket.org/product">BitBucket</a> for rendering within the browser. The <a href="https://code.visualstudio.com/">Visual Studio Code</a> editor makes it easy to write markdown with its preview mode and various plugins. Tools such as <a href="https://pandoc.org/">pandoc</a> make great strides in making markdown a publishable format.</p>
<p>By all means, I wouldn’t call it professional, but sufficiently good enough to support myself in my own work.</p>
<p>Since this document was first written, Linux distributions are now generally 64-bit and ARM processors have become more ubiquitous for mainstream use. Work may be extended later to include more information.</p>
<h2 id="copyright"><span class="header-section-number">1.1</span> Copyright</h2>
<p>Copyright (C) 2012 - 2022, Jason Curl</p>
<h2 id="revision-history"><span class="header-section-number">1.2</span> Revision History</h2>
<table>
<thead>
<tr class="header">
<th>Date</th>
<th>Revision</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2012-11-10</td>
<td>First version using LaTeX</td>
</tr>
<tr class="even">
<td>2022-01-30</td>
<td>Converted to Markdown, build with Pandoc</td>
</tr>
</tbody>
</table>
<h1 id="introduction"><span class="header-section-number">2</span> Introduction</h1>
<p>Calling conventions are the rules that allow different software components, written by different software vendors, potentially using different compilers or different languages, to interface with one another.</p>
<p>This paper aims to document by example how very specific calling conventions work. The goal is to provide examples that can be used as a practical reference for developers to explicitly write code to adhere to the calling conventions. There is a lot of information on the Internet but unfortunately, some of the terminology used is not clear (ordering left to right, or right to left), they lack significant details (variable argument lists, structures, floats) or need examples.</p>
<p>The code examples presented are in C. The output is disassembled by various tools, dependent on the system that’s being run. For example, the <code>dumpbin.exe</code> tool is used for Microsoft generated objects. On Unix type systems the tool <code>objdump</code> is used.</p>
<h2 id="definitions-acronyms-and-abbreviations"><span class="header-section-number">2.1</span> Definitions, Acronyms and Abbreviations</h2>
<table>
<colgroup>
<col style="width: 9%"></col>
<col style="width: 90%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Abbreviation</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ABI</td>
<td>Application Binary Interface</td>
</tr>
<tr class="even">
<td>AMD</td>
<td>Advanced Micro Design, Chip manufacturer producing Intel compatible CPUs and owning 64-bit extensions bit Binary Digit</td>
</tr>
<tr class="odd">
<td>callee</td>
<td>Function code that is being called</td>
</tr>
<tr class="even">
<td>caller</td>
<td>Code that calls a function</td>
</tr>
<tr class="odd">
<td>cdecl</td>
<td>C Declaration calling convention</td>
</tr>
<tr class="even">
<td>CPU</td>
<td>Central Processing Unit</td>
</tr>
<tr class="odd">
<td>GHz</td>
<td>Gigahertz, or 1 million cycles per second</td>
</tr>
<tr class="even">
<td>Intel</td>
<td>Microchip and CPU manufacturer</td>
</tr>
<tr class="odd">
<td>MSR</td>
<td>Machine Specific Register</td>
</tr>
<tr class="even">
<td>RAM</td>
<td>Random Access Memory</td>
</tr>
<tr class="odd">
<td>stdcall</td>
<td>Standard Calling Convention</td>
</tr>
<tr class="even">
<td>SVN</td>
<td>Subversion Revision Control System</td>
</tr>
<tr class="odd">
<td>UUID</td>
<td>Universally Unique Identifiers</td>
</tr>
<tr class="even">
<td>x86</td>
<td>Intel 80x86 32-bit compatible instruction set</td>
</tr>
<tr class="odd">
<td>x64</td>
<td>AMD 80x86 64-bit compatible instruction set</td>
</tr>
</tbody>
</table>
<h2 id="typographical-conventions"><span class="header-section-number">2.2</span> Typographical Conventions</h2>
<p>This document is prepared using the Markdown format. Screen information is provided as monospaced text blocks. Default markdown code formatting is used for code syntax highlighting.</p>
<h1 id="intel-architecture"><span class="header-section-number">3</span> Intel Architecture</h1>
<h2 id="intel-architecture-for-32-bit"><span class="header-section-number">3.1</span> Intel Architecture for 32-bit</h2>
<p>A summary of the registers and conventions are given here as a refresher. Readers wanting more information should refer to the documentation by Intel.</p>
<h3 id="bit-registers"><span class="header-section-number">3.1.1</span> 32-bit Registers</h3>
<p>There are 8 general purpose registers for 32-bit Intel processors:</p>
<ul>
<li><code>EAX</code> - Accumulator</li>
<li><code>EBX</code> - Base register; pointer to data in the DS segment</li>
<li><code>ECX</code> - Counter register (for counter, shift and loop operations)</li>
<li><code>EDX</code> - Data register, I/O pointer</li>
<li><code>ESP</code> - Stack Pointer, in the SS segment</li>
<li><code>EBP</code> - Stack frame Base Pointer (also related to the SS segment)</li>
<li><code>ESI</code> - Source Index register for string operations. Pointer to data provided by the DS segment</li>
<li><code>EDI</code> - Destination Index register for string operations. Pointer to data provided by the ES segment.</li>
</ul>
<p>Other important registers are:</p>
<ul>
<li><code>EIP</code> - Instruction Pointer</li>
<li><code>FLAGS</code> - Condition codes</li>
</ul>
<p>The equivalent 16-bit portions of the registers are: <code>AX</code>, <code>BX</code>, <code>CX</code>, <code>DX</code>, <code>SP</code>, <code>BP</code>, <code>SI</code>, <code>DI</code>, and <code>IP</code>. The 8-bit registers are (<code>H</code> high byte; <code>L</code> low byte): <code>AL</code>, <code>AH</code>, <code>BL</code>, <code>BH</code>, <code>CL</code>, <code>CH</code>, <code>DL</code>, <code>DH</code>, <code>SIL</code> and <code>DIL</code>. There is no 8-bit equivalent for <code>SP</code>, <code>BP</code> and <code>IP</code>.</p>
<p>The list of segment registers are:</p>
<ul>
<li><code>CS</code> - Code Segment</li>
<li><code>DS</code> - Data Segment</li>
<li><code>SS</code> - Stack Segment</li>
<li><code>ES</code> - Extra Segment (Data segment)</li>
<li><code>FS</code> - F Segment (Data segment), from 80386 and later</li>
<li><code>GS</code> - G Segment (Data segment), from 80386 and later</li>
</ul>
<p>The 80-bit FPU registers are overlaid with the 64-bit MMX registers</p>
<figure>
<img src="data:image/png;base64,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" alt="IA32 MMX" /><figcaption>IA32 MMX</figcaption>
</figure>
<p>There are also 8 general purpose SSE registers: <code>XMM0</code>, <code>XMM1</code>, <code>XMM2</code>, <code>XMM3</code>, <code>XMM4</code>, <code>XMM5</code>, <code>XMM6</code> and <code>XMM7</code>.</p>
<h3 id="stack-frames"><span class="header-section-number">3.1.2</span> Stack Frames</h3>
<p>There are two implementations of a stack frame seen when disassembling code. One based on the stack pointer (<code>ESP</code>), the other implementation based on the stack frame base pointer (<code>EBP</code>). The offsets in the following figures are relative to the code in the callee.</p>
<h4 id="esp-based-stack-frames"><span class="header-section-number">3.1.2.1</span> ESP Based Stack Frames</h4>
<p>The stack frame described below indicates generally the offsets referenced from the <code>ESP</code> stack pointer. Many compilers (e.g. GCC with the option <code>-fomit-frame-pointers</code>) generate such stack frames as part of their optimisation to reduce code size. Some debuggers however are not able to show stack information for code compiled.</p>
<figure>
<img src="data:image/png;base64,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" alt="ESP Based Stack Frame" /><figcaption>ESP Based Stack Frame</figcaption>
</figure>
<h4 id="ebp-based-stack-frames"><span class="header-section-number">3.1.2.2</span> EBP Based Stack Frames</h4>
<p>The normal practice for unoptimized code generation is to use the <code>EBP</code> register as the stack frame pointer. The callee is generally responsible for preserving the <code>EBP</code> register so it is unchanged on exit. The equivalent stack frame based on <code>EBP</code> is provided below:</p>
<figure>
<img src="data:image/png;base64,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" alt="EBP Based Stack Frame" /><figcaption>EBP Based Stack Frame</figcaption>
</figure>
<p>The callee usually has the following prologue:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">  10001000:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="fu">  10001001:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a></code></pre></div>
<p>And the epilogue is one of the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">  10001010:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="fu">  10001011:</span>                    <span class="bu">mov</span>         <span class="kw">esp</span>,<span class="kw">ebp</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="fu">  10001013:</span> C2 <span class="dv">08</span> <span class="dv">00</span>           <span class="bu">ret</span>         <span class="dv">8</span></a></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb3-1" title="1"><span class="fu">  10001010:</span> C9                 <span class="bu">leave</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="fu">  10001011:</span> C2 <span class="dv">08</span> <span class="dv">00</span>           <span class="bu">ret</span>         <span class="dv">8</span></a></code></pre></div>
<h2 id="intel-architecture-for-64-bit"><span class="header-section-number">3.2</span> Intel Architecture for 64-bit</h2>
<h3 id="bit-registers-1"><span class="header-section-number">3.2.1</span> 64-bit Registers</h3>
<p>There are considerably more general purpose registers available on 64-bit AMD processors. The general purpose registers are:</p>
<ul>
<li><code>RAX</code>, <code>RBX</code>, <code>RCX</code>, <code>RDX</code> which are 64-bit extensions of the 32-bit <code>EAX</code>, <code>EBX</code>, <code>ECX</code>, <code>EDX</code></li>
<li><code>RBP</code>, <code>RDI</code>, <code>RSI</code> which are 64-bit extensions of the 32-bit <code>EBP</code>, <code>EDI</code>, <code>ESI</code></li>
<li><code>R8</code>, <code>R9</code>, <code>R10</code>, <code>R11</code>, <code>R12</code>, <code>R13</code>, <code>R14</code>, <code>R15</code> are new. 32-bit, 16-bit and 8-bit variants are accessed via <code>RnD</code>, <code>RnW</code>, <code>RnB</code> respectively.</li>
<li><code>RSP</code> which are 64-bit extensions to the 32-bit <code>ESP</code></li>
</ul>
<p>Other important registers are:</p>
<ul>
<li><code>RIP</code> - 64-bit Instruction Pointer</li>
<li><code>FLAGS</code> - Condition codes</li>
</ul>
<p>The list of segment registers remain. They are mostly unused in the 64-bit model. The segment registers <code>FS</code> and <code>GS</code> can have the upper 32-bits set through <code>MSRs</code>.</p>
<ul>
<li><code>CS</code> - Code Segment (ignored)</li>
<li><code>DS</code> - Data Segment (ignored)</li>
<li><code>SS</code> - Stack Segment (ignored)</li>
<li><code>ES</code> - Extra Segment (ignored)</li>
<li><code>FS</code> - F Segment (Data segment)</li>
<li><code>GS</code> - G Segment (Data segment)</li>
</ul>
<p>To quote <a href="http://stackoverflow.com/questions/8284756/ia-32e-64-bit-idt-gate-descriptor">AMD</a>:</p>
<blockquote>
<p>Segmentation is disabled in 64-bit mode, and code segments span all of virtual memory. In this mode, code-segment base addresses are ignored. For the purpose of virtual-address calculations, the base address is treated as if it has a value of zero. Data segments referenced by the <code>FS</code> and <code>GS</code> segment registers receive special treatment in 64-bit mode. For these segments, the base address field is not ignored, and a non-zero value can be used in virtual-address calculations. A 64-bit segment-base address can be specified using model specific registers. Unlike the <code>CS</code>, <code>DS</code>, <code>ES</code>, and <code>SS</code> segments, the <code>FS</code> and <code>GS</code> segment overrides can be used in 64-bit mode. When <code>FS</code> and <code>GS</code> segment overrides are used in 64-bit mode, their respective base addresses are used in the effective-address (EA) calculation. The complete EA calculation then becomes (<code>FS</code> or <code>GS</code>)<code>.base + base + (scale + index) + displacement</code>. The <code>FS.base</code> and <code>GS.base</code> values are also expanded to the full 64-bit virtual-address size. The resulting EA calculation is allowed to wrap across positive and negative addresses.</p>
</blockquote>
<p><a href="http://en.wikipedia.org/wiki/X86_memory_segmentation">Wikipedia</a> has information about the usage of the <code>GS</code> segment register</p>
<blockquote>
<p>Microsoft Windows 64-bit uses the <code>GS</code> segment to point to the Thread Environment Block, a small data structure for each thread, which contains information about exception handling, thread- local variables, and other per-thread state. Similarly, the Linux kernel uses the <code>GS</code> segment to store per-CPU data.</p>
</blockquote>
<p>The MMX registers continue to exist as is for 32-bit. There are in addition 8 new XMM registers: <code>XMM8</code>, <code>XMM9</code>, <code>XMM10</code>, <code>XMM11</code>, <code>XMM12</code>, <code>XMM13</code>, <code>XMM14</code> and <code>XMM15</code>.</p>
<h2 id="flags"><span class="header-section-number">3.3</span> Flags</h2>
<p>The flags register contains the results of various operations. To summarise, the following flags are defined</p>
<table>
<colgroup>
<col style="width: 1%"></col>
<col style="width: 1%"></col>
<col style="width: 97%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Bit</th>
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>CF(S)</td>
<td>Carry Flag: Set if the last arithmetic operation carried (addition) or borrowed (subtraction) a bit beyond the size of the register. This is then checked when the operation is followed with an add-with-carry or subtract-with-borrow to deal with values too large for just one register to contain.</td>
</tr>
<tr class="even">
<td>2</td>
<td>PF(S)</td>
<td>Parity Flag. Set if the number of bits in the least significant byte of the result is a multiple of 2.</td>
</tr>
<tr class="odd">
<td>4</td>
<td>AF(S)</td>
<td>Adjust Flag. Carry of Binary Code Decimal (BCD) numbers arithmetic operations. This is the carry or borrow of bit 3 of the result for BCD arithmetic.</td>
</tr>
<tr class="even">
<td>6</td>
<td>ZF(S)</td>
<td>Zero Flag. Set if the result of an operation is Zero (0).</td>
</tr>
<tr class="odd">
<td>7</td>
<td>SF(S)</td>
<td>Sign Flag. Set if the result of an operation is negative.</td>
</tr>
<tr class="even">
<td>8</td>
<td>TF(X)</td>
<td>Trap Flag. Set if step by step debugging.</td>
</tr>
<tr class="odd">
<td>9</td>
<td>IF(X)</td>
<td>Interruption Flag. Set if interrupts are enabled.</td>
</tr>
<tr class="even">
<td>10</td>
<td>DF(C)</td>
<td>Direction Flag. Stream direction. If set, string operations will decrement their pointer rather than incrementing it, reading memory backwards.Setting the DF flag causes the string instructions to auto-decrement (to process strings from high addresses to low addresses). Clearing the DF flag causes the string instructions to auto-increment (process strings from low addresses to high addresses). The STD and CLD instructions set and clear the DF flag, respectively.</td>
</tr>
<tr class="odd">
<td>11</td>
<td>OF(S)</td>
<td>Overflow Flag. Set if signed arithmetic operations result in a value too large for the register to contain.</td>
</tr>
<tr class="even">
<td>12, 13</td>
<td>IOPL(X)</td>
<td>I/O Privilege Level field (2 bits). I/O Privilege Level of the current process.</td>
</tr>
<tr class="odd">
<td>14</td>
<td>NT(X)</td>
<td>Nested Task flag. Controls chaining of interrupts. Set if the current process is linked to the next process.</td>
</tr>
<tr class="even">
<td>16</td>
<td>RF(X)</td>
<td>Resume Flag. Response to debug exceptions</td>
</tr>
<tr class="odd">
<td>17</td>
<td>VM(X)</td>
<td>Virtual-8086 Mode. Set if in 8086 compatibility mode.</td>
</tr>
<tr class="even">
<td>18</td>
<td>AC(X)</td>
<td>Alignment Check. Set if alignment checking of memory references is done.</td>
</tr>
<tr class="odd">
<td>19</td>
<td>VIF(X)</td>
<td>Virtual Interrupt Flag. Virtual image of IF.</td>
</tr>
<tr class="even">
<td>20</td>
<td>VIP(X)</td>
<td>Virtual Interrupt Pending flag. Set if an interrupt is pending.</td>
</tr>
<tr class="odd">
<td>21</td>
<td>ID(X)</td>
<td>Identification Flag. Support for CPUID instruction if can be set.</td>
</tr>
</tbody>
</table>
<p>where:</p>
<ul>
<li>S is a Status Flag</li>
<li>C is a Control Flag</li>
<li>X is a System Flag</li>
</ul>
<h3 id="condition-names"><span class="header-section-number">3.3.1</span> Condition Names</h3>
<p>Condition names are those used in instructions for testing and jumping. The conditions are based on the <code>FLAGS</code> register described in the table above.</p>
<table>
<colgroup>
<col style="width: 7%"></col>
<col style="width: 3%"></col>
<col style="width: 88%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Condition</th>
<th>Flags</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Z</td>
<td>ZF=1</td>
<td>Result of last operation was zero</td>
</tr>
<tr class="even">
<td>NZ</td>
<td>ZF=0</td>
<td>Result of last operation was not zero</td>
</tr>
<tr class="odd">
<td>C</td>
<td>CF=1</td>
<td>Last operation required a carry or borrow. For unsigned integers, this indicates an overflow</td>
</tr>
<tr class="even">
<td>NC</td>
<td>CF=0</td>
<td>Last operation did not require a carry or borrow. For unsigned integers, this indicates that no overflow occurred</td>
</tr>
<tr class="odd">
<td>S</td>
<td>SF=1</td>
<td>Result of last operation has its high bit set.</td>
</tr>
<tr class="even">
<td>NS</td>
<td>SF=0</td>
<td>Result of last operation has its high bit clear.</td>
</tr>
<tr class="odd">
<td>O</td>
<td>OF=1</td>
<td>When treated as a signed integer operation, the last operation caused an overflow or underflow.</td>
</tr>
<tr class="even">
<td>NO</td>
<td>OF=0</td>
<td>When treated as signed integer operation, the last operation did not cause an overflow or underflow.</td>
</tr>
</tbody>
</table>
<p>The following conditions are to be interpreted after a <code>CMP</code> operation.</p>
<table>
<thead>
<tr class="header">
<th>Condition</th>
<th>Flags</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>E</td>
<td>ZF=1</td>
<td>Equal. value1 == value2.</td>
</tr>
<tr class="even">
<td>NE</td>
<td>ZF=0</td>
<td>Not Equal. value1 != value2.</td>
</tr>
<tr class="odd">
<td>GE / NL</td>
<td>SF=OF</td>
<td>Greater or Equal / Not Lower. value1 &gt;= value2.</td>
</tr>
<tr class="even">
<td>LE / NG</td>
<td>ZF=1 or SF!=OF</td>
<td>Less or Equal / Not Greater. value1 &lt;= value2.</td>
</tr>
<tr class="odd">
<td>G / NLE</td>
<td>ZF=0 and SF=OF</td>
<td>Greater / Not Lower or Equal. value1 &gt; value2.</td>
</tr>
<tr class="even">
<td>L / NGE</td>
<td>SF!=OF</td>
<td>Lower / Not Greater or Equal. value1 &lt; value2.</td>
</tr>
<tr class="odd">
<td>AE / NB</td>
<td>CF=0</td>
<td>Above or Equal, Not Below. value1 &gt;= value2.</td>
</tr>
<tr class="even">
<td>BE / NA</td>
<td>CF=1 or ZF=1</td>
<td>Below or Equal / Not Above. value1 &lt;= value2.</td>
</tr>
<tr class="odd">
<td>A / NBE</td>
<td>CF=0 and ZF=0</td>
<td>Above / Not Below or Equal. value1 &gt; value2.</td>
</tr>
<tr class="even">
<td>B / NAE</td>
<td>CF=1</td>
<td>Below / Not Above or Equal. value1 &lt; value2</td>
</tr>
</tbody>
</table>
<h2 id="word-sizes"><span class="header-section-number">3.4</span> Word Sizes</h2>
<p>The following word sizes are used in this document, especially when describing stack frames.</p>
<table>
<thead>
<tr class="header">
<th>Mnemonic</th>
<th>Size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>word</code></td>
<td>2 bytes</td>
</tr>
<tr class="even">
<td><code>dword</code></td>
<td>4 bytes (double word)</td>
</tr>
<tr class="odd">
<td><code>qword</code></td>
<td>8 bytes (quad word)</td>
</tr>
<tr class="even">
<td><code>oword</code></td>
<td>16 bytes (octal word)</td>
</tr>
<tr class="odd">
<td><code>yword</code></td>
<td>32 bytes (y word)</td>
</tr>
<tr class="even">
<td><code>zword</code></td>
<td>64 bytes (z word)</td>
</tr>
</tbody>
</table>
<h1 id="windows---intel-architecture"><span class="header-section-number">4</span> Windows - Intel Architecture</h1>
<p>In this part, we cover various used calling conventions used on Windows computers, particularly the Intel architecture (both 32-bit and 64-bit). Information is based on Visual Studio compilers.</p>
<p>The examples provided here are compiled using the Microsoft Visual Studio 2012 compilers using default settings (which provide generally for SSE2 type instructions). In some cases, the compiler has been configured to produce standard code with the <code>/arch:ia32</code> option.</p>
<h2 id="stdcall-standard-calling-convention"><span class="header-section-number">4.1</span> stdcall: Standard Calling Convention</h2>
<p>The <code>stdcall</code> calling convention is that which is specified for Windows DLLs through the <code>WINAPI</code> macro. the standard calling convention doesn’t support variable argument lists.</p>
<p>Examples provided here are generated using Microsoft Visual Studio 2012. Default settings are used for compiling the code. In some cases, a specific machine architecture is provided to disable SSE instructions (with the <code>/arch:ia32</code> option). Dumping of the object code in assembly is done using the Microsoft tool <code>dumpbin.exe</code>.</p>
<p>This tool shows code in the Microsoft Macro Assembler format (so that code is shown in the Intel syntax).</p>
<pre class="text"><code>&gt; set MSVC=C:\Program Files\Microsoft Visual Studio 11.0
&gt; set PATH=%MSVC%\Common7\IDE;%MSVC%\VC\bin;%PATH%
&gt; dumpbin test.exe /disasm /out:test.asm</code></pre>
<h3 id="naming-convention"><span class="header-section-number">4.1.1</span> Naming Convention</h3>
<p>Functions exported for linking are prefixed with an underscore (<code>_</code>), followed by an at symbol (<code>@</code>) and the number of bytes the parameter list uses on the stack (in decimal). The following sections will have various examples on the naming convention. Listed below are some examples to illustrate the point:</p>
<ul>
<li><p>Three integers in parameter list</p>
<p><code>int myfunc(int a, int b, int c);</code></p>
<p>→ <code>_myfunc@12</code></p></li>
<li><p>An empty parameter list</p>
<p><code>void myfuncv();</code></p>
<p>→ <code>_myfuncv@0</code></p></li>
<li><p>Struct return by value</p>
<p><code>struct mystruct myfuncs();</code></p>
<p>→ <code>_myfuncs@0</code></p>
<p><code>struct mystruct myfuncs(int x, int y);</code></p>
<p>→ <code>_myfuncs@8</code></p></li>
<li><p>Doubles</p>
<p><code>double myfuncs(double a, double b);</code></p>
<p>→ <code>_myfuncs@16</code></p></li>
</ul>
<p>Windows compilers can be told to ignore the naming conventions, providing symbols that are named directly after the function without being decorated with parameter information. This is often useful for platform interoperability.</p>
<h3 id="parameter-passing-and-return-values"><span class="header-section-number">4.1.2</span> Parameter Passing and Return Values</h3>
<p>Arguments are passed on the main stack (given by the register <code>ESP</code>):</p>
<ul>
<li>order is from right to left. That is, push the far right argument on the stack first, the first argument is then pushed last;</li>
<li>floating point variables (double and float) are also pushed on the main stack given by <code>ESP</code> (not the FPU stack);
<ul>
<li>floats are 4 bytes, doubles are 8 bytes</li>
</ul></li>
<li>variable number of arguments (varargs) are not supported by the stdcall calling convention;
<ul>
<li>This is because the callee must clean up the stack.</li>
</ul></li>
</ul>
<p>Return values (8 bytes or less) are given on exit in registers:</p>
<ul>
<li>32-bit integers are returned in the register <code>EAX</code>;</li>
<li>64-bit values are returned by <code>EDX:EAX</code> (e.g. like the result of the x86 <code>imul</code> instruction, where the lower 32-bits are in EAX and the upper 32-bits are in <code>EDX</code>);</li>
<li><code>float</code>s and <code>double</code>s are returned on the FPU stack (<code>ST(0)</code>).</li>
</ul>
<p>Cleaning up the stack is done by the callee.</p>
<ul>
<li>This is typically done with the <code>ret</code> instruction which has an optional parameter to determine how many bytes to pop from the stack before returning. For example, if 24 bytes are pushed on the stack, then typically compilers produce <code>ret 24</code> and the end of the callee.</li>
<li>Values returned on the stack are covered next</li>
</ul>
<p>Returning structs by value that are greater than 64-bits are handled in a special manner and deserve explicit attention:</p>
<ul>
<li><p>The caller allocates space for the struct that is returned by value.</p>
<p>This may look a little strange, when comparing how C programs are written, where the callee normally has code that would appear to allocate stack space instead.</p></li>
<li>The caller then passes a pointer to the struct on the stack last, as if it were the first parameter.</li>
<li>On return, EAX contains the pointer to the struct given in the first parameter.</li>
<li>The callee is responsible for popping the pointer to the struct in addition.</li>
<li><p>The function signature contains the number of bytes excluding the pointer to the struct, as seen here</p>
<p><code>struct mystruct myfuncs(int x, int y);</code></p>
<p>→ <code>_myfuncs@8</code></p>
<p>So even though 12 bytes should be pushed on the stack (plus space should be allocated for the struct value in addition), the function signature shows only 8 bytes. The function still removes 12 bytes from the stack on returning with a <code>ret 12</code> instruction.</p></li>
</ul>
<h3 id="scratch-registers"><span class="header-section-number">4.1.3</span> Scratch Registers</h3>
<p>The following registers are considered scratch registers, the callee does not need to preserve them on exit. The caller should preserve these registers in case they’re needed on return.</p>
<ul>
<li><code>EAX</code> - Return value for integers (lower 32-bits)</li>
<li><code>EDX</code> - Return value for 64-bit integers, otherwise don’t care</li>
<li><code>ECX</code></li>
</ul>
<p>All other registers must be preserved by the callee: <code>EBP</code>, <code>EBX</code>, <code>EDI</code>, <code>ESI</code>. Registers <code>EIP</code> and <code>ESP</code> need to be preserved as described earlier.</p>
<h3 id="examples"><span class="header-section-number">4.1.4</span> Examples</h3>
<h4 id="two-integers"><span class="header-section-number">4.1.4.1</span> Two Integers</h4>
<p>The callee accepts two 4-byte (signed) integers. The caller is the function <code>DllMain</code>. The callee takes the parameters, adds a fixed value and multiplies them, so it’s visible in code which parameter is being referenced.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb5-1" title="1">CALLINGCONVENTION_API <span class="dt">int</span> __stdcall fnCallingConvention(<span class="dt">int</span> a, <span class="dt">int</span> b)</a>
<a class="sourceLine" id="cb5-2" title="2">{</a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="cf">return</span> (a+<span class="dv">1</span>) * (b+<span class="dv">2</span>);</a>
<a class="sourceLine" id="cb5-4" title="4">}</a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6">BOOL APIENTRY DllMain(HMODULE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved)</a>
<a class="sourceLine" id="cb5-7" title="7">{</a>
<a class="sourceLine" id="cb5-8" title="8">  fnCallingConvention(<span class="dv">1</span>, <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="cf">return</span> TRUE;</a>
<a class="sourceLine" id="cb5-10" title="10">}</a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb6-1" title="1"><span class="fu">_DllMain@12:</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="fu">  100113B7:</span> 6A <span class="dv">02</span>              <span class="bu">push</span>        <span class="dv">2</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="fu">  100113B9:</span> 6A <span class="dv">01</span>              <span class="bu">push</span>        <span class="dv">1</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="fu">  100113BB:</span> E8 <span class="dv">86</span> FC FF FF     <span class="bu">call</span>        _fnCallingConvention@<span class="dv">8</span></a>
<a class="sourceLine" id="cb6-5" title="5"></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="fu">_fnCallingConvention@8:</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="fu">  10001000:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="fu">  10001001:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="fu">  10001003:</span> 8B <span class="dv">45</span> <span class="dv">08</span>           <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb6-10" title="10"><span class="fu">  10001006:</span> 8B 4D 0C           <span class="bu">mov</span>         <span class="kw">ecx</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+0Ch]</a>
<a class="sourceLine" id="cb6-11" title="11"><span class="fu">  10001009:</span> <span class="dv">40</span>                 <span class="bu">inc</span>         <span class="kw">eax</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="fu">  1000100A:</span> <span class="dv">83</span> C1 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">ecx</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="fu">  1000100D:</span> 0F AF C1           <span class="bu">imul</span>        <span class="kw">eax</span>,<span class="kw">ecx</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="fu">  10001010:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="fu">  10001011:</span> C2 <span class="dv">08</span> <span class="dv">00</span>           <span class="bu">ret</span>         <span class="dv">8</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>Parameters are pushed from right to left (parameter <code>b==2</code> is pushed first, followed by parameter <code>a==1</code>).</li>
<li>Parameter <code>a</code> has an offset of <code>EBP+8</code> in the callee.</li>
<li>Parameter <code>b</code> has an offset of <code>EBP+12</code> in the callee.</li>
<li>The result is stored in <code>EDX:EAX</code>, but the caller will ignore <code>EDX</code>, which leaves the lower 32-bit result in <code>EAX</code>.</li>
<li>8 bytes are pushed on the stack by the caller, 8 bytes are popped by the callee.</li>
</ul>
<p>The stackframe in the callee, based on EBP looks like:</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+12]</code></td>
<td>Parameter <code>b</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+8]</code></td>
<td>Parameter <code>a</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> frame pointer</td>
</tr>
<tr class="odd">
<td><code>xxx ptr [EBP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<h4 id="mixed-floats-and-integers"><span class="header-section-number">4.1.4.2</span> Mixed Floats and Integers</h4>
<p>A mix of floats and integers are passed to the callee, with an integer being returned</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb7-1" title="1">CALLINGCONVENTION_API <span class="dt">int</span> __stdcall fnCallingConvention(<span class="dt">float</span> a, <span class="dt">int</span> b, <span class="dt">float</span> c, <span class="dt">int</span> d)</a>
<a class="sourceLine" id="cb7-2" title="2">{</a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="cf">return</span> (a+<span class="dv">1</span>) * (b+<span class="dv">2</span>) * (c+<span class="dv">3</span>) * (d+<span class="dv">4</span>);</a>
<a class="sourceLine" id="cb7-4" title="4">}</a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6">BOOL APIENTRY DllMain(HMODULE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved)</a>
<a class="sourceLine" id="cb7-7" title="7">{</a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="cf">return</span> fnCallingConvention(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>);</a>
<a class="sourceLine" id="cb7-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb8-1" title="1"><span class="fu">_DllMain@12:</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="fu">  10001050:</span> 6A <span class="dv">04</span>              <span class="bu">push</span>        <span class="dv">4</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="fu">  10001052:</span> <span class="dv">51</span>                 <span class="bu">push</span>        <span class="kw">ecx</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="fu">  10001053:</span> C7 <span class="dv">04</span> <span class="dv">24</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">40</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">esp</span>]<span class="bn">,40400000h</span></a>
<a class="sourceLine" id="cb8-5" title="5">            <span class="dv">40</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="fu">  1000105A:</span> 6A <span class="dv">02</span>              <span class="bu">push</span>        <span class="dv">2</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="fu">  1000105C:</span> <span class="dv">51</span>                 <span class="bu">push</span>        <span class="kw">ecx</span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="fu">  1000105D:</span> C7 <span class="dv">04</span> <span class="dv">24</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">80</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">esp</span>]<span class="bn">,3F800000h</span></a>
<a class="sourceLine" id="cb8-9" title="9">            3F</a>
<a class="sourceLine" id="cb8-10" title="10"><span class="fu">  10001064:</span> E8 <span class="dv">97</span> FF FF FF     <span class="bu">call</span>        _fnCallingConvention@<span class="dv">16</span></a>
<a class="sourceLine" id="cb8-11" title="11"></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="fu">_fnCallingConvention@16:</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="fu">  10001000:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="fu">  10001001:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="fu">  10001003:</span> 8B <span class="dv">45</span> 0C           <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+0Ch]</a>
<a class="sourceLine" id="cb8-16" title="16"><span class="fu">  10001006:</span> F3 0F <span class="dv">10</span> 4D <span class="dv">08</span>     <span class="bu">movss</span>       <span class="kw">xmm1</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb8-17" title="17"><span class="fu">  1000100B:</span> F3 0F <span class="dv">58</span> 0D B8 <span class="dv">20</span>  <span class="bu">addss</span>       <span class="kw">xmm1</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@3f800000]</a>
<a class="sourceLine" id="cb8-18" title="18">            <span class="dv">00</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="fu">  10001013:</span> <span class="dv">83</span> C0 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb8-20" title="20"><span class="fu">  10001016:</span> <span class="dv">66</span> 0F 6E C0        <span class="bu">movd</span>        <span class="kw">xmm0</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb8-21" title="21"><span class="fu">  1000101A:</span> 8B <span class="dv">45</span> <span class="dv">14</span>           <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+14h]</a>
<a class="sourceLine" id="cb8-22" title="22"><span class="fu">  1000101D:</span> 0F 5B C0           <span class="bu">cvtdq2ps</span>    <span class="kw">xmm0</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb8-23" title="23"><span class="fu">  10001020:</span> <span class="dv">83</span> C0 <span class="dv">04</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">4</span></a>
<a class="sourceLine" id="cb8-24" title="24"><span class="fu">  10001023:</span> F3 0F <span class="dv">59</span> C8        <span class="bu">mulss</span>       <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb8-25" title="25"><span class="fu">  10001027:</span> F3 0F <span class="dv">10</span> <span class="dv">45</span> <span class="dv">10</span>     <span class="bu">movss</span>       <span class="kw">xmm0</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+10h]</a>
<a class="sourceLine" id="cb8-26" title="26"><span class="fu">  1000102C:</span> F3 0F <span class="dv">58</span> <span class="dv">05</span> BC <span class="dv">20</span>  <span class="bu">addss</span>       <span class="kw">xmm0</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@<span class="dv">40400000</span>]</a>
<a class="sourceLine" id="cb8-27" title="27">            <span class="dv">00</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb8-28" title="28"><span class="fu">  10001034:</span> F3 0F <span class="dv">59</span> C8        <span class="bu">mulss</span>       <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb8-29" title="29"><span class="fu">  10001038:</span> <span class="dv">66</span> 0F 6E C0        <span class="bu">movd</span>        <span class="kw">xmm0</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb8-30" title="30"><span class="fu">  1000103C:</span> 0F 5B C0           <span class="bu">cvtdq2ps</span>    <span class="kw">xmm0</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb8-31" title="31"><span class="fu">  1000103F:</span> F3 0F <span class="dv">59</span> C8        <span class="bu">mulss</span>       <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb8-32" title="32"><span class="fu">  10001043:</span> F3 0F 2C C1        <span class="bu">cvttss2si</span>   <span class="kw">eax</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb8-33" title="33"><span class="fu">  10001047:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb8-34" title="34"><span class="fu">  10001048:</span> C2 <span class="dv">10</span> <span class="dv">00</span>           <span class="bu">ret</span><span class="bn">         10h</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>Floating point values are pushed on the stack with each taking 4 bytes in the same manner as integers. The compiler pushes the binary representation for the values 1.0 and 3.0. The register <code>ECX</code> is scratch and the instructions <code>push ecx</code> are equivalent to <code>sub esp,4</code> in this case, except the <code>push</code> instruction is faster.</li>
<li>The result is stored in <code>EAX</code> and is an integer</li>
<li>16 bytes are pushed on the stack by the caller, 16 bytes are popped by the callee.</li>
</ul>
<p>The stackframe of the callee, based on <code>EBP</code> looks like:</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+20]</code></td>
<td>Parameter <code>d</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+16]</code></td>
<td>Parameter <code>c</code> (float)</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+12]</code></td>
<td>Parameter <code>b</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+8]</code></td>
<td>Parameter <code>a</code> (float)</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> frame pointer</td>
</tr>
</tbody>
</table>
<h4 id="doubles"><span class="header-section-number">4.1.4.3</span> Doubles</h4>
<p>Doubles take 64-bits of storage. We’ll see that they’re no different to floats. In addition, we’ll see that doubles are returned by the FPU stack.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb9-1" title="1">CALLINGCONVENTION_API <span class="dt">double</span> __stdcall fnCallingConvention(<span class="dt">double</span> x, <span class="dt">double</span> y)</a>
<a class="sourceLine" id="cb9-2" title="2">{</a>
<a class="sourceLine" id="cb9-3" title="3">  <span class="cf">return</span> (x + <span class="dv">1</span>) * (y + <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb9-4" title="4">}</a>
<a class="sourceLine" id="cb9-5" title="5"></a>
<a class="sourceLine" id="cb9-6" title="6">BOOL APIENTRY DllMain(HMODULE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved)</a>
<a class="sourceLine" id="cb9-7" title="7">{</a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="cf">return</span> (<span class="dt">int</span>)fnCallingConvention(<span class="dv">1</span>, <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb9-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb10-1" title="1"><span class="fu">_DllMain@12:</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="fu">  10001030:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="fu">  10001031:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="fu">  10001033:</span> <span class="dv">83</span> EC <span class="dv">08</span>           <span class="bu">sub</span>         <span class="kw">esp</span>,<span class="dv">8</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="fu">  10001036:</span> F2 0F <span class="dv">10</span> <span class="dv">05</span> C0 <span class="dv">20</span>  <span class="bu">movsd</span>       <span class="kw">xmm0</span>,mmword <span class="dt">ptr</span> [__real@<span class="dv">4000000000000000</span>]</a>
<a class="sourceLine" id="cb10-6" title="6">            <span class="dv">00</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="fu">  1000103E:</span> <span class="dv">83</span> EC <span class="dv">10</span>           <span class="bu">sub</span>         <span class="kw">esp</span><span class="bn">,10h</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="fu">  10001041:</span> F2 0F <span class="dv">11</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">08</span>  <span class="bu">movsd</span>       mmword <span class="dt">ptr</span> [<span class="kw">esp</span>+<span class="dv">8</span>],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="fu">  10001047:</span> F2 0F <span class="dv">10</span> <span class="dv">05</span> B8 <span class="dv">20</span>  <span class="bu">movsd</span>       <span class="kw">xmm0</span>,mmword <span class="dt">ptr</span> [__real@3ff0000000000000]</a>
<a class="sourceLine" id="cb10-10" title="10">            <span class="dv">00</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="fu">  1000104F:</span> F2 0F <span class="dv">11</span> <span class="dv">04</span> <span class="dv">24</span>     <span class="bu">movsd</span>       mmword <span class="dt">ptr</span> [<span class="kw">esp</span>],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="fu">  10001054:</span> E8 A7 FF FF FF     <span class="bu">call</span>        _fnCallingConvention@<span class="dv">16</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="fu">  10001059:</span> <span class="dt">DD</span> 5D F8           <span class="bu">fstp</span>        <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span><span class="dv">-8</span>]</a>
<a class="sourceLine" id="cb10-14" title="14"><span class="fu">  1000105C:</span> F2 0F 2C <span class="dv">45</span> F8     <span class="bu">cvttsd2si</span>   <span class="kw">eax</span>,mmword <span class="dt">ptr</span> [<span class="kw">ebp</span><span class="dv">-8</span>]</a>
<a class="sourceLine" id="cb10-15" title="15"><span class="fu">  10001061:</span> 8B E5              <span class="bu">mov</span>         <span class="kw">esp</span>,<span class="kw">ebp</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="fu">  10001063:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="fu">  10001064:</span> C2 0C <span class="dv">00</span>           <span class="bu">ret</span><span class="bn">         0Ch</span></a>
<a class="sourceLine" id="cb10-18" title="18"></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="fu">_fnCallingConvention@16:</span></a>
<a class="sourceLine" id="cb10-20" title="20"><span class="fu">  10001000:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb10-21" title="21"><span class="fu">  10001001:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb10-22" title="22"><span class="fu">  10001003:</span> F2 0F <span class="dv">10</span> 4D <span class="dv">08</span>     <span class="bu">movsd</span>       <span class="kw">xmm1</span>,mmword <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb10-23" title="23"><span class="fu">  10001008:</span> F2 0F <span class="dv">10</span> <span class="dv">45</span> <span class="dv">10</span>     <span class="bu">movsd</span>       <span class="kw">xmm0</span>,mmword <span class="dt">ptr</span> [<span class="kw">ebp</span>+10h]</a>
<a class="sourceLine" id="cb10-24" title="24"><span class="fu">  1000100D:</span> F2 0F <span class="dv">58</span> 0D B8 <span class="dv">20</span>  <span class="bu">addsd</span>       <span class="kw">xmm1</span>,mmword <span class="dt">ptr</span> [__real@3ff0000000000000]</a>
<a class="sourceLine" id="cb10-25" title="25">            <span class="dv">00</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb10-26" title="26"><span class="fu">  10001015:</span> F2 0F <span class="dv">58</span> <span class="dv">05</span> C0 <span class="dv">20</span>  <span class="bu">addsd</span>       <span class="kw">xmm0</span>,mmword <span class="dt">ptr</span> [__real@<span class="dv">4000000000000000</span>]</a>
<a class="sourceLine" id="cb10-27" title="27">            <span class="dv">00</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb10-28" title="28"><span class="fu">  1000101D:</span> F2 0F <span class="dv">59</span> C8        <span class="bu">mulsd</span>       <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb10-29" title="29"><span class="fu">  10001021:</span> F2 0F <span class="dv">11</span> 4D <span class="dv">08</span>     <span class="bu">movsd</span>       mmword <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>],<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb10-30" title="30"><span class="fu">  10001026:</span> <span class="dt">DD</span> <span class="dv">45</span> <span class="dv">08</span>           <span class="bu">fld</span>         <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb10-31" title="31"><span class="fu">  10001029:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb10-32" title="32"><span class="fu">  1000102A:</span> C2 <span class="dv">10</span> <span class="dv">00</span>           <span class="bu">ret</span><span class="bn">         10h</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>Doubles are still pushed on the stack given by <code>ESP</code>, taking 8 bytes each. The caller allocates 16 bytes at instruction 1000103E, moving 8-byte values via SSE instructions into the reserved space with instructions 10001041 and 1000104F.</li>
<li>The return value is given on the FPU stack with the <code>fld</code> instruction</li>
<li>16 bytes are pushed on the stack by the caller for the parameters, 16 bytes are popped by the callee.</li>
</ul>
<p>The stackframe of the callee, based on <code>EBP</code> looks like:</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+16]</code></td>
<td>Parameter <code>b</code> (double, 8 bytes, 4000000000000000)</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+8]</code></td>
<td>Parameter <code>a</code> (double, 8 bytes, 3ff0000000000000)</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> frame pointer</td>
</tr>
<tr class="odd">
<td><code>xxx ptr [EBP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<h4 id="floats"><span class="header-section-number">4.1.4.4</span> Floats</h4>
<p>Floats are handled the same as doubles, except the size of a float is 32-bit.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb11-1" title="1">CALLINGCONVENTION_API <span class="dt">float</span> __stdcall fnCallingConvention(<span class="dt">float</span> x, <span class="dt">float</span> y)</a>
<a class="sourceLine" id="cb11-2" title="2">{</a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="cf">return</span> (x + <span class="dv">1</span>) * (y + <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb11-4" title="4">}</a>
<a class="sourceLine" id="cb11-5" title="5"></a>
<a class="sourceLine" id="cb11-6" title="6">BOOL APIENTRY DllMain(HMODULE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved)</a>
<a class="sourceLine" id="cb11-7" title="7">{</a>
<a class="sourceLine" id="cb11-8" title="8">  <span class="cf">return</span> (<span class="dt">int</span>)fnCallingConvention(<span class="dv">1</span>, <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb11-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb12-1" title="1"><span class="fu">_DllMain@12:</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="fu">  10001030:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="fu">  10001031:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="fu">  10001033:</span> <span class="dv">51</span>                 <span class="bu">push</span>        <span class="kw">ecx</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="fu">  10001034:</span> <span class="dv">83</span> EC <span class="dv">08</span>           <span class="bu">sub</span>         <span class="kw">esp</span>,<span class="dv">8</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="fu">  10001037:</span> C7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">04</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">esp</span>+<span class="dv">4</span>]<span class="bn">,40000000h</span></a>
<a class="sourceLine" id="cb12-7" title="7">            <span class="dv">00</span> <span class="dv">40</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="fu">  1000103F:</span> C7 <span class="dv">04</span> <span class="dv">24</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">80</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">esp</span>]<span class="bn">,3F800000h</span></a>
<a class="sourceLine" id="cb12-9" title="9">            3F</a>
<a class="sourceLine" id="cb12-10" title="10"><span class="fu">  10001046:</span> E8 B5 FF FF FF     <span class="bu">call</span>        _fnCallingConvention@<span class="dv">8</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="fu">  1000104B:</span> D9 5D FC           <span class="bu">fstp</span>        <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span><span class="dv">-4</span>]</a>
<a class="sourceLine" id="cb12-12" title="12"><span class="fu">  1000104E:</span> F3 0F 2C <span class="dv">45</span> FC     <span class="bu">cvttss2si</span>   <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span><span class="dv">-4</span>]</a>
<a class="sourceLine" id="cb12-13" title="13"><span class="fu">  10001053:</span> 8B E5              <span class="bu">mov</span>         <span class="kw">esp</span>,<span class="kw">ebp</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="fu">  10001055:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="fu">  10001056:</span> C2 0C <span class="dv">00</span>           <span class="bu">ret</span><span class="bn">         0Ch</span></a>
<a class="sourceLine" id="cb12-16" title="16"></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="fu">_fnCallingConvention@8:</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="fu">  10001000:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb12-19" title="19"><span class="fu">  10001001:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb12-20" title="20"><span class="fu">  10001003:</span> F3 0F <span class="dv">10</span> 4D <span class="dv">08</span>     <span class="bu">movss</span>       <span class="kw">xmm1</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb12-21" title="21"><span class="fu">  10001008:</span> F3 0F <span class="dv">10</span> <span class="dv">45</span> 0C     <span class="bu">movss</span>       <span class="kw">xmm0</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+0Ch]</a>
<a class="sourceLine" id="cb12-22" title="22"><span class="fu">  1000100D:</span> F3 0F <span class="dv">58</span> 0D B8 <span class="dv">20</span>  <span class="bu">addss</span>       <span class="kw">xmm1</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@3f800000]</a>
<a class="sourceLine" id="cb12-23" title="23">            <span class="dv">00</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb12-24" title="24"><span class="fu">  10001015:</span> F3 0F <span class="dv">58</span> <span class="dv">05</span> BC <span class="dv">20</span>  <span class="bu">addss</span>       <span class="kw">xmm0</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@<span class="dv">40000000</span>]</a>
<a class="sourceLine" id="cb12-25" title="25">            <span class="dv">00</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb12-26" title="26"><span class="fu">  1000101D:</span> F3 0F <span class="dv">59</span> C8        <span class="bu">mulss</span>       <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb12-27" title="27"><span class="fu">  10001021:</span> F3 0F <span class="dv">11</span> 4D <span class="dv">08</span>     <span class="bu">movss</span>       <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>],<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb12-28" title="28"><span class="fu">  10001026:</span> D9 <span class="dv">45</span> <span class="dv">08</span>           <span class="bu">fld</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb12-29" title="29"><span class="fu">  10001029:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb12-30" title="30"><span class="fu">  1000102A:</span> C2 <span class="dv">08</span> <span class="dv">00</span>           <span class="bu">ret</span>         <span class="dv">8</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>Floats are pushed on the stack given by <code>ESP</code>.</li>
<li>The return value is given on the FPU stack with the <code>fld</code> instruction</li>
<li>8 bytes are pushed on the stack by the caller for the parameters, 8 bytes are popped by the callee.</li>
</ul>
<p>The stackframe of the callee, based on <code>EBP</code> looks like:</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+12]</code></td>
<td>Parameter <code>b</code> (float, 4 bytes, 40000000)</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+8]</code></td>
<td>Parameter <code>a</code> (float, 4 bytes, 3f800000)</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> frame pointer</td>
</tr>
<tr class="odd">
<td><code>xxx ptr [EBP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<h5 id="without-sse-instructions"><span class="header-section-number">4.1.4.4.1</span> Without SSE instructions</h5>
<p>The above example uses SSE instructions. The same is performed with basic ia32 instructions with the option <code>/arch:ia32</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb13-1" title="1"><span class="fu">_DllMain@12:</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="fu">  10001030:</span> D9 <span class="dv">05</span> D8 <span class="dv">20</span> <span class="dv">00</span> <span class="dv">10</span>  <span class="bu">fld</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [__real@<span class="dv">40000000</span>]</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="fu">  10001036:</span> <span class="dv">83</span> EC <span class="dv">08</span>           <span class="bu">sub</span>         <span class="kw">esp</span>,<span class="dv">8</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="fu">  10001039:</span> D9 5C <span class="dv">24</span> <span class="dv">04</span>        <span class="bu">fstp</span>        <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">esp</span>+<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb13-5" title="5"><span class="fu">  1000103D:</span> D9 E8              <span class="bu">fld1</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="fu">  1000103F:</span> D9 1C <span class="dv">24</span>           <span class="bu">fstp</span>        <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">esp</span>]</a>
<a class="sourceLine" id="cb13-7" title="7"><span class="fu">  10001042:</span> E8 B9 FF FF FF     <span class="bu">call</span>        _fnCallingConvention@<span class="dv">8</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="fu">  10001047:</span> E8 <span class="dv">04</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        __ftol2_sse</a>
<a class="sourceLine" id="cb13-9" title="9"><span class="fu">  1000104C:</span> C2 0C <span class="dv">00</span>           <span class="bu">ret</span><span class="bn">         0Ch</span></a>
<a class="sourceLine" id="cb13-10" title="10"></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="fu">_fnCallingConvention@8:</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="fu">  10001000:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="fu">  10001001:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="fu">  10001003:</span> D9 <span class="dv">45</span> <span class="dv">08</span>           <span class="bu">fld</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb13-15" title="15"><span class="fu">  10001006:</span> DC <span class="dv">05</span> C8 <span class="dv">20</span> <span class="dv">00</span> <span class="dv">10</span>  <span class="bu">fadd</span>        <span class="dt">qword</span> <span class="dt">ptr</span> [__real@3ff0000000000000]</a>
<a class="sourceLine" id="cb13-16" title="16"><span class="fu">  1000100C:</span> D9 <span class="dv">45</span> 0C           <span class="bu">fld</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+0Ch]</a>
<a class="sourceLine" id="cb13-17" title="17"><span class="fu">  1000100F:</span> DC <span class="dv">05</span> D0 <span class="dv">20</span> <span class="dv">00</span> <span class="dv">10</span>  <span class="bu">fadd</span>        <span class="dt">qword</span> <span class="dt">ptr</span> [__real@<span class="dv">4000000000000000</span>]</a>
<a class="sourceLine" id="cb13-18" title="18"><span class="fu">  10001015:</span> DE C9              <span class="bu">fmulp</span>       <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="fu">  10001017:</span> D9 5D <span class="dv">08</span>           <span class="bu">fstp</span>        <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb13-20" title="20"><span class="fu">  1000101A:</span> D9 <span class="dv">45</span> <span class="dv">08</span>           <span class="bu">fld</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb13-21" title="21"><span class="fu">  1000101D:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb13-22" title="22"><span class="fu">  1000101E:</span> C2 <span class="dv">08</span> <span class="dv">00</span>           <span class="bu">ret</span>         <span class="dv">8</span></a></code></pre></div>
<p>The function is equivalent to the SSE version. It stores the result on the FPU stack. Parameters are obtained relative to the CPU’s <code>EBP</code> Stack Frame pointer.</p>
<h4 id="structs-by-value"><span class="header-section-number">4.1.4.5</span> Structs by Value</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">struct</span> mystruct {</a>
<a class="sourceLine" id="cb14-2" title="2">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="dt">int</span> b;</a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="dt">int</span> c;</a>
<a class="sourceLine" id="cb14-5" title="5">  <span class="dt">int</span> d;</a>
<a class="sourceLine" id="cb14-6" title="6">  <span class="dt">int</span> e;</a>
<a class="sourceLine" id="cb14-7" title="7">  <span class="dt">int</span> f;</a>
<a class="sourceLine" id="cb14-8" title="8">};</a>
<a class="sourceLine" id="cb14-9" title="9"></a>
<a class="sourceLine" id="cb14-10" title="10">CALLINGCONVENTION_API <span class="dt">int</span> __stdcall fnCallingConvention(<span class="kw">struct</span> mystruct *ps, <span class="kw">struct</span> mystruct s)</a>
<a class="sourceLine" id="cb14-11" title="11">{</a>
<a class="sourceLine" id="cb14-12" title="12">  <span class="cf">return</span> ps-&gt;a + s.a;</a>
<a class="sourceLine" id="cb14-13" title="13">}</a>
<a class="sourceLine" id="cb14-14" title="14"></a>
<a class="sourceLine" id="cb14-15" title="15">BOOL APIENTRY DllMain(HMODULE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved)</a>
<a class="sourceLine" id="cb14-16" title="16">{</a>
<a class="sourceLine" id="cb14-17" title="17">  <span class="kw">struct</span> mystruct x = {<span class="dv">0</span>, };</a>
<a class="sourceLine" id="cb14-18" title="18">  <span class="kw">struct</span> mystruct y = {<span class="dv">0</span>, };</a>
<a class="sourceLine" id="cb14-19" title="19"></a>
<a class="sourceLine" id="cb14-20" title="20">  <span class="cf">return</span> fnCallingConvention(&amp;x, y);</a>
<a class="sourceLine" id="cb14-21" title="21">}</a></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb15-1" title="1"><span class="fu">_DllMain@12:</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="fu">  10001010:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="fu">  10001011:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="fu">  10001013:</span> <span class="dv">83</span> EC <span class="dv">34</span>           <span class="bu">sub</span>         <span class="kw">esp</span><span class="bn">,34h</span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="fu">  10001016:</span> A1 <span class="dv">00</span> <span class="dv">30</span> <span class="dv">00</span> <span class="dv">10</span>     <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [___security_cookie]</a>
<a class="sourceLine" id="cb15-6" title="6"><span class="fu">  1000101B:</span> <span class="dv">33</span> C5              <span class="bu">xor</span>         <span class="kw">eax</span>,<span class="kw">ebp</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="fu">  1000101D:</span> <span class="dv">89</span> <span class="dv">45</span> FC           <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span><span class="dv">-4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb15-8" title="8"><span class="fu">  10001020:</span> 0F <span class="dv">57</span> C0           <span class="bu">xorps</span>       <span class="kw">xmm0</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="fu">  10001023:</span> <span class="dv">83</span> EC <span class="dv">18</span>           <span class="bu">sub</span>         <span class="kw">esp</span><span class="bn">,18h</span></a>
<a class="sourceLine" id="cb15-10" title="10"><span class="fu">  10001026:</span> 8B C4              <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="fu">  10001028:</span> <span class="dv">66</span> 0F D6 <span class="dv">45</span> E8     <span class="bu">movq</span>        mmword <span class="dt">ptr</span> [<span class="kw">ebp</span>-18h],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="fu">  1000102D:</span> <span class="dv">66</span> 0F D6 <span class="dv">45</span> F0     <span class="bu">movq</span>        mmword <span class="dt">ptr</span> [<span class="kw">ebp</span>-10h],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb15-13" title="13"><span class="fu">  10001032:</span> <span class="dv">66</span> 0F D6 <span class="dv">45</span> D0     <span class="bu">movq</span>        mmword <span class="dt">ptr</span> [<span class="kw">ebp</span>-30h],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb15-14" title="14"><span class="fu">  10001037:</span> <span class="dv">66</span> 0F D6 <span class="dv">45</span> D8     <span class="bu">movq</span>        mmword <span class="dt">ptr</span> [<span class="kw">ebp</span>-28h],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb15-15" title="15"><span class="fu">  1000103C:</span> C7 <span class="dv">45</span> CC <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>-34h],<span class="dv">0</span></a>
<a class="sourceLine" id="cb15-16" title="16">            <span class="dv">00</span></a>
<a class="sourceLine" id="cb15-17" title="17"><span class="fu">  10001043:</span> F3 0F 7E <span class="dv">45</span> CC     <span class="bu">movq</span>        <span class="kw">xmm0</span>,mmword <span class="dt">ptr</span> [<span class="kw">ebp</span>-34h]</a>
<a class="sourceLine" id="cb15-18" title="18"><span class="fu">  10001048:</span> <span class="dv">66</span> 0F D6 <span class="dv">00</span>        <span class="bu">movq</span>        mmword <span class="dt">ptr</span> [<span class="kw">eax</span>],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb15-19" title="19"><span class="fu">  1000104C:</span> F3 0F 7E <span class="dv">45</span> D4     <span class="bu">movq</span>        <span class="kw">xmm0</span>,mmword <span class="dt">ptr</span> [<span class="kw">ebp</span>-2Ch]</a>
<a class="sourceLine" id="cb15-20" title="20"><span class="fu">  10001051:</span> <span class="dv">66</span> 0F D6 <span class="dv">40</span> <span class="dv">08</span>     <span class="bu">movq</span>        mmword <span class="dt">ptr</span> [<span class="kw">eax</span>+<span class="dv">8</span>],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb15-21" title="21"><span class="fu">  10001056:</span> C7 <span class="dv">45</span> E0 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>-20h],<span class="dv">0</span></a>
<a class="sourceLine" id="cb15-22" title="22">            <span class="dv">00</span></a>
<a class="sourceLine" id="cb15-23" title="23"><span class="fu">  1000105D:</span> F3 0F 7E <span class="dv">45</span> DC     <span class="bu">movq</span>        <span class="kw">xmm0</span>,mmword <span class="dt">ptr</span> [<span class="kw">ebp</span>-24h]</a>
<a class="sourceLine" id="cb15-24" title="24"><span class="fu">  10001062:</span> <span class="dv">66</span> 0F D6 <span class="dv">40</span> <span class="dv">10</span>     <span class="bu">movq</span>        mmword <span class="dt">ptr</span> [<span class="kw">eax</span>+10h],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb15-25" title="25"><span class="fu">  10001067:</span> 8D <span class="dv">45</span> E4           <span class="bu">lea</span>         <span class="kw">eax</span>,[<span class="kw">ebp</span>-1Ch]</a>
<a class="sourceLine" id="cb15-26" title="26"><span class="fu">  1000106A:</span> <span class="dv">50</span>                 <span class="bu">push</span>        <span class="kw">eax</span></a>
<a class="sourceLine" id="cb15-27" title="27"><span class="fu">  1000106B:</span> C7 <span class="dv">45</span> E4 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>-1Ch],<span class="dv">0</span></a>
<a class="sourceLine" id="cb15-28" title="28">            <span class="dv">00</span></a>
<a class="sourceLine" id="cb15-29" title="29"><span class="fu">  10001072:</span> C7 <span class="dv">45</span> F8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span><span class="dv">-8</span>],<span class="dv">0</span></a>
<a class="sourceLine" id="cb15-30" title="30">            <span class="dv">00</span></a>
<a class="sourceLine" id="cb15-31" title="31"><span class="fu">  10001079:</span> E8 <span class="dv">82</span> FF FF FF     <span class="bu">call</span>        _fnCallingConvention@<span class="dv">28</span></a>
<a class="sourceLine" id="cb15-32" title="32"><span class="fu">  1000107E:</span> 8B 4D FC           <span class="bu">mov</span>         <span class="kw">ecx</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span><span class="dv">-4</span>]</a>
<a class="sourceLine" id="cb15-33" title="33"><span class="fu">  10001081:</span> <span class="dv">33</span> CD              <span class="bu">xor</span>         <span class="kw">ecx</span>,<span class="kw">ebp</span></a>
<a class="sourceLine" id="cb15-34" title="34"><span class="fu">  10001083:</span> E8 <span class="dv">06</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        @__security_check_cookie@<span class="dv">4</span></a>
<a class="sourceLine" id="cb15-35" title="35"><span class="fu">  10001088:</span> 8B E5              <span class="bu">mov</span>         <span class="kw">esp</span>,<span class="kw">ebp</span></a>
<a class="sourceLine" id="cb15-36" title="36"><span class="fu">  1000108A:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb15-37" title="37"><span class="fu">  1000108B:</span> C2 0C <span class="dv">00</span>           <span class="bu">ret</span><span class="bn">         0Ch</span></a>
<a class="sourceLine" id="cb15-38" title="38"></a>
<a class="sourceLine" id="cb15-39" title="39"><span class="fu">_fnCallingConvention@28:</span></a>
<a class="sourceLine" id="cb15-40" title="40"><span class="fu">  10001000:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb15-41" title="41"><span class="fu">  10001001:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb15-42" title="42"><span class="fu">  10001003:</span> 8B <span class="dv">45</span> <span class="dv">08</span>           <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb15-43" title="43"><span class="fu">  10001006:</span> 8B <span class="dv">00</span>              <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">eax</span>]</a>
<a class="sourceLine" id="cb15-44" title="44"><span class="fu">  10001008:</span> <span class="dv">03</span> <span class="dv">45</span> 0C           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+0Ch]</a>
<a class="sourceLine" id="cb15-45" title="45"><span class="fu">  1000100B:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb15-46" title="46"><span class="fu">  1000100C:</span> C2 1C <span class="dv">00</span>           <span class="bu">ret</span><span class="bn">         1Ch</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>The parameter size is 4 bytes for a pointer plus 6*4 (24) bytes for the struct being passed by value. This results in 28 bytes via the parameter list, hence the name <code>_fnCallingConvention@28</code>.</li>
<li>Space is allocated on the stack for <code>x</code> and <code>y</code> by the caller. Additional space is allocated for a copy of <code>y</code>. The contents of <code>y</code> is copied to the stack, which is then passed by value.</li>
</ul>
<p>The stackframe of the callee, based on <code>EBP</code> looks like:</p>
<table>
<colgroup>
<col style="width: 22%"></col>
<col style="width: 77%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+60]</code></td>
<td>The callers copy of <code>x</code>, the address stored in <code>dword ptr [EBP+8]</code>.</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+36]</code></td>
<td>The callers copy of <code>y</code> which is 24 bytes</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+12]</code></td>
<td>24 bytes which is a copy of <code>y</code> on the stack</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+8]</code></td>
<td>A pointer to <code>x</code> from the callers stack</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> frame pointer</td>
</tr>
<tr class="odd">
<td><code>xxx ptr [EBP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<p>We see that passing a struct by value makes a copy of that struct and pushes it on the stack, making this type of call inefficient. Much better would be to pass the struct by reference, eliminating the copying.</p>
<h4 id="bit-return-value"><span class="header-section-number">4.1.4.6</span> 64-bit return value</h4>
<p>Return values that are 64-bit long are returned via registers.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb16-1" title="1">CALLINGCONVENTION_API LONG64 __stdcall fnCallingConvention(LONG x, LONG y)</a>
<a class="sourceLine" id="cb16-2" title="2">{</a>
<a class="sourceLine" id="cb16-3" title="3">  <span class="cf">return</span> (LONG64)(x + <span class="dv">1</span>) * (LONG64)(y + <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb16-4" title="4">}</a>
<a class="sourceLine" id="cb16-5" title="5"></a>
<a class="sourceLine" id="cb16-6" title="6">BOOL APIENTRY DllMain(HMODULE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved)</a>
<a class="sourceLine" id="cb16-7" title="7">{</a>
<a class="sourceLine" id="cb16-8" title="8">  <span class="cf">return</span> fnCallingConvention(<span class="dv">1</span>, <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb16-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb17-1" title="1"><span class="fu">_DllMain@12:</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="fu">  10001020:</span> 6A <span class="dv">02</span>              <span class="bu">push</span>        <span class="dv">2</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="fu">  10001022:</span> 6A <span class="dv">01</span>              <span class="bu">push</span>        <span class="dv">1</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="fu">  10001024:</span> E8 D7 FF FF FF     <span class="bu">call</span>        _fnCallingConvention@<span class="dv">8</span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="fu">  10001029:</span> C2 0C <span class="dv">00</span>           <span class="bu">ret</span><span class="bn">         0Ch</span></a>
<a class="sourceLine" id="cb17-6" title="6"></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="fu">_fnCallingConvention@8:</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="fu">  10001000:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="fu">  10001001:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb17-10" title="10"><span class="fu">  10001003:</span> 8B <span class="dv">45</span> <span class="dv">08</span>           <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb17-11" title="11"><span class="fu">  10001006:</span> 8B 4D 0C           <span class="bu">mov</span>         <span class="kw">ecx</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+0Ch]</a>
<a class="sourceLine" id="cb17-12" title="12"><span class="fu">  10001009:</span> <span class="dv">40</span>                 <span class="bu">inc</span>         <span class="kw">eax</span></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="fu">  1000100A:</span> <span class="dv">83</span> C1 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">ecx</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb17-14" title="14"><span class="fu">  1000100D:</span> F7 E9              <span class="bu">imul</span>        <span class="kw">ecx</span></a>
<a class="sourceLine" id="cb17-15" title="15"><span class="fu">  1000100F:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb17-16" title="16"><span class="fu">  10001010:</span> C2 <span class="dv">08</span> <span class="dv">00</span>           <span class="bu">ret</span>         <span class="dv">8</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>The result of the multiplication <code>imul</code> is stored in <code>EDX:EAX</code>, <code>EDX</code> is the upper 32-bits, <code>EAX</code> is the lower 32-bits. This is also returned to the caller.</li>
<li>The code is so written with type casting that the smallest number of instructions are generated.</li>
</ul>
<p>The stackframe in the callee, based on <code>EBP</code> looks like:</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+12]</code></td>
<td>Parameter <code>y</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+8]</code></td>
<td>Parameter <code>x</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> frame pointer</td>
</tr>
<tr class="odd">
<td><code>xxx ptr [EBP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<h5 id="typecasting-for-a-correct-program"><span class="header-section-number">4.1.4.6.1</span> Typecasting for a correct program</h5>
<p>The example previously puts typecasting in a position so to produce the minimal amount of code. But it introduces a subtle error that can occur if the parameter <code>x</code> is the largest possible signed number 2^31-1 or <code>y</code> is so large that rollover can occur 2^31-2. The result will be 64-bit but will be truncated at 32-bit. The following code examples solve this problem, but show many more instructions are required.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb18-1" title="1">CALLINGCONVENTION_API LONG64 __stdcall fnCallingConvention(LONG x, LONG y)</a>
<a class="sourceLine" id="cb18-2" title="2">{</a>
<a class="sourceLine" id="cb18-3" title="3">  <span class="cf">return</span> ((LONG64)x + <span class="dv">1</span>) * ((LONG64)y + <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb18-4" title="4">}</a></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb19-1" title="1"><span class="fu">_fnCallingConvention@8:</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="fu">  10001000:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="fu">  10001001:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="fu">  10001003:</span> 8B <span class="dv">45</span> <span class="dv">08</span>           <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb19-5" title="5"><span class="fu">  10001006:</span> <span class="dv">99</span>                 <span class="bu">cdq</span></a>
<a class="sourceLine" id="cb19-6" title="6"><span class="fu">  10001007:</span> <span class="dv">56</span>                 <span class="bu">push</span>        <span class="kw">esi</span></a>
<a class="sourceLine" id="cb19-7" title="7"><span class="fu">  10001008:</span> 8B F0              <span class="bu">mov</span>         <span class="kw">esi</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb19-8" title="8"><span class="fu">  1000100A:</span> 8B <span class="dv">45</span> 0C           <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+0Ch]</a>
<a class="sourceLine" id="cb19-9" title="9"><span class="fu">  1000100D:</span> 8B CA              <span class="bu">mov</span>         <span class="kw">ecx</span>,<span class="kw">edx</span></a>
<a class="sourceLine" id="cb19-10" title="10"><span class="fu">  1000100F:</span> <span class="dv">83</span> C6 <span class="dv">01</span>           <span class="bu">add</span>         <span class="kw">esi</span>,<span class="dv">1</span></a>
<a class="sourceLine" id="cb19-11" title="11"><span class="fu">  10001012:</span> <span class="dv">99</span>                 <span class="bu">cdq</span></a>
<a class="sourceLine" id="cb19-12" title="12"><span class="fu">  10001013:</span> <span class="dv">83</span> D1 <span class="dv">00</span>           <span class="bu">adc</span>         <span class="kw">ecx</span>,<span class="dv">0</span></a>
<a class="sourceLine" id="cb19-13" title="13"><span class="fu">  10001016:</span> <span class="dv">83</span> C0 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb19-14" title="14"><span class="fu">  10001019:</span> <span class="dv">83</span> D2 <span class="dv">00</span>           <span class="bu">adc</span>         <span class="kw">edx</span>,<span class="dv">0</span></a>
<a class="sourceLine" id="cb19-15" title="15"><span class="fu">  1000101C:</span> <span class="dv">52</span>                 <span class="bu">push</span>        <span class="kw">edx</span></a>
<a class="sourceLine" id="cb19-16" title="16"><span class="fu">  1000101D:</span> <span class="dv">50</span>                 <span class="bu">push</span>        <span class="kw">eax</span></a>
<a class="sourceLine" id="cb19-17" title="17"><span class="fu">  1000101E:</span> <span class="dv">51</span>                 <span class="bu">push</span>        <span class="kw">ecx</span></a>
<a class="sourceLine" id="cb19-18" title="18"><span class="fu">  1000101F:</span> <span class="dv">56</span>                 <span class="bu">push</span>        <span class="kw">esi</span></a>
<a class="sourceLine" id="cb19-19" title="19"><span class="fu">  10001020:</span> E8<span class="bn"> 1B </span><span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        __allmul</a>
<a class="sourceLine" id="cb19-20" title="20"><span class="fu">  10001025:</span> 5E                 <span class="bu">pop</span>         <span class="kw">esi</span></a>
<a class="sourceLine" id="cb19-21" title="21"><span class="fu">  10001026:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb19-22" title="22"><span class="fu">  10001027:</span> C2 <span class="dv">08</span> <span class="dv">00</span>           <span class="bu">ret</span>         <span class="dv">8</span></a></code></pre></div>
<p>We see that the parameters are first extended to 64-bit and then multiplied.</p>
<h5 id="no-typecasting"><span class="header-section-number">4.1.4.6.2</span> No Typecasting</h5>
<p>Similar code is produced with no typecasting, except the result is reduced to 32-bit by clearing the <code>EDX</code> register with a <code>cdq</code> assembler instruction.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb20-1" title="1">CALLINGCONVENTION_API LONG64 __stdcall fnCallingConvention(LONG x, LONG y)</a>
<a class="sourceLine" id="cb20-2" title="2">{</a>
<a class="sourceLine" id="cb20-3" title="3">  <span class="cf">return</span> (x + <span class="dv">1</span>) * (y + <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb20-4" title="4">}</a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb21-1" title="1"><span class="fu">_fnCallingConvention@8:</span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="fu">  10001000:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb21-3" title="3"><span class="fu">  10001001:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="fu">  10001003:</span> 8B <span class="dv">45</span> <span class="dv">08</span>           <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb21-5" title="5"><span class="fu">  10001006:</span> 8B 4D 0C           <span class="bu">mov</span>         <span class="kw">ecx</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+0Ch]</a>
<a class="sourceLine" id="cb21-6" title="6"><span class="fu">  10001009:</span> <span class="dv">40</span>                 <span class="bu">inc</span>         <span class="kw">eax</span></a>
<a class="sourceLine" id="cb21-7" title="7"><span class="fu">  1000100A:</span> <span class="dv">83</span> C1 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">ecx</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb21-8" title="8"><span class="fu">  1000100D:</span> 0F AF C1           <span class="bu">imul</span>        <span class="kw">eax</span>,<span class="kw">ecx</span></a>
<a class="sourceLine" id="cb21-9" title="9"><span class="fu">  10001010:</span> <span class="dv">99</span>                 <span class="bu">cdq</span></a>
<a class="sourceLine" id="cb21-10" title="10"><span class="fu">  10001011:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb21-11" title="11"><span class="fu">  10001012:</span> C2 <span class="dv">08</span> <span class="dv">00</span>           <span class="bu">ret</span>         <span class="dv">8</span></a></code></pre></div>
<h4 id="return-struct-by-value"><span class="header-section-number">4.1.4.7</span> Return Struct by Value</h4>
<p>The final example shows how a <code>struct</code> is returned by value.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">struct</span> mystruct {</a>
<a class="sourceLine" id="cb22-2" title="2">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb22-3" title="3">  <span class="dt">int</span> b;</a>
<a class="sourceLine" id="cb22-4" title="4">  <span class="dt">int</span> c;</a>
<a class="sourceLine" id="cb22-5" title="5">  <span class="dt">int</span> d;</a>
<a class="sourceLine" id="cb22-6" title="6">  <span class="dt">int</span> e;</a>
<a class="sourceLine" id="cb22-7" title="7">  <span class="dt">int</span> f;</a>
<a class="sourceLine" id="cb22-8" title="8">};</a>
<a class="sourceLine" id="cb22-9" title="9"></a>
<a class="sourceLine" id="cb22-10" title="10">CALLINGCONVENTION_API <span class="kw">struct</span> mystruct __stdcall fnCallingConvention(<span class="dt">int</span> x, <span class="dt">int</span> y)</a>
<a class="sourceLine" id="cb22-11" title="11">{</a>
<a class="sourceLine" id="cb22-12" title="12">  <span class="kw">struct</span> mystruct t = {<span class="dv">0</span>, };</a>
<a class="sourceLine" id="cb22-13" title="13">  t.a = x;</a>
<a class="sourceLine" id="cb22-14" title="14">  t.b = y;</a>
<a class="sourceLine" id="cb22-15" title="15">  <span class="cf">return</span> t;</a>
<a class="sourceLine" id="cb22-16" title="16">}</a>
<a class="sourceLine" id="cb22-17" title="17"></a>
<a class="sourceLine" id="cb22-18" title="18">BOOL APIENTRY DllMain(HMODULE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved)</a>
<a class="sourceLine" id="cb22-19" title="19">{</a>
<a class="sourceLine" id="cb22-20" title="20">  <span class="kw">struct</span> mystruct x;</a>
<a class="sourceLine" id="cb22-21" title="21">  x = fnCallingConvention(<span class="dv">1</span>, <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb22-22" title="22">  <span class="cf">return</span> x.a;</a>
<a class="sourceLine" id="cb22-23" title="23">}</a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb23-1" title="1"><span class="fu">_DllMain@12:</span></a>
<a class="sourceLine" id="cb23-2" title="2"><span class="fu">  10001030:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb23-3" title="3"><span class="fu">  10001031:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb23-4" title="4"><span class="fu">  10001033:</span> <span class="dv">83</span> EC <span class="dv">30</span>           <span class="bu">sub</span>         <span class="kw">esp</span><span class="bn">,30h</span></a>
<a class="sourceLine" id="cb23-5" title="5"><span class="fu">  10001036:</span> 6A <span class="dv">02</span>              <span class="bu">push</span>        <span class="dv">2</span></a>
<a class="sourceLine" id="cb23-6" title="6"><span class="fu">  10001038:</span> 6A <span class="dv">01</span>              <span class="bu">push</span>        <span class="dv">1</span></a>
<a class="sourceLine" id="cb23-7" title="7"><span class="fu">  1000103A:</span> 8D <span class="dv">45</span> D0           <span class="bu">lea</span>         <span class="kw">eax</span>,[<span class="kw">ebp</span>-30h]</a>
<a class="sourceLine" id="cb23-8" title="8"><span class="fu">  1000103D:</span> <span class="dv">50</span>                 <span class="bu">push</span>        <span class="kw">eax</span></a>
<a class="sourceLine" id="cb23-9" title="9"><span class="fu">  1000103E:</span> E8 BD FF FF FF     <span class="bu">call</span>        _fnCallingConvention@<span class="dv">8</span></a>
<a class="sourceLine" id="cb23-10" title="10"><span class="fu">  10001043:</span> F3 0F 7E <span class="dv">00</span>        <span class="bu">movq</span>        <span class="kw">xmm0</span>,mmword <span class="dt">ptr</span> [<span class="kw">eax</span>]</a>
<a class="sourceLine" id="cb23-11" title="11"><span class="fu">  10001047:</span> <span class="dv">66</span> 0F D6 <span class="dv">45</span> E8     <span class="bu">movq</span>        mmword <span class="dt">ptr</span> [<span class="kw">ebp</span>-18h],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb23-12" title="12"><span class="fu">  1000104C:</span> F3 0F 7E <span class="dv">40</span> <span class="dv">08</span>     <span class="bu">movq</span>        <span class="kw">xmm0</span>,mmword <span class="dt">ptr</span> [<span class="kw">eax</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb23-13" title="13"><span class="fu">  10001051:</span> <span class="dv">66</span> 0F D6 <span class="dv">45</span> F0     <span class="bu">movq</span>        mmword <span class="dt">ptr</span> [<span class="kw">ebp</span>-10h],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb23-14" title="14"><span class="fu">  10001056:</span> F3 0F 7E <span class="dv">40</span> <span class="dv">10</span>     <span class="bu">movq</span>        <span class="kw">xmm0</span>,mmword <span class="dt">ptr</span> [<span class="kw">eax</span>+10h]</a>
<a class="sourceLine" id="cb23-15" title="15"><span class="fu">  1000105B:</span> 8B <span class="dv">45</span> E8           <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>-18h]</a>
<a class="sourceLine" id="cb23-16" title="16"><span class="fu">  1000105E:</span> <span class="dv">66</span> 0F D6 <span class="dv">45</span> F8     <span class="bu">movq</span>        mmword <span class="dt">ptr</span> [<span class="kw">ebp</span><span class="dv">-8</span>],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb23-17" title="17"><span class="fu">  10001063:</span> 8B E5              <span class="bu">mov</span>         <span class="kw">esp</span>,<span class="kw">ebp</span></a>
<a class="sourceLine" id="cb23-18" title="18"><span class="fu">  10001065:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb23-19" title="19"><span class="fu">  10001066:</span> C2 0C <span class="dv">00</span>           <span class="bu">ret</span><span class="bn">         0Ch</span></a>
<a class="sourceLine" id="cb23-20" title="20"></a>
<a class="sourceLine" id="cb23-21" title="21"><span class="fu">_fnCallingConvention@8:</span></a>
<a class="sourceLine" id="cb23-22" title="22"><span class="fu">  10001000:</span> <span class="dv">55</span>                 <span class="bu">push</span>        <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb23-23" title="23"><span class="fu">  10001001:</span> 8B EC              <span class="bu">mov</span>         <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb23-24" title="24"><span class="fu">  10001003:</span> 8B <span class="dv">45</span> <span class="dv">08</span>           <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb23-25" title="25"><span class="fu">  10001006:</span> 8B 4D 0C           <span class="bu">mov</span>         <span class="kw">ecx</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+0Ch]</a>
<a class="sourceLine" id="cb23-26" title="26"><span class="fu">  10001009:</span> 0F <span class="dv">57</span> C0           <span class="bu">xorps</span>       <span class="kw">xmm0</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb23-27" title="27"><span class="fu">  1000100C:</span> <span class="dv">66</span> 0F D6 <span class="dv">40</span> <span class="dv">04</span>     <span class="bu">movq</span>        mmword <span class="dt">ptr</span> [<span class="kw">eax</span>+<span class="dv">4</span>],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb23-28" title="28"><span class="fu">  10001011:</span> <span class="dv">66</span> 0F D6 <span class="dv">40</span> 0C     <span class="bu">movq</span>        mmword <span class="dt">ptr</span> [<span class="kw">eax</span>+0Ch],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb23-29" title="29"><span class="fu">  10001016:</span> C7 <span class="dv">40</span> <span class="dv">14</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">eax</span>+14h],<span class="dv">0</span></a>
<a class="sourceLine" id="cb23-30" title="30">            <span class="dv">00</span></a>
<a class="sourceLine" id="cb23-31" title="31"><span class="fu">  1000101D:</span> <span class="dv">89</span> <span class="dv">08</span>              <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">eax</span>],<span class="kw">ecx</span></a>
<a class="sourceLine" id="cb23-32" title="32"><span class="fu">  1000101F:</span> 8B 4D <span class="dv">10</span>           <span class="bu">mov</span>         <span class="kw">ecx</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">ebp</span>+10h]</a>
<a class="sourceLine" id="cb23-33" title="33"><span class="fu">  10001022:</span> <span class="dv">89</span> <span class="dv">48</span> <span class="dv">04</span>           <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">eax</span>+<span class="dv">4</span>],<span class="kw">ecx</span></a>
<a class="sourceLine" id="cb23-34" title="34"><span class="fu">  10001025:</span> 5D                 <span class="bu">pop</span>         <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb23-35" title="35"><span class="fu">  10001026:</span> C2 0C <span class="dv">00</span>           <span class="bu">ret</span><span class="bn">         0Ch</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>There is an extra parameter passed on the stack from the caller to the callee, a pointer to the struct allocated on the stack by the caller.</li>
<li>The return struct pointer is passed as though it’s the first parameter.</li>
<li>The name of the callee indicates 8 bytes in the parameter list with <code>_fnCallingConvention@8</code>, even though 12 bytes are given in the stack. This shows the calling convention is based on the function signature, the return value doesn’t form part of the function signature.</li>
<li>The callee pops 12 bytes from the stack, consistent with the three parameters.</li>
<li>The callee doesn’t allocate space on its stack for the return value, but the caller does (and it’s responsible for the return value).</li>
<li>On return, the register <code>EAX</code> contains the pointer to the return struct allocated by the caller.</li>
</ul>
<p>The stackframe of the callee, based on <code>EBP</code> looks like:</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+20]</code></td>
<td>return struct</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+16]</code></td>
<td>Parameter <code>y</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+12]</code></td>
<td>Parameter <code>x</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+8]</code></td>
<td>Pointer to return struct</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> frame pointer</td>
</tr>
<tr class="odd">
<td><code>xxx ptr [EBP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<p>Note that the callee doesn’t necessary know the return struct is at the offset <code>[EBP+20]</code>, instead it should use the pointer given at <code>[EBP+8]</code>.</p>
<h2 id="bit-windows-abi"><span class="header-section-number">4.2</span> 64-bit Windows ABI</h2>
<p>The Windows 64-bit ABI is the only calling convention used on Microsoft Windows. Modifiers such as <code>__stdcall</code> and <code>__cdecl</code> are ignored for targets compiled for the 64-bit platform.</p>
<p>Microsoft provide information about the 64-bit ABI on their <a href="https://docs.microsoft.com/en-us/cpp/build/x64-software-conventions">Website</a> but it lacks some important information. A document provided by <a href="https://www.lomont.org/papers/2009/Introduction_to_x64_Assembly.pdf">Chris Lomont</a> provides some more useful details but contains a few minor differences to here in parameter passing.</p>
<h3 id="naming-convention-1"><span class="header-section-number">4.2.1</span> Naming Convention</h3>
<p>When using <code>extern &quot;C&quot;</code>, the name of the function is the same as the function itself.</p>
<p>Example:</p>
<p><code>int myfunc(int a, int b, int c);</code></p>
<p>→ <code>myfunc</code></p>
<h3 id="parameter-passing-and-return-values-1"><span class="header-section-number">4.2.2</span> Parameter Passing and Return Values</h3>
<p>Arguments are first passed via registers, remaining arguments are passed via the stack.</p>
<ul>
<li>The first argument is passed in <code>RCX</code> (for an integer type value) or in <code>XMM0</code> (for a float or double). The second argument in <code>RDX</code> or <code>XMM1</code>; the third in <code>R8</code> or <code>XMM2</code>; and the fourth in <code>R9</code> or <code>Xmm3</code>.</li>
<li>If integers being passed in <code>RCX</code>, <code>RDX</code>, <code>R8</code> or <code>R9</code> don’t consume the full 64-bit register, the upper bits are undefined (may contain garbage).</li>
<li>Additional arguments are pushed on the stack from right to left from the last argument to the fifth argument. As the stack grows down, it will appear in memory that argument 5 is before argument 6 (argument 5 has a smaller offset to <code>RSP</code> than argument 6).</li>
<li>The caller always reserves 32 bytes (4 arguments) on the stack, so that the callee can use this space to make a shadow copy of the first four arguments if required. It is the responsibility of the callee to copy data from the registers to the shadow space if needed.</li>
</ul>
<p>Return Values are given in registers.</p>
<ul>
<li>Integers are returned in <code>RAX</code></li>
<li>Floats and doubles are returned in <code>XMM0</code></li>
</ul>
<table>
<colgroup>
<col style="width: 35%"></col>
<col style="width: 64%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Parameter Type</th>
<th>How Passed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Floating Point</td>
<td>First 4 parameters - <code>XMM0</code> through to <code>XMM3</code>. Others are passed on the stack.</td>
</tr>
<tr class="even">
<td>Integer</td>
<td>First 4 parameters - <code>RCX</code>, <code>RDX</code>, <code>R8</code>, <code>R9</code>. Others are passed on the stack.</td>
</tr>
<tr class="odd">
<td>Aggregates (8, 16, 32 or 64 bit) and <code>__m64</code></td>
<td>First 4 parameters - <code>RCX</code>, <code>RDX</code>, <code>R8</code>, <code>R9</code>. Others are passed on the stack.</td>
</tr>
<tr class="even">
<td>Aggregates (other)</td>
<td>By pointer. First 4 parameters passed as pointers in <code>RCX</code>, <code>RDX</code>, <code>R8</code> and <code>R9</code>.</td>
</tr>
<tr class="odd">
<td><code>__m128</code></td>
<td>By pointer. First 4 parameters passed as pointers in <code>RCX</code>, <code>RDX</code>, <code>R8</code> and <code>R9</code>.</td>
</tr>
</tbody>
</table>
<p>The stack is handled in the following ways:</p>
<ul>
<li>Cleaning up the stack is done by the caller. The callee calls the <code>ret</code> instruction, only cleaning up the stack for its own local usage.</li>
<li>The stack must be 16-byte aligned. The <code>call</code> instruction pushes an 8-byte return value, so all non-leaf functions must adjust the stack by a value of the form 16n+8 when allocating stack space. Non-leaf functions are those that might call other functions.</li>
<li>When calling a function, the minimum amount of stack used is 48 bytes (32 bytes for shadow parameters, 8 bytes for the <code>RIP</code> return instruction pointer and 8 bytes for 16-byte alignment.</li>
</ul>
<p>Returning structs by value that are greater than 64-bits are handled similarly to stdcall.</p>
<ul>
<li>The caller allocates space for the return struct.</li>
<li>The first parameter (so in <code>RCX</code>) contains the pointer to the struct being returned and is given to the callee.</li>
<li>All other parameters are shifted to the right by one. That is, the first parameter is now passed in <code>RDX</code>, up to the third parameter (<code>R8</code> and then <code>R9</code>) with remaining parameters pushed on to the stack.</li>
<li>On return, the <code>RAX</code> register contains the pointer to the struct being returned.</li>
<li>The caller is responsible for cleaning up the stack space allocated for the return struct, consistent with above.</li>
</ul>
<p>Variable argument lists are supported by the Windows 64-bit ABI.</p>
<h3 id="scratch-registers-1"><span class="header-section-number">4.2.3</span> Scratch Registers</h3>
<p>The following registers are considered scratch:</p>
<table>
<colgroup>
<col style="width: 35%"></col>
<col style="width: 64%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Register</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>RAX</code>, <code>XMM0</code></td>
<td>Return Value</td>
</tr>
<tr class="even">
<td><code>RCX</code>, <code>RDX</code>, <code>R8</code>, <code>R9</code></td>
<td>First, second, third and fourth argument</td>
</tr>
<tr class="odd">
<td><code>R10</code>, <code>R11</code></td>
<td>Used in syscall/sysret functions</td>
</tr>
<tr class="even">
<td><code>XMM0</code>, <code>XMM1</code>, <code>XMM2</code>, <code>XMM3</code></td>
<td>First, second, third and fourth floating point argument</td>
</tr>
<tr class="odd">
<td><code>XMM4</code>, <code>XMM5</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>The remaining registers must be preserved by the function call: <code>RBX</code>, <code>RDI</code>, <code>RSI</code>, <code>RBP</code>, <code>R12</code>-<code>R15</code>, <code>XMM6</code>-<code>XMM15</code>.</p>
<h3 id="examples-1"><span class="header-section-number">4.2.4</span> Examples</h3>
<p>A project is created in Visual Studio 2012, compiled as a standard Console program. The <code>dumpbin.exe</code> program is used to disassemble the compiled program. The project is compiled for Release with whole program optimisation turned off, so that functions between modules are not inlined.</p>
<h4 id="simplest-case-integer-return"><span class="header-section-number">4.2.4.1</span> Simplest Case, Integer Return</h4>
<p>The simplest case shows how integers are returned in <code>RAX</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb24-1" title="1"><span class="dt">int</span>  myFunc(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb24-2" title="2">{</a>
<a class="sourceLine" id="cb24-3" title="3">  <span class="cf">return</span> <span class="dv">42</span>;</a>
<a class="sourceLine" id="cb24-4" title="4">}</a>
<a class="sourceLine" id="cb24-5" title="5"></a>
<a class="sourceLine" id="cb24-6" title="6"><span class="dt">int</span> _tmain(<span class="dt">int</span> argc, _TCHAR* argv[])</a>
<a class="sourceLine" id="cb24-7" title="7">{</a>
<a class="sourceLine" id="cb24-8" title="8">  <span class="cf">return</span> myFunc();</a>
<a class="sourceLine" id="cb24-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb25-1" title="1"><span class="fu">wmain:</span></a>
<a class="sourceLine" id="cb25-2" title="2"><span class="fu">  0000000140001000:</span> <span class="dv">48</span> <span class="dv">83</span> EC <span class="dv">28</span>        <span class="bu">sub</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb25-3" title="3"><span class="fu">  0000000140001004:</span> E8 <span class="dv">17</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        myFunc</a>
<a class="sourceLine" id="cb25-4" title="4"><span class="fu">  0000000140001009:</span> <span class="dv">83</span> C0 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb25-5" title="5"><span class="fu">  000000014000100C:</span> <span class="dv">48</span> <span class="dv">83</span> C4 <span class="dv">28</span>        <span class="bu">add</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb25-6" title="6"><span class="fu">  0000000140001010:</span> C3                 <span class="bu">ret</span></a>
<a class="sourceLine" id="cb25-7" title="7"></a>
<a class="sourceLine" id="cb25-8" title="8"><span class="fu">myFunc:</span></a>
<a class="sourceLine" id="cb25-9" title="9"><span class="fu">  0000000140001020:</span> B8 2A <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">mov</span>         <span class="kw">eax</span><span class="bn">,2Ah</span></a>
<a class="sourceLine" id="cb25-10" title="10"><span class="fu">  0000000140001025:</span> C3                 <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The return value is provided in <code>RAX</code> in the lower 32-bits (<code>EAX</code>). The <code>mov</code> instruction sign extends to the upper 32-bits in 64-bit mode.</li>
<li>Stack space for 32 bytes are allocated (the first four parameters), plus 8 bytes, so that with the <code>call</code> instruction, the stack is aligned to 16-bytes by the callee.</li>
</ul>
<p>The stack in the caller, based on <code>RSP</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RSP+40]</code></td>
<td>not used</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+32]</code></td>
<td>Shadow parameter 4 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+24]</code></td>
<td>Shadow parameter 3 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+16]</code></td>
<td>Shadow parameter 2 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+8]</code></td>
<td>Shadow parameter 1 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="odd">
<td><code>xxx ptr [RSP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<h4 id="bit-return-value-1"><span class="header-section-number">4.2.4.2</span> 64-bit return value</h4>
<div class="sourceCode" id="cb26"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb26-1" title="1">__int64 myFunc(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb26-2" title="2">{</a>
<a class="sourceLine" id="cb26-3" title="3">  <span class="cf">return</span> <span class="bn">0x12345678ABCDEF01</span><span class="bu">L</span>;</a>
<a class="sourceLine" id="cb26-4" title="4">}</a>
<a class="sourceLine" id="cb26-5" title="5"></a>
<a class="sourceLine" id="cb26-6" title="6"><span class="dt">int</span> _tmain(<span class="dt">int</span> argc, _TCHAR* argv[])</a>
<a class="sourceLine" id="cb26-7" title="7">{</a>
<a class="sourceLine" id="cb26-8" title="8">  <span class="cf">return</span> (<span class="dt">int</span>)myFunc() + <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb26-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb27-1" title="1"><span class="fu">wmain:</span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="fu">  0000000140001000:</span> <span class="dv">48</span> <span class="dv">83</span> EC <span class="dv">28</span>        <span class="bu">sub</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb27-3" title="3"><span class="fu">  0000000140001004:</span> E8 <span class="dv">17</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        myFunc</a>
<a class="sourceLine" id="cb27-4" title="4"><span class="fu">  0000000140001009:</span> <span class="dv">83</span> C0 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb27-5" title="5"><span class="fu">  000000014000100C:</span> <span class="dv">48</span> <span class="dv">83</span> C4 <span class="dv">28</span>        <span class="bu">add</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb27-6" title="6"><span class="fu">  0000000140001010:</span> C3                 <span class="bu">ret</span></a>
<a class="sourceLine" id="cb27-7" title="7"></a>
<a class="sourceLine" id="cb27-8" title="8"><span class="fu">myFunc:</span></a>
<a class="sourceLine" id="cb27-9" title="9"><span class="fu">  0000000140001020:</span> <span class="dv">48</span> B8 <span class="dv">01</span> EF CD AB  <span class="bu">mov</span>         <span class="kw">rax</span><span class="bn">,12345678ABCDEF01h</span></a>
<a class="sourceLine" id="cb27-10" title="10">                    <span class="dv">78</span> <span class="dv">56</span> <span class="dv">34</span> <span class="dv">12</span></a>
<a class="sourceLine" id="cb27-11" title="11"><span class="fu">  000000014000102A:</span> C3                 <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The return value is provided in <code>RAX</code>.</li>
<li>Stack space for 32 bytes are allocated (the first four parameters), plus 8 bytes, so that with the <code>call</code> instruction, the stack is aligned to 16-bytes by the callee.</li>
</ul>
<p>The stack in the caller, based on <code>RSP</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RSP+40]</code></td>
<td>not used</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+32]</code></td>
<td>Shadow parameter 4 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+24]</code></td>
<td>Shadow parameter 3 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+16]</code></td>
<td>Shadow parameter 2 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+8]</code></td>
<td>Shadow parameter 1 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="odd">
<td><code>xxx ptr [RSP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<h4 id="two-integers-1"><span class="header-section-number">4.2.4.3</span> Two Integers</h4>
<div class="sourceCode" id="cb28"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb28-1" title="1"><span class="dt">int</span> myFunc(<span class="dt">int</span> a, <span class="dt">int</span> b)</a>
<a class="sourceLine" id="cb28-2" title="2">{</a>
<a class="sourceLine" id="cb28-3" title="3">  <span class="cf">return</span> (a + <span class="dv">1</span>) * (b + <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb28-4" title="4">}</a>
<a class="sourceLine" id="cb28-5" title="5"></a>
<a class="sourceLine" id="cb28-6" title="6"><span class="dt">int</span> _tmain(<span class="dt">int</span> argc, _TCHAR* argv[])</a>
<a class="sourceLine" id="cb28-7" title="7">{</a>
<a class="sourceLine" id="cb28-8" title="8">  <span class="cf">return</span> myFunc(<span class="dv">1</span>, <span class="dv">2</span>) + <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb28-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb29-1" title="1"><span class="fu">wmain:</span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="fu">  0000000140001000:</span> <span class="dv">48</span> <span class="dv">83</span> EC <span class="dv">28</span>        <span class="bu">sub</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb29-3" title="3"><span class="fu">  0000000140001004:</span> BA <span class="dv">02</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">mov</span>         <span class="kw">edx</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb29-4" title="4"><span class="fu">  0000000140001009:</span> 8D 4A FF           <span class="bu">lea</span>         <span class="kw">ecx</span>,[<span class="kw">rdx</span><span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb29-5" title="5"><span class="fu">  000000014000100C:</span> E8 0F <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        myFunc</a>
<a class="sourceLine" id="cb29-6" title="6"><span class="fu">  0000000140001011:</span> <span class="dv">83</span> C0 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb29-7" title="7"><span class="fu">  0000000140001014:</span> <span class="dv">48</span> <span class="dv">83</span> C4 <span class="dv">28</span>        <span class="bu">add</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb29-8" title="8"><span class="fu">  0000000140001018:</span> C3                 <span class="bu">ret</span></a>
<a class="sourceLine" id="cb29-9" title="9"></a>
<a class="sourceLine" id="cb29-10" title="10"><span class="fu">myFunc:</span></a>
<a class="sourceLine" id="cb29-11" title="11"><span class="fu">  0000000140001020:</span> 8D <span class="dv">41</span> <span class="dv">01</span>           <span class="bu">lea</span>         <span class="kw">eax</span>,[<span class="kw">rcx</span>+<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb29-12" title="12"><span class="fu">  0000000140001023:</span> 8D 4A <span class="dv">02</span>           <span class="bu">lea</span>         <span class="kw">ecx</span>,[<span class="kw">rdx</span>+<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb29-13" title="13"><span class="fu">  0000000140001026:</span> 0F AF C1           <span class="bu">imul</span>        <span class="kw">eax</span>,<span class="kw">ecx</span></a>
<a class="sourceLine" id="cb29-14" title="14"><span class="fu">  0000000140001029:</span> C3                 <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>Stack space for 32 bytes are allocated (the first four parameters), plus 8 bytes, so that with the <code>call</code> instruction, the stack is aligned to 16-bytes by the callee.</li>
<li>The register <code>RCX</code> contains the first parameter with the value 1. The upper 32-bits are undefined (as the type is a 32-bit value).</li>
<li>The register <code>RDX</code> contains the second parameter, the upper 32-bits are undefined (as the type is a 32-bit value).</li>
</ul>
<p>The stack in the caller, based on <code>RSP</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RSP+40]</code></td>
<td>not used</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+32]</code></td>
<td>Shadow parameter 4 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+24]</code></td>
<td>Shadow parameter 3 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+16]</code></td>
<td>Shadow parameter 2 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+8]</code></td>
<td>Shadow parameter 1 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="odd">
<td><code>xxx ptr [RSP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<h4 id="mixed-floats-and-integers-1"><span class="header-section-number">4.2.4.4</span> Mixed Floats and Integers</h4>
<div class="sourceCode" id="cb30"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb30-1" title="1"><span class="dt">int</span> myFunc(<span class="dt">float</span> a, <span class="dt">int</span> b, <span class="dt">float</span> c, <span class="dt">int</span> d)</a>
<a class="sourceLine" id="cb30-2" title="2">{</a>
<a class="sourceLine" id="cb30-3" title="3">  <span class="cf">return</span> (a + <span class="dv">1</span>) * (b + <span class="dv">2</span>) + (c + <span class="dv">3</span>) * (d + <span class="dv">4</span>);</a>
<a class="sourceLine" id="cb30-4" title="4">}</a>
<a class="sourceLine" id="cb30-5" title="5"></a>
<a class="sourceLine" id="cb30-6" title="6"><span class="dt">int</span> _tmain(<span class="dt">int</span> argc, _TCHAR* argv[])</a>
<a class="sourceLine" id="cb30-7" title="7">{</a>
<a class="sourceLine" id="cb30-8" title="8">  <span class="cf">return</span> myFunc(<span class="fl">1.0</span>, <span class="dv">2</span>, <span class="fl">3.0</span>, <span class="dv">4</span>) + <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb30-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb31-1" title="1"><span class="fu">wmain:</span></a>
<a class="sourceLine" id="cb31-2" title="2"><span class="fu">  0000000140001000:</span> <span class="dv">48</span> <span class="dv">83</span> EC <span class="dv">28</span>        <span class="bu">sub</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb31-3" title="3"><span class="fu">  0000000140001004:</span> F3 0F <span class="dv">10</span> <span class="dv">15</span> <span class="dv">60</span> <span class="dv">11</span>  <span class="bu">movss</span>       <span class="kw">xmm2</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@<span class="dv">40400000</span>]</a>
<a class="sourceLine" id="cb31-4" title="4">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb31-5" title="5"><span class="fu">  000000014000100C:</span> F3 0F <span class="dv">10</span> <span class="dv">05</span> <span class="dv">54</span> <span class="dv">11</span>  <span class="bu">movss</span>       <span class="kw">xmm0</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@3f800000]</a>
<a class="sourceLine" id="cb31-6" title="6">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb31-7" title="7"><span class="fu">  0000000140001014:</span> <span class="dv">41</span> B9 <span class="dv">04</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         r9d,<span class="dv">4</span></a>
<a class="sourceLine" id="cb31-8" title="8"><span class="fu">  000000014000101A:</span> <span class="dv">41</span> 8D <span class="dv">51</span> FE        <span class="bu">lea</span>         <span class="kw">edx</span>,[<span class="kw">r9</span><span class="dv">-2</span>]</a>
<a class="sourceLine" id="cb31-9" title="9"><span class="fu">  000000014000101E:</span> E8 0D <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        myFunc</a>
<a class="sourceLine" id="cb31-10" title="10"><span class="fu">  0000000140001023:</span> <span class="dv">83</span> C0 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb31-11" title="11"><span class="fu">  0000000140001026:</span> <span class="dv">48</span> <span class="dv">83</span> C4 <span class="dv">28</span>        <span class="bu">add</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb31-12" title="12"><span class="fu">  000000014000102A:</span> C3                 <span class="bu">ret</span></a>
<a class="sourceLine" id="cb31-13" title="13"></a>
<a class="sourceLine" id="cb31-14" title="14"><span class="fu">myFunc:</span></a>
<a class="sourceLine" id="cb31-15" title="15"><span class="fu">  0000000140001030:</span> F3 0F <span class="dv">58</span> <span class="dv">05</span> <span class="dv">30</span> <span class="dv">11</span>  <span class="bu">addss</span>       <span class="kw">xmm0</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@3f800000]</a>
<a class="sourceLine" id="cb31-16" title="16">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb31-17" title="17"><span class="fu">  0000000140001038:</span> F3 0F <span class="dv">58</span> <span class="dv">15</span> 2C <span class="dv">11</span>  <span class="bu">addss</span>       <span class="kw">xmm2</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@<span class="dv">40400000</span>]</a>
<a class="sourceLine" id="cb31-18" title="18">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb31-19" title="19"><span class="fu">  0000000140001040:</span> 8D <span class="dv">42</span> <span class="dv">02</span>           <span class="bu">lea</span>         <span class="kw">eax</span>,[<span class="kw">rdx</span>+<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb31-20" title="20"><span class="fu">  0000000140001043:</span> <span class="dv">66</span> 0F 6E C8        <span class="bu">movd</span>        <span class="kw">xmm1</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb31-21" title="21"><span class="fu">  0000000140001047:</span> <span class="dv">41</span> 8D <span class="dv">41</span> <span class="dv">04</span>        <span class="bu">lea</span>         <span class="kw">eax</span>,[<span class="kw">r9</span>+<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb31-22" title="22"><span class="fu">  000000014000104B:</span> 0F 5B C9           <span class="bu">cvtdq2ps</span>    <span class="kw">xmm1</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb31-23" title="23"><span class="fu">  000000014000104E:</span> F3 0F <span class="dv">59</span> C1        <span class="bu">mulss</span>       <span class="kw">xmm0</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb31-24" title="24"><span class="fu">  0000000140001052:</span> <span class="dv">66</span> 0F 6E C8        <span class="bu">movd</span>        <span class="kw">xmm1</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb31-25" title="25"><span class="fu">  0000000140001056:</span> 0F 5B C9           <span class="bu">cvtdq2ps</span>    <span class="kw">xmm1</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb31-26" title="26"><span class="fu">  0000000140001059:</span> F3 0F <span class="dv">59</span> D1        <span class="bu">mulss</span>       <span class="kw">xmm2</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb31-27" title="27"><span class="fu">  000000014000105D:</span> F3 0F <span class="dv">58</span> C2        <span class="bu">addss</span>       <span class="kw">xmm0</span>,<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb31-28" title="28"><span class="fu">  0000000140001061:</span> F3 0F 2C C0        <span class="bu">cvttss2si</span>   <span class="kw">eax</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb31-29" title="29"><span class="fu">  0000000140001065:</span> C3                 <span class="bu">ret</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>Parameter 1 is in <code>XMM0</code>, parameter 2 is in <code>RDX</code>, parameter 3 is in <code>XMM2</code> and parameter 4 is in <code>R9</code>.</li>
<li>Enough stack space is allocated for the four parameters, plus 8 bytes to align the stack in the caller by 16-bytes.</li>
<li>The 32-bit return value is given in <code>RAX</code>.</li>
</ul>
<h4 id="mixed-floats-and-integers-5-parameters"><span class="header-section-number">4.2.4.5</span> Mixed Floats and Integers, 5 parameters</h4>
<div class="sourceCode" id="cb32"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb32-1" title="1"><span class="dt">int</span> myFunc(<span class="dt">float</span> a, <span class="dt">int</span> b, <span class="dt">float</span> c, <span class="dt">int</span> d, <span class="dt">float</span> e)</a>
<a class="sourceLine" id="cb32-2" title="2">{</a>
<a class="sourceLine" id="cb32-3" title="3">  <span class="cf">return</span> (<span class="dt">int</span>)((a + <span class="fl">1.0</span>) * (b + <span class="dv">2</span>) + (c + <span class="fl">3.0</span>) * (d + <span class="dv">4</span>) * (e * <span class="fl">5.0</span>));</a>
<a class="sourceLine" id="cb32-4" title="4">}</a>
<a class="sourceLine" id="cb32-5" title="5"></a>
<a class="sourceLine" id="cb32-6" title="6"><span class="dt">int</span> _tmain(<span class="dt">int</span> argc, _TCHAR* argv[])</a>
<a class="sourceLine" id="cb32-7" title="7">{</a>
<a class="sourceLine" id="cb32-8" title="8">  <span class="cf">return</span> myFunc(<span class="fl">1.0</span>, <span class="dv">2</span>, <span class="fl">3.0</span>, <span class="dv">4</span>, <span class="fl">5.0</span>) + <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb32-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb33-1" title="1"><span class="fu">wmain:</span></a>
<a class="sourceLine" id="cb33-2" title="2"><span class="fu">  0000000140001000:</span> <span class="dv">48</span> <span class="dv">83</span> EC <span class="dv">38</span>        <span class="bu">sub</span>         <span class="kw">rsp</span><span class="bn">,38h</span></a>
<a class="sourceLine" id="cb33-3" title="3"><span class="fu">  0000000140001004:</span> F3 0F <span class="dv">10</span> <span class="dv">05</span> <span class="dv">64</span> <span class="dv">11</span>  <span class="bu">movss</span>       <span class="kw">xmm0</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@40a00000]</a>
<a class="sourceLine" id="cb33-4" title="4">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb33-5" title="5"><span class="fu">  000000014000100C:</span> F3 0F <span class="dv">10</span> <span class="dv">15</span> <span class="dv">58</span> <span class="dv">11</span>  <span class="bu">movss</span>       <span class="kw">xmm2</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@<span class="dv">40400000</span>]</a>
<a class="sourceLine" id="cb33-6" title="6">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb33-7" title="7"><span class="fu">  0000000140001014:</span> <span class="dv">41</span> B9 <span class="dv">04</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         r9d,<span class="dv">4</span></a>
<a class="sourceLine" id="cb33-8" title="8"><span class="fu">  000000014000101A:</span> <span class="dv">41</span> 8D <span class="dv">51</span> FE        <span class="bu">lea</span>         <span class="kw">edx</span>,[<span class="kw">r9</span><span class="dv">-2</span>]</a>
<a class="sourceLine" id="cb33-9" title="9"><span class="fu">  000000014000101E:</span> F3 0F <span class="dv">11</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">20</span>  <span class="bu">movss</span>       <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+20h],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb33-10" title="10"><span class="fu">  0000000140001024:</span> F3 0F <span class="dv">10</span> <span class="dv">05</span> 3C <span class="dv">11</span>  <span class="bu">movss</span>       <span class="kw">xmm0</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@3f800000]</a>
<a class="sourceLine" id="cb33-11" title="11">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb33-12" title="12"><span class="fu">  000000014000102C:</span> E8 0F <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        myFunc</a>
<a class="sourceLine" id="cb33-13" title="13"><span class="fu">  0000000140001031:</span> <span class="dv">83</span> C0 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb33-14" title="14"><span class="fu">  0000000140001034:</span> <span class="dv">48</span> <span class="dv">83</span> C4 <span class="dv">38</span>        <span class="bu">add</span>         <span class="kw">rsp</span><span class="bn">,38h</span></a>
<a class="sourceLine" id="cb33-15" title="15"><span class="fu">  0000000140001038:</span> C3                 <span class="bu">ret</span></a>
<a class="sourceLine" id="cb33-16" title="16"></a>
<a class="sourceLine" id="cb33-17" title="17"><span class="fu">myFunc:</span></a>
<a class="sourceLine" id="cb33-18" title="18"><span class="fu">  0000000140001040:</span> 0F <span class="dv">57</span> <span class="dt">DB</span>           <span class="bu">xorps</span>       <span class="kw">xmm3</span>,<span class="kw">xmm3</span></a>
<a class="sourceLine" id="cb33-19" title="19"><span class="fu">  0000000140001043:</span> <span class="dv">41</span> 8D <span class="dv">41</span> <span class="dv">04</span>        <span class="bu">lea</span>         <span class="kw">eax</span>,[<span class="kw">r9</span>+<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb33-20" title="20"><span class="fu">  0000000140001047:</span> F3 0F 5A DA        <span class="bu">cvtss2sd</span>    <span class="kw">xmm3</span>,<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb33-21" title="21"><span class="fu">  000000014000104B:</span> F3 0F <span class="dv">10</span> <span class="dv">54</span> <span class="dv">24</span> <span class="dv">28</span>  <span class="bu">movss</span>       <span class="kw">xmm2</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+28h]</a>
<a class="sourceLine" id="cb33-22" title="22"><span class="fu">  0000000140001051:</span> <span class="dv">66</span> 0F 6E C8        <span class="bu">movd</span>        <span class="kw">xmm1</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb33-23" title="23"><span class="fu">  0000000140001055:</span> 8D <span class="dv">42</span> <span class="dv">02</span>           <span class="bu">lea</span>         <span class="kw">eax</span>,[<span class="kw">rdx</span>+<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb33-24" title="24"><span class="fu">  0000000140001058:</span> F2 0F <span class="dv">58</span> 1D <span class="dv">20</span> <span class="dv">11</span>  <span class="bu">addsd</span>       <span class="kw">xmm3</span>,mmword <span class="dt">ptr</span> [__real@<span class="dv">4008000000000000</span>]</a>
<a class="sourceLine" id="cb33-25" title="25">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb33-26" title="26"><span class="fu">  0000000140001060:</span> 0F 5A D2           <span class="bu">cvtps2pd</span>    <span class="kw">xmm2</span>,<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb33-27" title="27"><span class="fu">  0000000140001063:</span> F2 0F <span class="dv">59</span> <span class="dv">15</span> 1D <span class="dv">11</span>  <span class="bu">mulsd</span>       <span class="kw">xmm2</span>,mmword <span class="dt">ptr</span> [__real@<span class="dv">4014000000000000</span>]</a>
<a class="sourceLine" id="cb33-28" title="28">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb33-29" title="29"><span class="fu">  000000014000106B:</span> F3 0F E6 C9        <span class="bu">cvtdq2pd</span>    <span class="kw">xmm1</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb33-30" title="30"><span class="fu">  000000014000106F:</span> F2 0F <span class="dv">59</span> D9        <span class="bu">mulsd</span>       <span class="kw">xmm3</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb33-31" title="31"><span class="fu">  0000000140001073:</span> 0F <span class="dv">57</span> C9           <span class="bu">xorps</span>       <span class="kw">xmm1</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb33-32" title="32"><span class="fu">  0000000140001076:</span> F3 0F 5A C8        <span class="bu">cvtss2sd</span>    <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb33-33" title="33"><span class="fu">  000000014000107A:</span> <span class="dv">66</span> 0F 6E C0        <span class="bu">movd</span>        <span class="kw">xmm0</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb33-34" title="34"><span class="fu">  000000014000107E:</span> F2 0F <span class="dv">58</span> 0D F2 <span class="dv">10</span>  <span class="bu">addsd</span>       <span class="kw">xmm1</span>,mmword <span class="dt">ptr</span> [__real@3ff0000000000000]</a>
<a class="sourceLine" id="cb33-35" title="35">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb33-36" title="36"><span class="fu">  0000000140001086:</span> F2 0F <span class="dv">59</span> DA        <span class="bu">mulsd</span>       <span class="kw">xmm3</span>,<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb33-37" title="37"><span class="fu">  000000014000108A:</span> F3 0F E6 C0        <span class="bu">cvtdq2pd</span>    <span class="kw">xmm0</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb33-38" title="38"><span class="fu">  000000014000108E:</span> F2 0F <span class="dv">59</span> C8        <span class="bu">mulsd</span>       <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb33-39" title="39"><span class="fu">  0000000140001092:</span> F2 0F <span class="dv">58</span> D9        <span class="bu">addsd</span>       <span class="kw">xmm3</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb33-40" title="40"><span class="fu">  0000000140001096:</span> F2 0F 2C C3        <span class="bu">cvttsd2si</span>   <span class="kw">eax</span>,<span class="kw">xmm3</span></a>
<a class="sourceLine" id="cb33-41" title="41"><span class="fu">  000000014000109A:</span> C3                 <span class="bu">ret</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>Parameter 1 is in <code>XMM0</code>, parameter 2 is in <code>RDX</code>, parameter 3 is in <code>XMM2</code> and parameter 4 is in <code>R9</code>.</li>
<li>Enough stack space is allocated for the four parameters, plus 16 bytes.</li>
<li>The fifth parameter is pushed on the stack at instruction 14000101E.</li>
<li>The 32-bit return value is given in <code>RAX</code>.</li>
<li>Register <code>XMM3</code> is considered scratch in the callee.</li>
</ul>
<p>The stack in the caller, based on <code>RSP</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RSP+56]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+48]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+40]</code></td>
<td>Parameter 5 (at instruction 14000101E)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+32]</code></td>
<td>Shadow parameter 4 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+24]</code></td>
<td>Shadow parameter 3 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+16]</code></td>
<td>Shadow parameter 2 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+8]</code></td>
<td>Shadow parameter 1 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="odd">
<td><code>xxx ptr [RSP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<h4 id="mixed-floats-and-integers-6-parameters"><span class="header-section-number">4.2.4.6</span> Mixed Floats and Integers, 6 parameters</h4>
<p>The ordering of parameters after the 4th parameter are shown in this example.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb34-1" title="1"><span class="dt">int</span> myFunc(<span class="dt">float</span> a, <span class="dt">int</span> b, <span class="dt">float</span> c, <span class="dt">int</span> d, <span class="dt">float</span> e, <span class="dt">double</span> f)</a>
<a class="sourceLine" id="cb34-2" title="2">{</a>
<a class="sourceLine" id="cb34-3" title="3">  <span class="cf">return</span> (<span class="dt">int</span>)((a + <span class="fl">1.0</span>) * (b + <span class="dv">2</span>) + (c + <span class="fl">3.0</span>) * (d + <span class="dv">4</span>) * (e * <span class="fl">5.0</span>) * f);</a>
<a class="sourceLine" id="cb34-4" title="4">}</a>
<a class="sourceLine" id="cb34-5" title="5"></a>
<a class="sourceLine" id="cb34-6" title="6"><span class="dt">int</span> _tmain(<span class="dt">int</span> argc, _TCHAR* argv[])</a>
<a class="sourceLine" id="cb34-7" title="7">{</a>
<a class="sourceLine" id="cb34-8" title="8">  <span class="cf">return</span> myFunc(<span class="fl">1.0</span>, <span class="dv">2</span>, <span class="fl">3.0</span>, <span class="dv">4</span>, <span class="fl">5.0</span>, <span class="fl">6.0</span>) + <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb34-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb35-1" title="1"><span class="fu">wmain:</span></a>
<a class="sourceLine" id="cb35-2" title="2"><span class="fu">  0000000140001000:</span> <span class="dv">48</span> <span class="dv">83</span> EC <span class="dv">38</span>        <span class="bu">sub</span>         <span class="kw">rsp</span><span class="bn">,38h</span></a>
<a class="sourceLine" id="cb35-3" title="3"><span class="fu">  0000000140001004:</span> F2 0F <span class="dv">10</span> <span class="dv">05</span> <span class="dv">64</span> <span class="dv">11</span>  <span class="bu">movsd</span>       <span class="kw">xmm0</span>,mmword <span class="dt">ptr</span> [__real@<span class="dv">4018000000000000</span>]</a>
<a class="sourceLine" id="cb35-4" title="4">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb35-5" title="5"><span class="fu">  000000014000100C:</span> F3 0F <span class="dv">10</span> 0D <span class="dv">68</span> <span class="dv">11</span>  <span class="bu">movss</span>       <span class="kw">xmm1</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@40a00000]</a>
<a class="sourceLine" id="cb35-6" title="6">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb35-7" title="7"><span class="fu">  0000000140001014:</span> F3 0F <span class="dv">10</span> <span class="dv">15</span> 5C <span class="dv">11</span>  <span class="bu">movss</span>       <span class="kw">xmm2</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@<span class="dv">40400000</span>]</a>
<a class="sourceLine" id="cb35-8" title="8">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb35-9" title="9"><span class="fu">  000000014000101C:</span> <span class="dv">41</span> B9 <span class="dv">04</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         r9d,<span class="dv">4</span></a>
<a class="sourceLine" id="cb35-10" title="10"><span class="fu">  0000000140001022:</span> <span class="dv">41</span> 8D <span class="dv">51</span> FE        <span class="bu">lea</span>         <span class="kw">edx</span>,[<span class="kw">r9</span><span class="dv">-2</span>]</a>
<a class="sourceLine" id="cb35-11" title="11"><span class="fu">  0000000140001026:</span> F2 0F <span class="dv">11</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">28</span>  <span class="bu">movsd</span>       mmword <span class="dt">ptr</span> [<span class="kw">rsp</span>+28h],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb35-12" title="12"><span class="fu">  000000014000102C:</span> F3 0F <span class="dv">10</span> <span class="dv">05</span> <span class="dv">34</span> <span class="dv">11</span>  <span class="bu">movss</span>       <span class="kw">xmm0</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [__real@3f800000]</a>
<a class="sourceLine" id="cb35-13" title="13">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb35-14" title="14"><span class="fu">  0000000140001034:</span> F3 0F <span class="dv">11</span> 4C <span class="dv">24</span> <span class="dv">20</span>  <span class="bu">movss</span>       <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+20h],<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb35-15" title="15"><span class="fu">  000000014000103A:</span> E8 <span class="dv">11</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        myFunc</a>
<a class="sourceLine" id="cb35-16" title="16"><span class="fu">  000000014000103F:</span> <span class="dv">83</span> C0 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb35-17" title="17"><span class="fu">  0000000140001042:</span> <span class="dv">48</span> <span class="dv">83</span> C4 <span class="dv">38</span>        <span class="bu">add</span>         <span class="kw">rsp</span><span class="bn">,38h</span></a>
<a class="sourceLine" id="cb35-18" title="18"><span class="fu">  0000000140001046:</span> C3                 <span class="bu">ret</span></a>
<a class="sourceLine" id="cb35-19" title="19"></a>
<a class="sourceLine" id="cb35-20" title="20"><span class="fu">myFunc:</span></a>
<a class="sourceLine" id="cb35-21" title="21"><span class="fu">  0000000140001050:</span> 0F <span class="dv">57</span> <span class="dt">DB</span>           <span class="bu">xorps</span>       <span class="kw">xmm3</span>,<span class="kw">xmm3</span></a>
<a class="sourceLine" id="cb35-22" title="22"><span class="fu">  0000000140001053:</span> <span class="dv">41</span> 8D <span class="dv">41</span> <span class="dv">04</span>        <span class="bu">lea</span>         <span class="kw">eax</span>,[<span class="kw">r9</span>+<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb35-23" title="23"><span class="fu">  0000000140001057:</span> F3 0F 5A DA        <span class="bu">cvtss2sd</span>    <span class="kw">xmm3</span>,<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb35-24" title="24"><span class="fu">  000000014000105B:</span> F3 0F <span class="dv">10</span> <span class="dv">54</span> <span class="dv">24</span> <span class="dv">28</span>  <span class="bu">movss</span>       <span class="kw">xmm2</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+28h]</a>
<a class="sourceLine" id="cb35-25" title="25"><span class="fu">  0000000140001061:</span> <span class="dv">66</span> 0F 6E C8        <span class="bu">movd</span>        <span class="kw">xmm1</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb35-26" title="26"><span class="fu">  0000000140001065:</span> 8D <span class="dv">42</span> <span class="dv">02</span>           <span class="bu">lea</span>         <span class="kw">eax</span>,[<span class="kw">rdx</span>+<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb35-27" title="27"><span class="fu">  0000000140001068:</span> F2 0F <span class="dv">58</span> 1D <span class="dv">18</span> <span class="dv">11</span>  <span class="bu">addsd</span>       <span class="kw">xmm3</span>,mmword <span class="dt">ptr</span> [__real@<span class="dv">4008000000000000</span>]</a>
<a class="sourceLine" id="cb35-28" title="28">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb35-29" title="29"><span class="fu">  0000000140001070:</span> 0F 5A D2           <span class="bu">cvtps2pd</span>    <span class="kw">xmm2</span>,<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb35-30" title="30"><span class="fu">  0000000140001073:</span> F2 0F <span class="dv">59</span> <span class="dv">15</span> <span class="dv">15</span> <span class="dv">11</span>  <span class="bu">mulsd</span>       <span class="kw">xmm2</span>,mmword <span class="dt">ptr</span> [__real@<span class="dv">4014000000000000</span>]</a>
<a class="sourceLine" id="cb35-31" title="31">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb35-32" title="32"><span class="fu">  000000014000107B:</span> F3 0F E6 C9        <span class="bu">cvtdq2pd</span>    <span class="kw">xmm1</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb35-33" title="33"><span class="fu">  000000014000107F:</span> F2 0F <span class="dv">59</span> D9        <span class="bu">mulsd</span>       <span class="kw">xmm3</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb35-34" title="34"><span class="fu">  0000000140001083:</span> 0F <span class="dv">57</span> C9           <span class="bu">xorps</span>       <span class="kw">xmm1</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb35-35" title="35"><span class="fu">  0000000140001086:</span> F3 0F 5A C8        <span class="bu">cvtss2sd</span>    <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb35-36" title="36"><span class="fu">  000000014000108A:</span> <span class="dv">66</span> 0F 6E C0        <span class="bu">movd</span>        <span class="kw">xmm0</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb35-37" title="37"><span class="fu">  000000014000108E:</span> F2 0F <span class="dv">58</span> 0D EA <span class="dv">10</span>  <span class="bu">addsd</span>       <span class="kw">xmm1</span>,mmword <span class="dt">ptr</span> [__real@3ff0000000000000]</a>
<a class="sourceLine" id="cb35-38" title="38">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb35-39" title="39"><span class="fu">  0000000140001096:</span> F2 0F <span class="dv">59</span> DA        <span class="bu">mulsd</span>       <span class="kw">xmm3</span>,<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb35-40" title="40"><span class="fu">  000000014000109A:</span> F2 0F <span class="dv">59</span> 5C <span class="dv">24</span> <span class="dv">30</span>  <span class="bu">mulsd</span>       <span class="kw">xmm3</span>,mmword <span class="dt">ptr</span> [<span class="kw">rsp</span>+30h]</a>
<a class="sourceLine" id="cb35-41" title="41"><span class="fu">  00000001400010A0:</span> F3 0F E6 C0        <span class="bu">cvtdq2pd</span>    <span class="kw">xmm0</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb35-42" title="42"><span class="fu">  00000001400010A4:</span> F2 0F <span class="dv">59</span> C8        <span class="bu">mulsd</span>       <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb35-43" title="43"><span class="fu">  00000001400010A8:</span> F2 0F <span class="dv">58</span> D9        <span class="bu">addsd</span>       <span class="kw">xmm3</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb35-44" title="44"><span class="fu">  00000001400010AC:</span> F2 0F 2C C3        <span class="bu">cvttsd2si</span>   <span class="kw">eax</span>,<span class="kw">xmm3</span></a>
<a class="sourceLine" id="cb35-45" title="45"><span class="fu">  00000001400010B0:</span> C3                 <span class="bu">ret</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>Parameter 1 is in <code>XMM0</code>, parameter 2 is in <code>RDX</code>, parameter 3 is in <code>XMM2</code> and parameter 4 is in <code>R9</code>.</li>
<li>Enough stack space is allocated for the four parameters, plus 8 bytes to align the stack in the caller by 16-bytes.</li>
<li>The fifth parameter is pushed on the stack at instruction <code>14000101E</code>.</li>
<li>The 32-bit return value is given in <code>RAX</code>.</li>
<li>Register <code>XMM3</code> is considered scratch in the callee.</li>
</ul>
<p>The stack in the caller, based on <code>RSP</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RSP+56]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+48]</code></td>
<td>Parameter 6 (instruction 140001026)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+40]</code></td>
<td>Parameter 5 (instruction 140001034)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+32]</code></td>
<td>Shadow parameter 4 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+24]</code></td>
<td>Shadow parameter 3 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+16]</code></td>
<td>Shadow parameter 2 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+8]</code></td>
<td>Shadow parameter 1 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="odd">
<td><code>xxx ptr [RSP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<h4 id="doubles-1"><span class="header-section-number">4.2.4.7</span> Doubles</h4>
<p>We see that doubles are handled the same as floats.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb36-1" title="1"><span class="dt">double</span> myFunc(<span class="dt">double</span> a, <span class="dt">double</span> b)</a>
<a class="sourceLine" id="cb36-2" title="2">{</a>
<a class="sourceLine" id="cb36-3" title="3">  <span class="cf">return</span> (a + <span class="fl">1.0</span>) * (b + <span class="fl">2.0</span>);</a>
<a class="sourceLine" id="cb36-4" title="4">}</a>
<a class="sourceLine" id="cb36-5" title="5"></a>
<a class="sourceLine" id="cb36-6" title="6"><span class="dt">int</span> _tmain(<span class="dt">int</span> argc, _TCHAR* argv[])</a>
<a class="sourceLine" id="cb36-7" title="7">{</a>
<a class="sourceLine" id="cb36-8" title="8">  <span class="cf">return</span> (<span class="dt">int</span>)myFunc(<span class="fl">1.0</span>, <span class="fl">2.0</span>) + <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb36-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb37-1" title="1"><span class="fu">wmain:</span></a>
<a class="sourceLine" id="cb37-2" title="2"><span class="fu">  0000000140001000:</span> <span class="dv">48</span> <span class="dv">83</span> EC <span class="dv">28</span>        <span class="bu">sub</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb37-3" title="3"><span class="fu">  0000000140001004:</span> F2 0F <span class="dv">10</span> 0D <span class="dv">64</span> <span class="dv">11</span>  <span class="bu">movsd</span>       <span class="kw">xmm1</span>,mmword <span class="dt">ptr</span> [__real@<span class="dv">4000000000000000</span>]</a>
<a class="sourceLine" id="cb37-4" title="4">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb37-5" title="5"><span class="fu">  000000014000100C:</span> F2 0F <span class="dv">10</span> <span class="dv">05</span> <span class="dv">54</span> <span class="dv">11</span>  <span class="bu">movsd</span>       <span class="kw">xmm0</span>,mmword <span class="dt">ptr</span> [__real@3ff0000000000000]</a>
<a class="sourceLine" id="cb37-6" title="6">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb37-7" title="7"><span class="fu">  0000000140001014:</span> E8 <span class="dv">17</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        myFunc</a>
<a class="sourceLine" id="cb37-8" title="8"><span class="fu">  0000000140001019:</span> F2 0F 2C C0        <span class="bu">cvttsd2si</span>   <span class="kw">eax</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb37-9" title="9"><span class="fu">  000000014000101D:</span> <span class="dv">83</span> C0 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb37-10" title="10"><span class="fu">  0000000140001020:</span> <span class="dv">48</span> <span class="dv">83</span> C4 <span class="dv">28</span>        <span class="bu">add</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb37-11" title="11"><span class="fu">  0000000140001024:</span> C3                 <span class="bu">ret</span></a>
<a class="sourceLine" id="cb37-12" title="12"></a>
<a class="sourceLine" id="cb37-13" title="13"><span class="fu">myFunc:</span></a>
<a class="sourceLine" id="cb37-14" title="14"><span class="fu">  0000000140001030:</span> F2 0F <span class="dv">58</span> <span class="dv">05</span> <span class="dv">30</span> <span class="dv">11</span>  <span class="bu">addsd</span>       <span class="kw">xmm0</span>,mmword <span class="dt">ptr</span> [__real@3ff0000000000000]</a>
<a class="sourceLine" id="cb37-15" title="15">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb37-16" title="16"><span class="fu">  0000000140001038:</span> F2 0F <span class="dv">58</span> 0D <span class="dv">30</span> <span class="dv">11</span>  <span class="bu">addsd</span>       <span class="kw">xmm1</span>,mmword <span class="dt">ptr</span> [__real@<span class="dv">4000000000000000</span>]</a>
<a class="sourceLine" id="cb37-17" title="17">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb37-18" title="18"><span class="fu">  0000000140001040:</span> F2 0F <span class="dv">59</span> C1        <span class="bu">mulsd</span>       <span class="kw">xmm0</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb37-19" title="19"><span class="fu">  0000000140001044:</span> C3                 <span class="bu">ret</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>Parameter 1 is in <code>XMM0</code>, parameter 2 is in <code>XMM1</code>.</li>
<li>Enough stack space is allocated for the four parameters, plus 8 bytes to align the stack in the caller by 16-bytes.</li>
<li>The result is returned in <code>XMM0</code>. The caller then converts this to an integer as in <code>_tmain</code>.</li>
</ul>
<p>The stack in the caller, based on <code>RSP</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RSP+40]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+32]</code></td>
<td>Shadow parameter 4 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+24]</code></td>
<td>Shadow parameter 3 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+16]</code></td>
<td>Shadow parameter 2 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+8]</code></td>
<td>Shadow parameter 1 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="odd">
<td><code>xxx ptr [RSP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<h4 id="structs-by-value-1"><span class="header-section-number">4.2.4.8</span> Structs by Value</h4>
<p>A struct is passed as a pointer. The caller is responsible for making a copy of the original struct so if it’s modified by the callee, the changes aren’t propagated in the original copy.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb38-1" title="1"><span class="kw">struct</span> mystruct {</a>
<a class="sourceLine" id="cb38-2" title="2">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb38-3" title="3">  <span class="dt">int</span> b;</a>
<a class="sourceLine" id="cb38-4" title="4">  <span class="dt">int</span> c;</a>
<a class="sourceLine" id="cb38-5" title="5">  <span class="dt">int</span> d;</a>
<a class="sourceLine" id="cb38-6" title="6">  <span class="dt">int</span> e;</a>
<a class="sourceLine" id="cb38-7" title="7">  <span class="dt">int</span> f;</a>
<a class="sourceLine" id="cb38-8" title="8">};</a>
<a class="sourceLine" id="cb38-9" title="9"></a>
<a class="sourceLine" id="cb38-10" title="10"><span class="dt">int</span> myFunc(<span class="kw">struct</span> mystruct x, <span class="kw">struct</span> mystruct *y)</a>
<a class="sourceLine" id="cb38-11" title="11">{</a>
<a class="sourceLine" id="cb38-12" title="12">  <span class="cf">return</span> x.a + y-&gt;b;</a>
<a class="sourceLine" id="cb38-13" title="13">}</a>
<a class="sourceLine" id="cb38-14" title="14"></a>
<a class="sourceLine" id="cb38-15" title="15"><span class="dt">int</span> _tmain(<span class="dt">int</span> argc, _TCHAR* argv[])</a>
<a class="sourceLine" id="cb38-16" title="16">{</a>
<a class="sourceLine" id="cb38-17" title="17">  <span class="kw">struct</span> mystruct a = {<span class="dv">0</span>, };</a>
<a class="sourceLine" id="cb38-18" title="18">  <span class="kw">struct</span> mystruct b = {<span class="dv">0</span>, };</a>
<a class="sourceLine" id="cb38-19" title="19"></a>
<a class="sourceLine" id="cb38-20" title="20">  <span class="cf">return</span> myFunc(a, &amp;b) + <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb38-21" title="21">}</a></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb39-1" title="1"><span class="fu">wmain:</span></a>
<a class="sourceLine" id="cb39-2" title="2"><span class="fu">  0000000140001000:</span> 4C 8B DC           <span class="bu">mov</span>         <span class="kw">r11</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb39-3" title="3"><span class="fu">  0000000140001003:</span> <span class="dv">48</span> <span class="dv">81</span> EC <span class="dv">88</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">sub</span>         <span class="kw">rsp</span><span class="bn">,88h</span></a>
<a class="sourceLine" id="cb39-4" title="4">                    <span class="dv">00</span></a>
<a class="sourceLine" id="cb39-5" title="5"><span class="fu">  000000014000100A:</span> <span class="dv">48</span> 8B <span class="dv">05</span> EF 1F <span class="dv">00</span>  <span class="bu">mov</span>         <span class="kw">rax</span>,<span class="dt">qword</span> <span class="dt">ptr</span> [__security_cookie]</a>
<a class="sourceLine" id="cb39-6" title="6">                    <span class="dv">00</span></a>
<a class="sourceLine" id="cb39-7" title="7"><span class="fu">  0000000140001011:</span> <span class="dv">48</span> <span class="dv">33</span> C4           <span class="bu">xor</span>         <span class="kw">rax</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb39-8" title="8"><span class="fu">  0000000140001014:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">78</span>     <span class="bu">mov</span>         <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+78h],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb39-9" title="9"><span class="fu">  0000000140001019:</span> <span class="dv">33</span> C0              <span class="bu">xor</span>         <span class="kw">eax</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb39-10" title="10"><span class="fu">  000000014000101B:</span> <span class="dv">33</span> C9              <span class="bu">xor</span>         <span class="kw">ecx</span>,<span class="kw">ecx</span></a>
<a class="sourceLine" id="cb39-11" title="11"><span class="fu">  000000014000101D:</span> <span class="dv">49</span> 8D <span class="dv">53</span> D8        <span class="bu">lea</span>         <span class="kw">rdx</span>,[<span class="kw">r11</span>-28h]</a>
<a class="sourceLine" id="cb39-12" title="12"><span class="fu">  0000000140001021:</span> <span class="dv">49</span> <span class="dv">89</span> 4B <span class="dv">98</span>        <span class="bu">mov</span>         <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">r11</span>-68h],<span class="kw">rcx</span></a>
<a class="sourceLine" id="cb39-13" title="13"><span class="fu">  0000000140001025:</span> <span class="dv">49</span> <span class="dv">89</span> <span class="dv">43</span> A0        <span class="bu">mov</span>         <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">r11</span>-60h],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb39-14" title="14"><span class="fu">  0000000140001029:</span> <span class="dv">49</span> <span class="dv">89</span> <span class="dv">43</span> A8        <span class="bu">mov</span>         <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">r11</span>-58h],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb39-15" title="15"><span class="fu">  000000014000102D:</span> 0F <span class="dv">10</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">20</span>     <span class="bu">movups</span>      <span class="kw">xmm0</span>,xmmword <span class="dt">ptr</span> [<span class="kw">rsp</span>+20h]</a>
<a class="sourceLine" id="cb39-16" title="16"><span class="fu">  0000000140001032:</span> F2 0F <span class="dv">10</span> 4C <span class="dv">24</span> <span class="dv">30</span>  <span class="bu">movsd</span>       <span class="kw">xmm1</span>,mmword <span class="dt">ptr</span> [<span class="kw">rsp</span>+30h]</a>
<a class="sourceLine" id="cb39-17" title="17"><span class="fu">  0000000140001038:</span> <span class="dv">49</span> <span class="dv">89</span> 4B D8        <span class="bu">mov</span>         <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">r11</span>-28h],<span class="kw">rcx</span></a>
<a class="sourceLine" id="cb39-18" title="18"><span class="fu">  000000014000103C:</span> <span class="dv">49</span> 8D 4B B8        <span class="bu">lea</span>         <span class="kw">rcx</span>,[<span class="kw">r11</span>-48h]</a>
<a class="sourceLine" id="cb39-19" title="19"><span class="fu">  0000000140001040:</span> <span class="dv">49</span> <span class="dv">89</span> <span class="dv">43</span> E0        <span class="bu">mov</span>         <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">r11</span>-20h],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb39-20" title="20"><span class="fu">  0000000140001044:</span> 0F <span class="dv">29</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">40</span>     <span class="bu">movaps</span>      xmmword <span class="dt">ptr</span> [<span class="kw">rsp</span>+40h],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb39-21" title="21"><span class="fu">  0000000140001049:</span> F2 0F <span class="dv">11</span> 4C <span class="dv">24</span> <span class="dv">50</span>  <span class="bu">movsd</span>       mmword <span class="dt">ptr</span> [<span class="kw">rsp</span>+50h],<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb39-22" title="22"><span class="fu">  000000014000104F:</span> <span class="dv">49</span> <span class="dv">89</span> <span class="dv">43</span> E8        <span class="bu">mov</span>         <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">r11</span>-18h],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb39-23" title="23"><span class="fu">  0000000140001053:</span> E8 <span class="dv">18</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        myFunc</a>
<a class="sourceLine" id="cb39-24" title="24"><span class="fu">  0000000140001058:</span> <span class="dv">83</span> C0 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb39-25" title="25"><span class="fu">  000000014000105B:</span> <span class="dv">48</span> 8B 4C <span class="dv">24</span> <span class="dv">78</span>     <span class="bu">mov</span>         <span class="kw">rcx</span>,<span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+78h]</a>
<a class="sourceLine" id="cb39-26" title="26"><span class="fu">  0000000140001060:</span> <span class="dv">48</span> <span class="dv">33</span> CC           <span class="bu">xor</span>         <span class="kw">rcx</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb39-27" title="27"><span class="fu">  0000000140001063:</span> E8 A8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        __security_check_cookie</a>
<a class="sourceLine" id="cb39-28" title="28"><span class="fu">  0000000140001068:</span> <span class="dv">48</span> <span class="dv">81</span> C4 <span class="dv">88</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">add</span>         <span class="kw">rsp</span><span class="bn">,88h</span></a>
<a class="sourceLine" id="cb39-29" title="29">                    <span class="dv">00</span></a>
<a class="sourceLine" id="cb39-30" title="30"><span class="fu">  000000014000106F:</span> C3                 <span class="bu">ret</span></a>
<a class="sourceLine" id="cb39-31" title="31"></a>
<a class="sourceLine" id="cb39-32" title="32"><span class="fu">myFunc:</span></a>
<a class="sourceLine" id="cb39-33" title="33"><span class="fu">  0000000140001070:</span> 8B <span class="dv">42</span> <span class="dv">04</span>           <span class="bu">mov</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rdx</span>+<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb39-34" title="34"><span class="fu">  0000000140001073:</span> <span class="dv">03</span> <span class="dv">01</span>              <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rcx</span>]</a>
<a class="sourceLine" id="cb39-35" title="35"><span class="fu">  0000000140001075:</span> C3                 <span class="bu">ret</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>The compiler uses <code>R11</code> as the stack frame base pointer instead of <code>RBP</code>. This is likely as <code>R11</code> is a scratch register and it saves some instructions to push and pop <code>RBP</code> on/off the stack.</li>
<li>The structure at address <code>RSP</code>+40 is copied to <code>RSP</code>+72, making a copy of <code>struct a</code> for use in the function as <code>struct x</code>.</li>
<li>Parameter 1 in <code>RCX</code> is the address of <code>struct x</code>, which is a copy of <code>struct a</code>, created by the caller for the callee.</li>
<li>Parameter 2 in <code>RDX</code> is the address of <code>struct b</code>, passed by reference to the callee.</li>
<li>The structures are aligned on 16-byte boundaries.</li>
</ul>
<p>The stack in the caller, based on <code>RSP</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RSP+136]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+128]</code></td>
<td>cookie XOR <code>RSP</code> at instruction 140001011</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+120]</code></td>
<td>y.e, y.f</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+112]</code></td>
<td>y.c, y.d</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+104]</code></td>
<td>Struct y.a, y.b</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+96]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+88]</code></td>
<td>x.e, x.f</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+80]</code></td>
<td>x.c, x.d</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+72]</code></td>
<td>Struct x.a, x.b</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+64]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+56]</code></td>
<td>a.e, a.f</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+48]</code></td>
<td>a.c, a.d</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+40]</code></td>
<td>Struct a.a, a.b</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+32]</code></td>
<td>Shadow parameter 4 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+24]</code></td>
<td>Shadow parameter 3 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+16]</code></td>
<td>Shadow parameter 2 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+8]</code></td>
<td>Shadow parameter 1 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="odd">
<td><code>xxx ptr [RSP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<h4 id="return-struct-by-value-1"><span class="header-section-number">4.2.4.9</span> Return Struct by Value</h4>
<div class="sourceCode" id="cb40"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb40-1" title="1"><span class="kw">struct</span> mystruct {</a>
<a class="sourceLine" id="cb40-2" title="2">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb40-3" title="3">  <span class="dt">int</span> b;</a>
<a class="sourceLine" id="cb40-4" title="4">  <span class="dt">int</span> c;</a>
<a class="sourceLine" id="cb40-5" title="5">  <span class="dt">int</span> d;</a>
<a class="sourceLine" id="cb40-6" title="6">  <span class="dt">int</span> e;</a>
<a class="sourceLine" id="cb40-7" title="7">  <span class="dt">int</span> f;</a>
<a class="sourceLine" id="cb40-8" title="8">};</a>
<a class="sourceLine" id="cb40-9" title="9"></a>
<a class="sourceLine" id="cb40-10" title="10"><span class="kw">struct</span> mystruct myFunc(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb40-11" title="11">{</a>
<a class="sourceLine" id="cb40-12" title="12">  <span class="kw">struct</span> mystruct x = {<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>};</a>
<a class="sourceLine" id="cb40-13" title="13">  <span class="cf">return</span> x;</a>
<a class="sourceLine" id="cb40-14" title="14">}</a>
<a class="sourceLine" id="cb40-15" title="15"></a>
<a class="sourceLine" id="cb40-16" title="16"><span class="dt">int</span> _tmain(<span class="dt">int</span> argc, _TCHAR* argv[])</a>
<a class="sourceLine" id="cb40-17" title="17">{</a>
<a class="sourceLine" id="cb40-18" title="18">  <span class="cf">return</span> myFunc().a + <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb40-19" title="19">}</a></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb41-1" title="1"><span class="fu">wmain:</span></a>
<a class="sourceLine" id="cb41-2" title="2"><span class="fu">  0000000140001000:</span> <span class="dv">48</span> <span class="dv">83</span> EC <span class="dv">58</span>        <span class="bu">sub</span>         <span class="kw">rsp</span><span class="bn">,58h</span></a>
<a class="sourceLine" id="cb41-3" title="3"><span class="fu">  0000000140001004:</span> <span class="dv">48</span> 8D 4C <span class="dv">24</span> <span class="dv">38</span>     <span class="bu">lea</span>         <span class="kw">rcx</span>,[<span class="kw">rsp</span>+38h]</a>
<a class="sourceLine" id="cb41-4" title="4"><span class="fu">  0000000140001009:</span> E8 <span class="dv">22</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        myFunc</a>
<a class="sourceLine" id="cb41-5" title="5"><span class="fu">  000000014000100E:</span> <span class="dv">48</span> 8B <span class="dv">48</span> <span class="dv">08</span>        <span class="bu">mov</span>         <span class="kw">rcx</span>,<span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">rax</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb41-6" title="6"><span class="fu">  0000000140001012:</span> <span class="dv">48</span> 8B <span class="dv">10</span>           <span class="bu">mov</span>         <span class="kw">rdx</span>,<span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">rax</span>]</a>
<a class="sourceLine" id="cb41-7" title="7"><span class="fu">  0000000140001015:</span> <span class="dv">48</span> 8B <span class="dv">40</span> <span class="dv">10</span>        <span class="bu">mov</span>         <span class="kw">rax</span>,<span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">rax</span>+10h]</a>
<a class="sourceLine" id="cb41-8" title="8"><span class="fu">  0000000140001019:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">30</span>     <span class="bu">mov</span>         <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+30h],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb41-9" title="9"><span class="fu">  000000014000101E:</span> <span class="dv">48</span> <span class="dv">89</span> 4C <span class="dv">24</span> <span class="dv">28</span>     <span class="bu">mov</span>         <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+28h],<span class="kw">rcx</span></a>
<a class="sourceLine" id="cb41-10" title="10"><span class="fu">  0000000140001023:</span> 8D <span class="dv">42</span> <span class="dv">02</span>           <span class="bu">lea</span>         <span class="kw">eax</span>,[<span class="kw">rdx</span>+<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb41-11" title="11"><span class="fu">  0000000140001026:</span> <span class="dv">48</span> <span class="dv">83</span> C4 <span class="dv">58</span>        <span class="bu">add</span>         <span class="kw">rsp</span><span class="bn">,58h</span></a>
<a class="sourceLine" id="cb41-12" title="12"><span class="fu">  000000014000102A:</span> C3                 <span class="bu">ret</span></a>
<a class="sourceLine" id="cb41-13" title="13"></a>
<a class="sourceLine" id="cb41-14" title="14"><span class="fu">myFunc:</span></a>
<a class="sourceLine" id="cb41-15" title="15"><span class="fu">  0000000140001030:</span> C7 <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rcx</span>],<span class="dv">0</span></a>
<a class="sourceLine" id="cb41-16" title="16"><span class="fu">  0000000140001036:</span> C7 <span class="dv">41</span> <span class="dv">04</span> <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rcx</span>+<span class="dv">4</span>],<span class="dv">1</span></a>
<a class="sourceLine" id="cb41-17" title="17">                    <span class="dv">00</span></a>
<a class="sourceLine" id="cb41-18" title="18"><span class="fu">  000000014000103D:</span> C7 <span class="dv">41</span> <span class="dv">08</span> <span class="dv">02</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rcx</span>+<span class="dv">8</span>],<span class="dv">2</span></a>
<a class="sourceLine" id="cb41-19" title="19">                    <span class="dv">00</span></a>
<a class="sourceLine" id="cb41-20" title="20"><span class="fu">  0000000140001044:</span> C7 <span class="dv">41</span> 0C <span class="dv">03</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rcx</span>+0Ch],<span class="dv">3</span></a>
<a class="sourceLine" id="cb41-21" title="21">                    <span class="dv">00</span></a>
<a class="sourceLine" id="cb41-22" title="22"><span class="fu">  000000014000104B:</span> C7 <span class="dv">41</span> <span class="dv">10</span> <span class="dv">04</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rcx</span>+10h],<span class="dv">4</span></a>
<a class="sourceLine" id="cb41-23" title="23">                    <span class="dv">00</span></a>
<a class="sourceLine" id="cb41-24" title="24"><span class="fu">  0000000140001052:</span> C7 <span class="dv">41</span> <span class="dv">14</span> <span class="dv">05</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rcx</span>+14h],<span class="dv">5</span></a>
<a class="sourceLine" id="cb41-25" title="25">                    <span class="dv">00</span></a>
<a class="sourceLine" id="cb41-26" title="26"><span class="fu">  0000000140001059:</span> <span class="dv">48</span> 8B C1           <span class="bu">mov</span>         <span class="kw">rax</span>,<span class="kw">rcx</span></a>
<a class="sourceLine" id="cb41-27" title="27"><span class="fu">  000000014000105C:</span> C3                 <span class="bu">ret</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>The caller is responsible for allocating space on the stack for the return value.</li>
<li>The return value is passed as the first parameter on <code>RCX</code>. It’s not shown here, but all other parameters are then shifted to the right by one (so parameter 1 would then be passed on <code>RDX</code>, etc.)</li>
<li>As in the <code>stdcall</code> calling convention, the return value (in <code>RAX</code> is a pointer to the struct (parameter 1) given.</li>
<li>The struct for returning is aligned to a 16-byte boundary.</li>
</ul>
<p>The stack in the caller, based on <code>RSP</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RSP+96]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+88]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+80]</code></td>
<td>return struct</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+72]</code></td>
<td>return struct</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+64]</code></td>
<td>Return struct allocated by caller</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+56]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+48]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+40]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+32]</code></td>
<td>Shadow parameter 4 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+24]</code></td>
<td>Shadow parameter 3 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+16]</code></td>
<td>Shadow parameter 2 (not used)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+8]</code></td>
<td>Shadow parameter 1 (not used)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="even">
<td><code>xxx ptr [RSP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<h4 id="variable-number-of-arguments"><span class="header-section-number">4.2.4.10</span> Variable Number of Arguments</h4>
<p>There are multiple examples provided here to analyse the behaviour of the compiler. We see that the callee must provide a mechanism so that the caller can indicate how many arguments are expected to be on the stack.</p>
<p>By looking at the behaviour here, it is easy to see why a variable number of arguments can cause program crashes. So long as the callee access more arguments than are defined, it may start to access information such as the return pointer for previous functions due to previous stack frames.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb42-1" title="1"><span class="dt">int</span> myFunc(<span class="dt">int</span> cnt, ...)</a>
<a class="sourceLine" id="cb42-2" title="2">{</a>
<a class="sourceLine" id="cb42-3" title="3">  <span class="dt">va_list</span> argptr;</a>
<a class="sourceLine" id="cb42-4" title="4">  va_start(argptr, cnt);</a>
<a class="sourceLine" id="cb42-5" title="5">  <span class="dt">int</span> i, j = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb42-6" title="6"></a>
<a class="sourceLine" id="cb42-7" title="7">  <span class="cf">for</span> (i = <span class="dv">0</span>; i &lt; cnt; i++) j += va_arg(argptr, <span class="dt">int</span>);</a>
<a class="sourceLine" id="cb42-8" title="8">  <span class="cf">return</span> j;</a>
<a class="sourceLine" id="cb42-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb43-1" title="1"><span class="fu">myFunc:</span></a>
<a class="sourceLine" id="cb43-2" title="2"><span class="fu">  0000000140001030:</span> <span class="dv">89</span> 4C <span class="dv">24</span> <span class="dv">08</span>        <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+<span class="dv">8</span>],<span class="kw">ecx</span></a>
<a class="sourceLine" id="cb43-3" title="3"><span class="fu">  0000000140001034:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">54</span> <span class="dv">24</span> <span class="dv">10</span>     <span class="bu">mov</span>         <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+10h],<span class="kw">rdx</span></a>
<a class="sourceLine" id="cb43-4" title="4"><span class="fu">  0000000140001039:</span> <span class="dv">33</span> C0              <span class="bu">xor</span>         <span class="kw">eax</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb43-5" title="5"><span class="fu">  000000014000103B:</span> 4C <span class="dv">89</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">18</span>     <span class="bu">mov</span>         <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+18h],<span class="kw">r8</span></a>
<a class="sourceLine" id="cb43-6" title="6"><span class="fu">  0000000140001040:</span> <span class="dv">48</span> 8D <span class="dv">54</span> <span class="dv">24</span> <span class="dv">10</span>     <span class="bu">lea</span>         <span class="kw">rdx</span>,[<span class="kw">rsp</span>+10h]</a>
<a class="sourceLine" id="cb43-7" title="7"><span class="fu">  0000000140001045:</span> 4C <span class="dv">89</span> 4C <span class="dv">24</span> <span class="dv">20</span>     <span class="bu">mov</span>         <span class="dt">qword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+20h],<span class="kw">r9</span></a>
<a class="sourceLine" id="cb43-8" title="8"><span class="fu">  000000014000104A:</span> <span class="dv">85</span> C9              <span class="bu">test</span>        <span class="kw">ecx</span>,<span class="kw">ecx</span></a>
<a class="sourceLine" id="cb43-9" title="9"><span class="fu">  000000014000104C:</span> 7E <span class="dv">12</span>              <span class="bu">jle</span>         <span class="dv">0000000140001060</span></a>
<a class="sourceLine" id="cb43-10" title="10"><span class="fu">  000000014000104E:</span> <span class="dv">48</span> <span class="dv">83</span> C2 F8        <span class="bu">add</span>         <span class="kw">rdx</span><span class="bn">,0FFFFFFFFFFFFFFF8h</span></a>
<a class="sourceLine" id="cb43-11" title="11"><span class="fu">  0000000140001052:</span> 8B C9              <span class="bu">mov</span>         <span class="kw">ecx</span>,<span class="kw">ecx</span></a>
<a class="sourceLine" id="cb43-12" title="12"><span class="fu">  0000000140001054:</span> <span class="dv">03</span> <span class="dv">42</span> <span class="dv">08</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rdx</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb43-13" title="13"><span class="fu">  0000000140001057:</span> <span class="dv">48</span> 8D <span class="dv">52</span> <span class="dv">08</span>        <span class="bu">lea</span>         <span class="kw">rdx</span>,[<span class="kw">rdx</span>+<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb43-14" title="14"><span class="fu">  000000014000105B:</span> <span class="dv">48</span> FF C9           <span class="bu">dec</span>         <span class="kw">rcx</span></a>
<a class="sourceLine" id="cb43-15" title="15"><span class="fu">  000000014000105E:</span> <span class="dv">75</span> F4              <span class="bu">jne</span>         <span class="dv">0000000140001054</span></a>
<a class="sourceLine" id="cb43-16" title="16"><span class="fu">  0000000140001060:</span> F3 C3              rep <span class="bu">ret</span></a></code></pre></div>
<p>The code remains the same independent of the function being called. Let’s look at the function implementing a variable number of arguments.</p>
<ul>
<li>Here we see the compiler, for the first time, making use of the shadow parameters, putting the results on the stack (instructions <code>140001030</code> to <code>140001045</code>). This simplifies the processing of a variable number of arguments later.</li>
<li>If the parameter <code>cnt</code> in register <code>RCX</code> is negative, it exits with the <code>rep ret</code> instruction.</li>
<li>It subtracts 8 bytes from the <code>RDP</code> register (which was initialised to the first parameter on the stack, as initialised in step 1).</li>
<li>The result is added with the parameter on the stack and <code>RDP</code> is updated to point to the next parameter variable.</li>
<li>The counter <code>ECX</code> is decremented.</li>
</ul>
<p>So we see there is no implicit information given by the compiler about how many parameters were provided. This is entirely up to the <code>caller</code> to specify how many arguments the callee should handle. The <code>callee</code> may still pass up to the first four parameters via registers only without having to copy them onto the stack.</p>
<h5 id="one-single-argument"><span class="header-section-number">4.2.4.10.1</span> One Single Argument</h5>
<p>The case that a single integer is provided without any variable number of arguments.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb44-1" title="1"><span class="dt">int</span> _tmain(<span class="dt">int</span> argc, _TCHAR* argv[])</a>
<a class="sourceLine" id="cb44-2" title="2">{</a>
<a class="sourceLine" id="cb44-3" title="3">  <span class="cf">return</span> myFunc(<span class="dv">0</span>)+<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb44-4" title="4">}</a></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb45-1" title="1"><span class="fu">wmain:</span></a>
<a class="sourceLine" id="cb45-2" title="2"><span class="fu">  0000000140001000:</span> <span class="dv">48</span> <span class="dv">83</span> EC <span class="dv">28</span>        <span class="bu">sub</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb45-3" title="3"><span class="fu">  0000000140001004:</span> <span class="dv">33</span> C9              <span class="bu">xor</span>         <span class="kw">ecx</span>,<span class="kw">ecx</span></a>
<a class="sourceLine" id="cb45-4" title="4"><span class="fu">  0000000140001006:</span> E8 <span class="dv">15</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        myFunc</a>
<a class="sourceLine" id="cb45-5" title="5"><span class="fu">  000000014000100B:</span> <span class="dv">83</span> C0 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb45-6" title="6"><span class="fu">  000000014000100E:</span> <span class="dv">48</span> <span class="dv">83</span> C4 <span class="dv">28</span>        <span class="bu">add</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb45-7" title="7"><span class="fu">  0000000140001012:</span> C3                 <span class="bu">ret</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>Space is allocated for the shadow parameters.</li>
<li>A single parameter is provided in <code>RCX</code>, consistent with a function only accepting one parameter.</li>
</ul>
<h5 id="two-arguments"><span class="header-section-number">4.2.4.10.2</span> Two arguments</h5>
<p>The case that a single integer is provided without any variable number of arguments.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb46-1" title="1"><span class="dt">int</span> _tmain(<span class="dt">int</span> argc, _TCHAR* argv[])</a>
<a class="sourceLine" id="cb46-2" title="2">{</a>
<a class="sourceLine" id="cb46-3" title="3">  <span class="cf">return</span> myFunc(<span class="dv">1</span>, <span class="dv">1</span>) + <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb46-4" title="4">}</a></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb47-1" title="1"><span class="fu">wmain:</span></a>
<a class="sourceLine" id="cb47-2" title="2"><span class="fu">  0000000140001000:</span> <span class="dv">48</span> <span class="dv">83</span> EC <span class="dv">28</span>        <span class="bu">sub</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb47-3" title="3"><span class="fu">  0000000140001004:</span> BA <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">mov</span>         <span class="kw">edx</span>,<span class="dv">1</span></a>
<a class="sourceLine" id="cb47-4" title="4"><span class="fu">  0000000140001009:</span> 8B CA              <span class="bu">mov</span>         <span class="kw">ecx</span>,<span class="kw">edx</span></a>
<a class="sourceLine" id="cb47-5" title="5"><span class="fu">  000000014000100B:</span> E8 <span class="dv">10</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        myFunc</a>
<a class="sourceLine" id="cb47-6" title="6"><span class="fu">  0000000140001010:</span> <span class="dv">83</span> C0 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb47-7" title="7"><span class="fu">  0000000140001013:</span> <span class="dv">48</span> <span class="dv">83</span> C4 <span class="dv">28</span>        <span class="bu">add</span>         <span class="kw">rsp</span><span class="bn">,28h</span></a>
<a class="sourceLine" id="cb47-8" title="8"><span class="fu">  0000000140001017:</span> C3                 <span class="bu">ret</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>Space is allocated for the shadow parameters.</li>
<li>Two parameters are provided in <code>RCX</code> and <code>RDX</code>, consistent with a function only accepting two parameters.</li>
</ul>
<h5 id="nine-arguments"><span class="header-section-number">4.2.4.10.3</span> Nine arguments</h5>
<p>We pass a large number of arguments on to the stack.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb48-1" title="1"><span class="dt">int</span> _tmain(<span class="dt">int</span> argc, _TCHAR* argv[])</a>
<a class="sourceLine" id="cb48-2" title="2">{</a>
<a class="sourceLine" id="cb48-3" title="3">  <span class="cf">return</span> myFunc(<span class="dv">1</span>, <span class="dv">1</span>) + <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb48-4" title="4">}</a></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb49-1" title="1"><span class="fu">wmain:</span></a>
<a class="sourceLine" id="cb49-2" title="2"><span class="fu">  0000000140001000:</span> <span class="dv">48</span> <span class="dv">83</span> EC <span class="dv">58</span>        <span class="bu">sub</span>         <span class="kw">rsp</span><span class="bn">,58h</span></a>
<a class="sourceLine" id="cb49-3" title="3"><span class="fu">  0000000140001004:</span> BA <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">mov</span>         <span class="kw">edx</span>,<span class="dv">1</span></a>
<a class="sourceLine" id="cb49-4" title="4"><span class="fu">  0000000140001009:</span> C7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">40</span> <span class="dv">08</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+40h],<span class="dv">8</span></a>
<a class="sourceLine" id="cb49-5" title="5">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb49-6" title="6"><span class="fu">  0000000140001011:</span> C7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">38</span> <span class="dv">07</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+38h],<span class="dv">7</span></a>
<a class="sourceLine" id="cb49-7" title="7">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb49-8" title="8"><span class="fu">  0000000140001019:</span> C7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">30</span> <span class="dv">06</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+30h],<span class="dv">6</span></a>
<a class="sourceLine" id="cb49-9" title="9">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb49-10" title="10"><span class="fu">  0000000140001021:</span> <span class="dv">44</span> 8D 4A <span class="dv">02</span>        <span class="bu">lea</span>         r9d,[<span class="kw">rdx</span>+<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb49-11" title="11"><span class="fu">  0000000140001025:</span> <span class="dv">44</span> 8D <span class="dv">42</span> <span class="dv">01</span>        <span class="bu">lea</span>         r8d,[<span class="kw">rdx</span>+<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb49-12" title="12"><span class="fu">  0000000140001029:</span> 8D 4A <span class="dv">07</span>           <span class="bu">lea</span>         <span class="kw">ecx</span>,[<span class="kw">rdx</span>+<span class="dv">7</span>]</a>
<a class="sourceLine" id="cb49-13" title="13"><span class="fu">  000000014000102C:</span> C7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">28</span> <span class="dv">05</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+28h],<span class="dv">5</span></a>
<a class="sourceLine" id="cb49-14" title="14">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb49-15" title="15"><span class="fu">  0000000140001034:</span> C7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">20</span> <span class="dv">04</span> <span class="dv">00</span>  <span class="bu">mov</span>         <span class="dt">dword</span> <span class="dt">ptr</span> [<span class="kw">rsp</span>+20h],<span class="dv">4</span></a>
<a class="sourceLine" id="cb49-16" title="16">                    <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb49-17" title="17"><span class="fu">  000000014000103C:</span> E8 0F <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>     <span class="bu">call</span>        myFunc</a>
<a class="sourceLine" id="cb49-18" title="18"><span class="fu">  0000000140001041:</span> <span class="dv">83</span> C0 <span class="dv">02</span>           <span class="bu">add</span>         <span class="kw">eax</span>,<span class="dv">2</span></a>
<a class="sourceLine" id="cb49-19" title="19"><span class="fu">  0000000140001044:</span> <span class="dv">48</span> <span class="dv">83</span> C4 <span class="dv">58</span>        <span class="bu">add</span>         <span class="kw">rsp</span><span class="bn">,58h</span></a>
<a class="sourceLine" id="cb49-20" title="20"><span class="fu">  0000000140001048:</span> C3                 <span class="bu">ret</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>Space is allocated for the shadow parameters. Arguments 5-9 are copied onto the stack.</li>
<li>The caller is responsible for knowing how many arguments are placed on the stack</li>
</ul>
<p>The stack in the caller, based on <code>RSP</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RSP+96]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+88]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+80]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+72]</code></td>
<td>Parameter 9</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+64]</code></td>
<td>Parameter 8</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+56]</code></td>
<td>Parameter 7</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+48]</code></td>
<td>Parameter 6</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+40]</code></td>
<td>Parameter 5</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+32]</code></td>
<td>Parameter 4 (copied from <code>R9</code>)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+24]</code></td>
<td>Parameter 3 (copied from <code>R8</code>)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP+16]</code></td>
<td>Parameter 2 (copied from <code>RDX</code>)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RSP+8]</code></td>
<td>Parameter 1 (copied from <code>RCX</code>)</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RSP]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="even">
<td><code>xxx ptr [RSP-x]</code></td>
<td>Local stack variables</td>
</tr>
</tbody>
</table>
<h1 id="linux---intel-architecture"><span class="header-section-number">5</span> Linux - Intel Architecture</h1>
<p>In this part, we cover various used calling conventions used on Linux for Intel computers. Information is based on the result of GCC.</p>
<h2 id="gcc-32-bit-sys-v-abi"><span class="header-section-number">5.1</span> GCC: 32-bit Sys V ABI</h2>
<p>The Linux ABI for Intel computers (e.g. your laptop running Linux) for user space programs is based on the System V Application Binary Interface.</p>
<p>The code examples are created using GCC compiled with no optimisations (<code>-O0</code>) option. The functions being called are deliberately placed in one c-module, while the functions that are created for testing are placed in a separate module. This prevents the compiler from providing other optimisations.</p>
<p>Disassembly is done using GNU binutils, particularly the <code>objdump</code> command with output formatted in the Intel format (to provide consistency with Windows; the default is AT&amp;T).</p>
<h3 id="naming-convention-2"><span class="header-section-number">5.1.1</span> Naming Convention</h3>
<p>The names of functions when calling using <code>extern &quot;C&quot;</code> are as is. There is no underscore prepended or other characters added.</p>
<h3 id="parameter-passing-and-return-values-2"><span class="header-section-number">5.1.2</span> Parameter Passing and Return Values</h3>
<p>The System V ABI specifies sizes for types (BYTE is 8 byte; WORD is 16-bit; DWORD is 32-bit) as in the following table. The size of these types affect the amount of space required on the stack when transferring parameters to functions.</p>
<table>
<thead>
<tr class="header">
<th>Type</th>
<th>C</th>
<th>sizeof</th>
<th>alignment</th>
<th>i386 Arch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Integral</td>
<td>char / signed char</td>
<td>1</td>
<td>1</td>
<td>signed byte</td>
</tr>
<tr class="even">
<td></td>
<td>unsigned char</td>
<td>1</td>
<td>1</td>
<td>unsigned byte</td>
</tr>
<tr class="odd">
<td></td>
<td>short / signed short</td>
<td>2</td>
<td>2</td>
<td>signed word</td>
</tr>
<tr class="even">
<td></td>
<td>unsigned short</td>
<td>2</td>
<td>2</td>
<td>unsigned word</td>
</tr>
<tr class="odd">
<td></td>
<td>int / signed int</td>
<td>4</td>
<td>4</td>
<td>signed dword</td>
</tr>
<tr class="even">
<td></td>
<td>long / signed long</td>
<td>4</td>
<td>4</td>
<td>signed dword</td>
</tr>
<tr class="odd">
<td></td>
<td>unsigned int</td>
<td>4</td>
<td>4</td>
<td>unsigned dword</td>
</tr>
<tr class="even">
<td></td>
<td>unsigned long</td>
<td>4</td>
<td>4</td>
<td>unsigned dword</td>
</tr>
<tr class="odd">
<td>Pointer</td>
<td>variable *</td>
<td>4</td>
<td>4</td>
<td>unsigned dword</td>
</tr>
<tr class="even">
<td></td>
<td>function *</td>
<td>4</td>
<td>4</td>
<td>unsigned dword</td>
</tr>
<tr class="odd">
<td>Floating Point</td>
<td>float</td>
<td>4</td>
<td>4</td>
<td>single precision</td>
</tr>
<tr class="even">
<td></td>
<td>double</td>
<td>8</td>
<td>4</td>
<td>double precision</td>
</tr>
<tr class="odd">
<td></td>
<td>long double</td>
<td>12</td>
<td>4</td>
<td>extended precision</td>
</tr>
</tbody>
</table>
<p>Arguments are passed on the main stack (given by the register <code>ESP</code>):</p>
<ul>
<li>Arguments are pushed on the stack right to left. That is, the last argument is pushed first so it has the highest address.</li>
<li>Arguments are pushed on the stack as 32-bit values. This is important for <code>char</code> and <code>short</code> values, it will be expanded to 16-bits.</li>
</ul>
<p>Return values on exit (64-bit or less) are given in registers.</p>
<ul>
<li>Values fitting within 32-bits are given in <code>EAX</code>.</li>
<li>Values requiring 64-bits are given in <code>EDX</code> in the upper 32-bits, <code>EAX</code> in the lower 32-bits.</li>
<li>Floating point results are given in the floating point register <code>ST(0)</code>. The caller shall remove the value from the stack even if it doesn’t use it.</li>
</ul>
<p>Return structs by value that are greater than 64-bits are handled as follows:</p>
<ul>
<li>Structures which are returned by value are allocated by the caller (where it’s allocated is not defined, but this is generally on the stack).</li>
<li>A pointer to the return struct is then given to the caller as a pointer, as if this was the first argument.</li>
<li>On return, the callee places the pointer to this structure in the return register <code>EAX</code>. The reason why the caller allocates this space is clarified by the System V ABI - it allows for re-entrancy.</li>
<li>Variable sized structures as return values is undefined.</li>
<li>The called function must remove the function from the stack before returning. This is a special case where the callee must perform specific cleanup of the stack.</li>
</ul>
<h3 id="scratch-registers-2"><span class="header-section-number">5.1.3</span> Scratch Registers</h3>
<p>The following registers are considered scratch registers, the callee doesn’t need to preserve their values before and after the function call.</p>
<ul>
<li><code>EAX</code> contains the result of the function call</li>
<li><code>ECX</code> and <code>EDX</code></li>
<li>FPU register <code>ST(0)</code> must be empty on entry (the FPU stack is empty). On exit contains the result for functions that return a float.</li>
<li><code>EFLAGS</code> don’t need to be preserve specific bit fields, but the caller needs to ensure that the direction flag is forward</li>
</ul>
<p>The other registers must be preserved, e.g. <code>EBP</code>, <code>EBX</code>, <code>EDI</code>, <code>ESI</code> and <code>ESP</code>. The System V ABI describes some detail as to why these registers must be preserved:</p>
<ul>
<li>The <code>EBP</code> holds the base frame for the current stack frame, sometimes called the frame-pointer. It’s generally noted that some debuggers rely on a valid <code>EBP</code> to provide debugging information for the current function. The callee would set up it’s own stack frame, but on return it must be reset to the caller’s frame-pointer.</li>
<li>The <code>EBX</code> serves as the global offset table base register for position independent code.</li>
</ul>
<h3 id="examples-2"><span class="header-section-number">5.1.4</span> Examples</h3>
<p>The examples provided are compiled using the GCC compiler. Disassembly of the functions is done on the object files before linking, thus the <code>call</code> instructions reference function names but the offsets have not yet been patched by the linker.</p>
<h4 id="bit-integer-return-value"><span class="header-section-number">5.1.4.1</span> 32-bit Integer Return Value</h4>
<div class="sourceCode" id="cb50"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb50-1" title="1"><span class="dt">int</span> funcintr(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb50-2" title="2">{</a>
<a class="sourceLine" id="cb50-3" title="3">  <span class="cf">return</span> <span class="dv">42</span>;</a>
<a class="sourceLine" id="cb50-4" title="4">}</a>
<a class="sourceLine" id="cb50-5" title="5"></a>
<a class="sourceLine" id="cb50-6" title="6"><span class="dt">int</span> test_funcintr(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb50-7" title="7">{</a>
<a class="sourceLine" id="cb50-8" title="8">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb50-9" title="9">  a = funcintr() + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb50-10" title="10">  <span class="cf">return</span> a;</a>
<a class="sourceLine" id="cb50-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb51-1" title="1"><span class="dv">00000000</span> &lt;test_funcintr&gt;:</a>
<a class="sourceLine" id="cb51-2" title="2"><span class="fu">   0:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb51-3" title="3"><span class="fu">   1:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb51-4" title="4"><span class="fu">   3:</span>   <span class="dv">83</span> ec <span class="dv">18</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x18</span></a>
<a class="sourceLine" id="cb51-5" title="5"><span class="fu">   6:</span>   e8 fc ff ff ff          <span class="bu">call</span>   <span class="dv">7</span> &lt;test_funcintr+<span class="bn">0x7</span>&gt;</a>
<a class="sourceLine" id="cb51-6" title="6"><span class="fu">   b:</span>   <span class="dv">83</span> c0 <span class="dv">01</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb51-7" title="7"><span class="fu">   e:</span>   <span class="dv">89</span> <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb51-8" title="8"><span class="fu">  11:</span>   8b <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb51-9" title="9"><span class="fu">  14:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb51-10" title="10"><span class="fu">  15:</span>   c3                      <span class="bu">ret</span></a>
<a class="sourceLine" id="cb51-11" title="11"></a>
<a class="sourceLine" id="cb51-12" title="12"><span class="dv">00000000</span> &lt;funcintr&gt;:</a>
<a class="sourceLine" id="cb51-13" title="13"><span class="fu">   0:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb51-14" title="14"><span class="fu">   1:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb51-15" title="15"><span class="fu">   3:</span>   b8 2a <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>          <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x2a</span></a>
<a class="sourceLine" id="cb51-16" title="16"><span class="fu">   8:</span>   5d                      <span class="bu">pop</span>    <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb51-17" title="17"><span class="fu">   9:</span>   c3                      <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The result is placed in the register <code>EAX</code></li>
<li>The caller has allocated 24-bytes stack for itself. Although it’s not really needed, the compiler has all optimisations turned off so it performs some useless instructions such as copying the result to a variable on the stack, then copying it back to the register for the return value.</li>
</ul>
<p>The callee doesn’t have any parameters and doesn’t use the stack except to store the stack frame pointer, so we don’t describe the stack frame here.</p>
<h4 id="bit-integer-return-value-1"><span class="header-section-number">5.1.4.2</span> 64-bit Integer Return Value</h4>
<h5 id="bit-return-in-full-64-bits"><span class="header-section-number">5.1.4.2.1</span> 64-bit return in full 64-bits</h5>
<p>Here we show the code for the case of a 64-bit return value, where the upper 64-bits are defined.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb52-1" title="1"><span class="dt">uint64_t</span> funcint64r(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb52-2" title="2">{</a>
<a class="sourceLine" id="cb52-3" title="3">  <span class="cf">return</span> <span class="bn">0x4200000000</span>;</a>
<a class="sourceLine" id="cb52-4" title="4">}</a>
<a class="sourceLine" id="cb52-5" title="5"></a>
<a class="sourceLine" id="cb52-6" title="6"><span class="dt">int</span> test_funcint64r(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb52-7" title="7">{</a>
<a class="sourceLine" id="cb52-8" title="8">  <span class="dt">uint64_t</span> a;</a>
<a class="sourceLine" id="cb52-9" title="9">  a = funcint64r() + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb52-10" title="10">  <span class="cf">return</span> (<span class="dt">int</span>)a;</a>
<a class="sourceLine" id="cb52-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb53-1" title="1"><span class="dv">00000016</span> &lt;test_funcint64r&gt;:</a>
<a class="sourceLine" id="cb53-2" title="2"><span class="fu">  16:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb53-3" title="3"><span class="fu">  17:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb53-4" title="4"><span class="fu">  19:</span>   <span class="dv">83</span> ec <span class="dv">18</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x18</span></a>
<a class="sourceLine" id="cb53-5" title="5"><span class="fu">  1c:</span>   e8 fc ff ff ff          <span class="bu">call</span>   1d &lt;test_funcint64r+<span class="bn">0x7</span>&gt;</a>
<a class="sourceLine" id="cb53-6" title="6"><span class="fu">  21:</span>   <span class="dv">83</span> c0 <span class="dv">01</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb53-7" title="7"><span class="fu">  24:</span>   <span class="dv">83</span> d2 <span class="dv">00</span>                <span class="bu">adc</span>    <span class="kw">edx</span><span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb53-8" title="8"><span class="fu">  27:</span>   <span class="dv">89</span> <span class="dv">45</span> f0                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x10</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb53-9" title="9"><span class="fu">  2a:</span>   <span class="dv">89</span> <span class="dv">55</span> f4                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>],<span class="kw">edx</span></a>
<a class="sourceLine" id="cb53-10" title="10"><span class="fu">  2d:</span>   8b <span class="dv">45</span> f0                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x10</span>]</a>
<a class="sourceLine" id="cb53-11" title="11"><span class="fu">  30:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb53-12" title="12"><span class="fu">  31:</span>   c3                      <span class="bu">ret</span></a>
<a class="sourceLine" id="cb53-13" title="13"></a>
<a class="sourceLine" id="cb53-14" title="14">0000000a &lt;funcint64r&gt;:</a>
<a class="sourceLine" id="cb53-15" title="15"><span class="fu">   a:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb53-16" title="16"><span class="fu">   b:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb53-17" title="17"><span class="fu">   d:</span>   b8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>          <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb53-18" title="18"><span class="fu">  12:</span>   ba <span class="dv">42</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>          <span class="bu">mov</span>    <span class="kw">edx</span><span class="bn">,0x42</span></a>
<a class="sourceLine" id="cb53-19" title="19"><span class="fu">  17:</span>   5d                      <span class="bu">pop</span>    <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb53-20" title="20"><span class="fu">  18:</span>   c3                      <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The callee stores the upper 32-bits in <code>EDX</code> and the lower 32-bits in <code>EAX</code>, commonly also described as <code>EDX:EAX</code> being the return value.</li>
<li>Adding the value 1 to the result requires two instructions for 64-bit (the second is <code>adc</code> or add with carry).</li>
</ul>
<h5 id="bit-return-needing-only-32-bits"><span class="header-section-number">5.1.4.2.2</span> 64-bit Return Needing only 32-bits</h5>
<p>Even if the result fits within 32-bits, the compiler correctly clears the upper 32-bits.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb54-1" title="1"><span class="dt">uint64_t</span> funcint64r2(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb54-2" title="2">{</a>
<a class="sourceLine" id="cb54-3" title="3">  <span class="cf">return</span> <span class="dv">42</span>;</a>
<a class="sourceLine" id="cb54-4" title="4">}</a>
<a class="sourceLine" id="cb54-5" title="5"></a>
<a class="sourceLine" id="cb54-6" title="6"><span class="dt">int</span> test_funcint64r2(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb54-7" title="7">{</a>
<a class="sourceLine" id="cb54-8" title="8">  <span class="dt">uint64_t</span> a;</a>
<a class="sourceLine" id="cb54-9" title="9">  a = funcint64r2() + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb54-10" title="10">  <span class="cf">return</span> (<span class="dt">int</span>)a;</a>
<a class="sourceLine" id="cb54-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb55-1" title="1"><span class="dv">00000032</span> &lt;test_funcint64r2&gt;:</a>
<a class="sourceLine" id="cb55-2" title="2"><span class="fu">  32:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb55-3" title="3"><span class="fu">  33:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb55-4" title="4"><span class="fu">  35:</span>   <span class="dv">83</span> ec <span class="dv">18</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x18</span></a>
<a class="sourceLine" id="cb55-5" title="5"><span class="fu">  38:</span>   e8 fc ff ff ff          <span class="bu">call</span>   <span class="dv">39</span> &lt;test_funcint64r2+<span class="bn">0x7</span>&gt;</a>
<a class="sourceLine" id="cb55-6" title="6"><span class="fu">  3d:</span>   <span class="dv">83</span> c0 <span class="dv">01</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb55-7" title="7"><span class="fu">  40:</span>   <span class="dv">83</span> d2 <span class="dv">00</span>                <span class="bu">adc</span>    <span class="kw">edx</span><span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb55-8" title="8"><span class="fu">  43:</span>   <span class="dv">89</span> <span class="dv">45</span> f0                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x10</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb55-9" title="9"><span class="fu">  46:</span>   <span class="dv">89</span> <span class="dv">55</span> f4                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>],<span class="kw">edx</span></a>
<a class="sourceLine" id="cb55-10" title="10"><span class="fu">  49:</span>   8b <span class="dv">45</span> f0                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x10</span>]</a>
<a class="sourceLine" id="cb55-11" title="11"><span class="fu">  4c:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb55-12" title="12"><span class="fu">  4d:</span>   c3                      <span class="bu">ret</span></a>
<a class="sourceLine" id="cb55-13" title="13"></a>
<a class="sourceLine" id="cb55-14" title="14"><span class="dv">00000019</span> &lt;funcint64r2&gt;:</a>
<a class="sourceLine" id="cb55-15" title="15"><span class="fu">  19:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb55-16" title="16"><span class="fu">  1a:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb55-17" title="17"><span class="fu">  1c:</span>   b8 2a <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>          <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x2a</span></a>
<a class="sourceLine" id="cb55-18" title="18"><span class="fu">  21:</span>   ba <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>          <span class="bu">mov</span>    <span class="kw">edx</span><span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb55-19" title="19"><span class="fu">  26:</span>   5d                      <span class="bu">pop</span>    <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb55-20" title="20"><span class="fu">  27:</span>   c3                     <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The callee stores the upper 32-bits in <code>EDX</code> and the lower 32-bits in <code>EAX</code>. Even though the upper 32-bits are zero, this is still correctly cleared.</li>
<li>Adding the value 1 to the result requires two instructions for 64-bit (the second is <code>adc</code> or add with carry).</li>
</ul>
<h4 id="integer-parameters"><span class="header-section-number">5.1.4.3</span> Integer Parameters</h4>
<div class="sourceCode" id="cb56"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb56-1" title="1"><span class="dt">int</span> funcint(<span class="dt">int</span> a, <span class="dt">int</span> b, <span class="dt">int</span> c)</a>
<a class="sourceLine" id="cb56-2" title="2">{</a>
<a class="sourceLine" id="cb56-3" title="3">  <span class="cf">return</span> (a + <span class="dv">1</span>) * (b + <span class="dv">2</span>) * (c + <span class="dv">3</span>);</a>
<a class="sourceLine" id="cb56-4" title="4">}</a>
<a class="sourceLine" id="cb56-5" title="5"></a>
<a class="sourceLine" id="cb56-6" title="6"><span class="dt">int</span> test_funcint(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb56-7" title="7">{</a>
<a class="sourceLine" id="cb56-8" title="8">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb56-9" title="9">  a = funcint(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>) + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb56-10" title="10">  <span class="cf">return</span> a;</a>
<a class="sourceLine" id="cb56-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb57-1" title="1">0000004e &lt;test_funcint&gt;:</a>
<a class="sourceLine" id="cb57-2" title="2"><span class="fu">  4e:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb57-3" title="3"><span class="fu">  4f:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb57-4" title="4"><span class="fu">  51:</span>   <span class="dv">83</span> ec <span class="dv">28</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x28</span></a>
<a class="sourceLine" id="cb57-5" title="5"><span class="fu">  54:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">08</span> <span class="dv">03</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x8</span>]<span class="bn">,0x3</span></a>
<a class="sourceLine" id="cb57-6" title="6"><span class="fu">  5b:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb57-7" title="7"><span class="fu">  5c:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">04</span> <span class="dv">02</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x4</span>]<span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb57-8" title="8"><span class="fu">  63:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb57-9" title="9"><span class="fu">  64:</span>   c7 <span class="dv">04</span> <span class="dv">24</span> <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>]<span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb57-10" title="10"><span class="fu">  6b:</span>   e8 fc ff ff ff          <span class="bu">call</span>   6c &lt;test_funcint+<span class="bn">0x1e</span>&gt;</a>
<a class="sourceLine" id="cb57-11" title="11"><span class="fu">  70:</span>   <span class="dv">83</span> c0 <span class="dv">01</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb57-12" title="12"><span class="fu">  73:</span>   <span class="dv">89</span> <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb57-13" title="13"><span class="fu">  76:</span>   8b <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb57-14" title="14"><span class="fu">  79:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb57-15" title="15"><span class="fu">  7a:</span>   c3                      <span class="bu">ret</span></a>
<a class="sourceLine" id="cb57-16" title="16"></a>
<a class="sourceLine" id="cb57-17" title="17"><span class="dv">00000028</span> &lt;funcint&gt;:</a>
<a class="sourceLine" id="cb57-18" title="18"><span class="fu">  28:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb57-19" title="19"><span class="fu">  29:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb57-20" title="20"><span class="fu">  2b:</span>   8b <span class="dv">45</span> <span class="dv">08</span>                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x8</span>]</a>
<a class="sourceLine" id="cb57-21" title="21"><span class="fu">  2e:</span>   8d <span class="dv">50</span> <span class="dv">01</span>                <span class="bu">lea</span>    <span class="kw">edx</span>,[<span class="kw">eax</span>+<span class="bn">0x1</span>]</a>
<a class="sourceLine" id="cb57-22" title="22"><span class="fu">  31:</span>   8b <span class="dv">45</span> 0c                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0xc</span>]</a>
<a class="sourceLine" id="cb57-23" title="23"><span class="fu">  34:</span>   <span class="dv">83</span> c0 <span class="dv">02</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb57-24" title="24"><span class="fu">  37:</span>   0f af c2                <span class="bu">imul</span>   <span class="kw">eax</span>,<span class="kw">edx</span></a>
<a class="sourceLine" id="cb57-25" title="25"><span class="fu">  3a:</span>   8b <span class="dv">55</span> <span class="dv">10</span>                <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x10</span>]</a>
<a class="sourceLine" id="cb57-26" title="26"><span class="fu">  3d:</span>   <span class="dv">83</span> c2 <span class="dv">03</span>                <span class="bu">add</span>    <span class="kw">edx</span><span class="bn">,0x3</span></a>
<a class="sourceLine" id="cb57-27" title="27"><span class="fu">  40:</span>   0f af c2                <span class="bu">imul</span>   <span class="kw">eax</span>,<span class="kw">edx</span></a>
<a class="sourceLine" id="cb57-28" title="28"><span class="fu">  43:</span>   5d                      <span class="bu">pop</span>    <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb57-29" title="29"><span class="fu">  44:</span>   c3                      <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The GCC compiler prefers to allocate space on the stack and then move the values onto the stack, instead of pushing the parameters.</li>
<li>The first parameter has the highest address (see stack frame below)</li>
</ul>
<p>The stack in the caller, based on <code>EBP</code> of the callee <code>funcint</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+48]</code></td>
<td><code>EBP</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+44]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+40]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+36]</code></td>
<td><code>test_funcint</code> local stack, <code>int a</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+32]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+28]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+24]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+20]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+16]</code></td>
<td><code>funcint</code> Parameter 3, <code>int c</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+12]</code></td>
<td><code>funcint</code> Parameter 2, <code>int b</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+8]</code></td>
<td><code>funcint</code> Parameter 1, <code>int a</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address, <code>0x70</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> preserved by the callee <code>funcint</code></td>
</tr>
</tbody>
</table>
<h4 id="char-parameters"><span class="header-section-number">5.1.4.4</span> Char Parameters</h4>
<div class="sourceCode" id="cb58"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb58-1" title="1"><span class="dt">int</span> funcchar(<span class="dt">char</span> a, <span class="dt">char</span> b)</a>
<a class="sourceLine" id="cb58-2" title="2">{</a>
<a class="sourceLine" id="cb58-3" title="3">  <span class="cf">return</span> (a + <span class="dv">1</span>) * (b + <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb58-4" title="4">}</a>
<a class="sourceLine" id="cb58-5" title="5"></a>
<a class="sourceLine" id="cb58-6" title="6"><span class="dt">int</span> test_funcchar(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb58-7" title="7">{</a>
<a class="sourceLine" id="cb58-8" title="8">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb58-9" title="9">  a = funcchar(<span class="dv">1</span>, <span class="dv">2</span>) + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb58-10" title="10">  <span class="cf">return</span> a;</a>
<a class="sourceLine" id="cb58-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb59-1" title="1">0000007b &lt;test_funcchar&gt;:</a>
<a class="sourceLine" id="cb59-2" title="2"><span class="fu">  7b:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb59-3" title="3"><span class="fu">  7c:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb59-4" title="4"><span class="fu">  7e:</span>   <span class="dv">83</span> ec <span class="dv">28</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x28</span></a>
<a class="sourceLine" id="cb59-5" title="5"><span class="fu">  81:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">04</span> <span class="dv">02</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x4</span>]<span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb59-6" title="6"><span class="fu">  88:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb59-7" title="7"><span class="fu">  89:</span>   c7 <span class="dv">04</span> <span class="dv">24</span> <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>]<span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb59-8" title="8"><span class="fu">  90:</span>   e8 fc ff ff ff          <span class="bu">call</span>   <span class="dv">91</span> &lt;test_funcchar+<span class="bn">0x16</span>&gt;</a>
<a class="sourceLine" id="cb59-9" title="9"><span class="fu">  95:</span>   <span class="dv">83</span> c0 <span class="dv">01</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb59-10" title="10"><span class="fu">  98:</span>   <span class="dv">89</span> <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb59-11" title="11"><span class="fu">  9b:</span>   8b <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb59-12" title="12"><span class="fu">  9e:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb59-13" title="13"><span class="fu">  9f:</span>   c3                      <span class="bu">ret</span></a>
<a class="sourceLine" id="cb59-14" title="14"></a>
<a class="sourceLine" id="cb59-15" title="15"><span class="dv">00000045</span> &lt;funcchar&gt;:</a>
<a class="sourceLine" id="cb59-16" title="16"><span class="fu">  45:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb59-17" title="17"><span class="fu">  46:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb59-18" title="18"><span class="fu">  48:</span>   <span class="dv">83</span> ec <span class="dv">08</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x8</span></a>
<a class="sourceLine" id="cb59-19" title="19"><span class="fu">  4b:</span>   8b <span class="dv">55</span> <span class="dv">08</span>                <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x8</span>]</a>
<a class="sourceLine" id="cb59-20" title="20"><span class="fu">  4e:</span>   8b <span class="dv">45</span> 0c                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0xc</span>]</a>
<a class="sourceLine" id="cb59-21" title="21"><span class="fu">  51:</span>   <span class="dv">88</span> <span class="dv">55</span> fc                <span class="bu">mov</span>    <span class="dt">BYTE</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>],<span class="kw">dl</span></a>
<a class="sourceLine" id="cb59-22" title="22"><span class="fu">  54:</span>   <span class="dv">88</span> <span class="dv">45</span> f8                <span class="bu">mov</span>    <span class="dt">BYTE</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x8</span>],<span class="kw">al</span></a>
<a class="sourceLine" id="cb59-23" title="23"><span class="fu">  57:</span>   0f be <span class="dv">45</span> fc             <span class="bu">movsx</span>  <span class="kw">eax</span>,<span class="dt">BYTE</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb59-24" title="24"><span class="fu">  5b:</span>   8d <span class="dv">50</span> <span class="dv">01</span>                <span class="bu">lea</span>    <span class="kw">edx</span>,[<span class="kw">eax</span>+<span class="bn">0x1</span>]</a>
<a class="sourceLine" id="cb59-25" title="25"><span class="fu">  5e:</span>   0f be <span class="dv">45</span> f8             <span class="bu">movsx</span>  <span class="kw">eax</span>,<span class="dt">BYTE</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb59-26" title="26"><span class="fu">  62:</span>   <span class="dv">83</span> c0 <span class="dv">02</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb59-27" title="27"><span class="fu">  65:</span>   0f af c2                <span class="bu">imul</span>   <span class="kw">eax</span>,<span class="kw">edx</span></a>
<a class="sourceLine" id="cb59-28" title="28"><span class="fu">  68:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb59-29" title="29"><span class="fu">  69:</span>   c3                      <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>Even though a <code>char</code> requires only one byte, 4 bytes are allocated on the stack. The values on the stack have the upper bits cleared.</li>
<li>The callee allocates two virtual char integers on its stack (each aligned to 32-bits) for the type conversion.</li>
<li>The result is in <code>EDX:EAX</code> from the <code>imul</code> instruction, but <code>EDX</code> is effectively scratch as the caller shouldn’t use it (according to the signature, the return value is 32-bit, so <code>EDX</code> is assumed to be any value).</li>
<li>The <code>leave</code> instruction restores the register <code>EBP</code> and <code>ESP</code></li>
</ul>
<p>Without the <code>leave</code> instruction, code such as the following would be required instead:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb60-1" title="1"><span class="fu">  68:</span>                           <span class="bu">add</span>    <span class="kw">esp</span><span class="bn">,0x8      </span><span class="co">; or   mov esp,ebp</span></a>
<a class="sourceLine" id="cb60-2" title="2">                                <span class="bu">pop</span>    <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb60-3" title="3">                                <span class="bu">ret</span></a></code></pre></div>
<p>The stack in the caller, based on <code>EBP</code> of the callee <code>funcchar</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+48]</code></td>
<td><code>EBP</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+44]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+40]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+36]</code></td>
<td><code>test_funcchar</code> local stack, <code>int a</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+32]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+28]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+24]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+20]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+16]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+12]</code></td>
<td><code>funcchar</code> Parameter 2, <code>char b</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+8]</code></td>
<td><code>funcchar</code> Parameter 1, <code>char a</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address, <code>0x95</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> preserved by the callee <code>funcchar</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP-4]</code></td>
<td>Temp variable <code>(char)a</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP-8]</code></td>
<td>Temp variable <code>(char)b</code></td>
</tr>
</tbody>
</table>
<h4 id="float-parameters"><span class="header-section-number">5.1.4.5</span> Float Parameters</h4>
<div class="sourceCode" id="cb61"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb61-1" title="1"><span class="dt">float</span> funcfloat(<span class="dt">float</span> a, <span class="dt">float</span> b, <span class="dt">float</span> c)</a>
<a class="sourceLine" id="cb61-2" title="2">{</a>
<a class="sourceLine" id="cb61-3" title="3">  <span class="cf">return</span> (a + <span class="fl">1.0</span>) * (b + <span class="fl">2.0</span>) * (c + <span class="fl">3.0</span>);</a>
<a class="sourceLine" id="cb61-4" title="4">}</a>
<a class="sourceLine" id="cb61-5" title="5"></a>
<a class="sourceLine" id="cb61-6" title="6"><span class="dt">int</span> test_funcfloat(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb61-7" title="7">{</a>
<a class="sourceLine" id="cb61-8" title="8">  <span class="dt">float</span> a;</a>
<a class="sourceLine" id="cb61-9" title="9">  a = funcfloat(<span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">3.0</span>) + <span class="fl">4.0</span>;</a>
<a class="sourceLine" id="cb61-10" title="10">  <span class="cf">return</span> (<span class="dt">int</span>)a;</a>
<a class="sourceLine" id="cb61-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb62-1" title="1">000000a0 &lt;test_funcfloat&gt;:</a>
<a class="sourceLine" id="cb62-2" title="2"><span class="fu">  a0:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb62-3" title="3"><span class="fu">  a1:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb62-4" title="4"><span class="fu">  a3:</span>   <span class="dv">83</span> ec <span class="dv">38</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x38</span></a>
<a class="sourceLine" id="cb62-5" title="5"><span class="fu">  a6:</span>   b8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">40</span> <span class="dv">40</span>          <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x40400000</span></a>
<a class="sourceLine" id="cb62-6" title="6"><span class="fu">  ab:</span>   <span class="dv">89</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">08</span>             <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x8</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb62-7" title="7"><span class="fu">  af:</span>   b8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">40</span>          <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x40000000</span></a>
<a class="sourceLine" id="cb62-8" title="8"><span class="fu">  b4:</span>   <span class="dv">89</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">04</span>             <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb62-9" title="9"><span class="fu">  b8:</span>   b8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">80</span> 3f          <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x3f800000</span></a>
<a class="sourceLine" id="cb62-10" title="10"><span class="fu">  bd:</span>   <span class="dv">89</span> <span class="dv">04</span> <span class="dv">24</span>                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb62-11" title="11"><span class="fu">  c0:</span>   e8 fc ff ff ff          <span class="bu">call</span>   c1 &lt;test_funcfloat+<span class="bn">0x21</span>&gt;</a>
<a class="sourceLine" id="cb62-12" title="12"><span class="fu">  c5:</span>   d9 <span class="dv">05</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>       <span class="bu">fld</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> <span class="kw">ds</span>:<span class="bn">0x0</span></a>
<a class="sourceLine" id="cb62-13" title="13"><span class="fu">  cb:</span>   de c1                   <span class="bu">faddp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb62-14" title="14"><span class="fu">  cd:</span>   d9 5d f4                <span class="bu">fstp</span>   <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb62-15" title="15"><span class="fu">  d0:</span>   d9 <span class="dv">45</span> f4                <span class="bu">fld</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb62-16" title="16"><span class="fu">  d3:</span>   d9 7d e6                <span class="bu">fnstcw</span> <span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x1a</span>]</a>
<a class="sourceLine" id="cb62-17" title="17"><span class="fu">  d6:</span>   0f b7 <span class="dv">45</span> e6             <span class="bu">movzx</span>  <span class="kw">eax</span>,<span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x1a</span>]</a>
<a class="sourceLine" id="cb62-18" title="18"><span class="fu">  da:</span>   b4 0c                   <span class="bu">mov</span><span class="bn">    ah,0xc</span></a>
<a class="sourceLine" id="cb62-19" title="19"><span class="fu">  dc:</span>   <span class="dv">66</span> <span class="dv">89</span> <span class="dv">45</span> e4             <span class="bu">mov</span>    <span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x1c</span>],<span class="kw">ax</span></a>
<a class="sourceLine" id="cb62-20" title="20"><span class="fu">  e0:</span>   d9 6d e4                <span class="bu">fldcw</span>  <span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x1c</span>]</a>
<a class="sourceLine" id="cb62-21" title="21"><span class="fu">  e3:</span>   <span class="dt">db</span> 5d e0                <span class="bu">fistp</span>  <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x20</span>]</a>
<a class="sourceLine" id="cb62-22" title="22"><span class="fu">  e6:</span>   d9 6d e6                <span class="bu">fldcw</span>  <span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x1a</span>]</a>
<a class="sourceLine" id="cb62-23" title="23"><span class="fu">  e9:</span>   8b <span class="dv">45</span> e0                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x20</span>]</a>
<a class="sourceLine" id="cb62-24" title="24"><span class="fu">  ec:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb62-25" title="25"><span class="fu">  ed:</span>   c3                      <span class="bu">ret</span></a>
<a class="sourceLine" id="cb62-26" title="26"></a>
<a class="sourceLine" id="cb62-27" title="27">Contents of <span class="bu">section</span> .rodata:</a>
<a class="sourceLine" id="cb62-28" title="28"> <span class="dv">0000</span> <span class="dv">00000000</span> <span class="dv">00000040</span> <span class="dv">00000000</span> <span class="dv">00000840</span>  .......@.......@</a>
<a class="sourceLine" id="cb62-29" title="29"> <span class="dv">0010</span> <span class="dv">00000000</span> <span class="dv">00001040</span>                    .......@</a>
<a class="sourceLine" id="cb62-30" title="30"></a>
<a class="sourceLine" id="cb62-31" title="31">0000006a &lt;funcfloat&gt;:</a>
<a class="sourceLine" id="cb62-32" title="32"><span class="fu">  6a:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb62-33" title="33"><span class="fu">  6b:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb62-34" title="34"><span class="fu">  6d:</span>   <span class="dv">83</span> ec <span class="dv">08</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x8</span></a>
<a class="sourceLine" id="cb62-35" title="35"><span class="fu">  70:</span>   d9 <span class="dv">45</span> <span class="dv">08</span>                <span class="bu">fld</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x8</span>]</a>
<a class="sourceLine" id="cb62-36" title="36"><span class="fu">  73:</span>   d9 e8                   <span class="bu">fld1</span></a>
<a class="sourceLine" id="cb62-37" title="37"><span class="fu">  75:</span>   de c1                   <span class="bu">faddp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb62-38" title="38"><span class="fu">  77:</span>   d9 <span class="dv">45</span> 0c                <span class="bu">fld</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0xc</span>]</a>
<a class="sourceLine" id="cb62-39" title="39"><span class="fu">  7a:</span>   <span class="dt">dd</span> <span class="dv">05</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>       <span class="bu">fld</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">ds</span>:<span class="bn">0x0</span></a>
<a class="sourceLine" id="cb62-40" title="40"><span class="fu">  80:</span>   de c1                   <span class="bu">faddp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb62-41" title="41"><span class="fu">  82:</span>   de c9                   <span class="bu">fmulp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb62-42" title="42"><span class="fu">  84:</span>   d9 <span class="dv">45</span> <span class="dv">10</span>                <span class="bu">fld</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x10</span>]</a>
<a class="sourceLine" id="cb62-43" title="43"><span class="fu">  87:</span>   <span class="dt">dd</span> <span class="dv">05</span> <span class="dv">08</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>       <span class="bu">fld</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">ds</span>:<span class="bn">0x8</span></a>
<a class="sourceLine" id="cb62-44" title="44"><span class="fu">  8d:</span>   de c1                   <span class="bu">faddp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb62-45" title="45"><span class="fu">  8f:</span>   de c9                   <span class="bu">fmulp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb62-46" title="46"><span class="fu">  91:</span>   d9 5d fc                <span class="bu">fstp</span>   <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb62-47" title="47"><span class="fu">  94:</span>   d9 <span class="dv">45</span> fc                <span class="bu">fld</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb62-48" title="48"><span class="fu">  97:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb62-49" title="49"><span class="fu">  98:</span>   c3                      <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>Floats are copied onto the stack, taking 4-bytes, as like integers.</li>
<li>The result is provided in <code>ST(0)</code>, the first element on the FPU stack</li>
<li>Line <code>7a</code> loads the value <code>0x40000000 00000000</code> which is double precision for 2.0</li>
<li>Line <code>87</code> loads the value <code>0x84000000 00000000</code> which is double precision for 3.0</li>
<li>The logic reading the FPU control word temporarily masks out the Overflow (bit
<ol start="3" type="1">
<li>and Zero Divide (bit 2) exceptions. See the Intel FPU Manual.</li>
</ol></li>
</ul>
<p>The stack in the caller, based on <code>EBP</code> of the callee <code>funcfloat</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+64]</code></td>
<td>EBP</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+60]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+56]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+52]</code></td>
<td>result from funcfloat + 4.0</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+48]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+44]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+40]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+36]</code></td>
<td>addr EBP+38 = FPU control word</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+32]</code></td>
<td>Integer result</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+28]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+24]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+20]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+16]</code></td>
<td><code>funcfloat</code> Parameter 3, <code>float c</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+12]</code></td>
<td><code>funcfloat</code> Parameter 2, <code>float b</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+8]</code></td>
<td><code>funcfloat</code> Parameter 1, <code>float a</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address, <code>0xC5</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> preserved by the callee <code>funcfloat</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP-4]</code></td>
<td>Local stack <code>float a</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP-8]</code></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="mixed-float-and-integer-parameters"><span class="header-section-number">5.1.4.6</span> Mixed Float and Integer Parameters</h4>
<div class="sourceCode" id="cb63"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb63-1" title="1"><span class="dt">int</span> funcfloatint(<span class="dt">int</span> a, <span class="dt">float</span> b, <span class="dt">int</span> c, <span class="dt">float</span> d)</a>
<a class="sourceLine" id="cb63-2" title="2">{</a>
<a class="sourceLine" id="cb63-3" title="3">  <span class="cf">return</span> (a + <span class="dv">1</span>) * (b + <span class="fl">2.0</span>) * (c + <span class="dv">3</span>) * (d + <span class="fl">4.0</span>);</a>
<a class="sourceLine" id="cb63-4" title="4">}</a>
<a class="sourceLine" id="cb63-5" title="5"></a>
<a class="sourceLine" id="cb63-6" title="6"><span class="dt">int</span> test_funcfloatint(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb63-7" title="7">{</a>
<a class="sourceLine" id="cb63-8" title="8">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb63-9" title="9">  a = funcfloatint(<span class="dv">1</span>, <span class="fl">2.0</span>, <span class="dv">3</span>, <span class="fl">4.0</span>) + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb63-10" title="10">  <span class="cf">return</span> a;</a>
<a class="sourceLine" id="cb63-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb64-1" title="1">000000ee &lt;test_funcfloatint&gt;:</a>
<a class="sourceLine" id="cb64-2" title="2"><span class="fu">  ee:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb64-3" title="3"><span class="fu">  ef:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb64-4" title="4"><span class="fu">  f1:</span>   <span class="dv">83</span> ec <span class="dv">28</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x28</span></a>
<a class="sourceLine" id="cb64-5" title="5"><span class="fu">  f4:</span>   b8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">80</span> <span class="dv">40</span>          <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x40800000</span></a>
<a class="sourceLine" id="cb64-6" title="6"><span class="fu">  f9:</span>   <span class="dv">89</span> <span class="dv">44</span> <span class="dv">24</span> 0c             <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0xc</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb64-7" title="7"><span class="fu">  fd:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">08</span> <span class="dv">03</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x8</span>]<span class="bn">,0x3</span></a>
<a class="sourceLine" id="cb64-8" title="8"><span class="fu"> 104:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb64-9" title="9"><span class="fu"> 105:</span>   b8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">40</span>          <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x40000000</span></a>
<a class="sourceLine" id="cb64-10" title="10"><span class="fu"> 10a:</span>   <span class="dv">89</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">04</span>             <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb64-11" title="11"><span class="fu"> 10e:</span>   c7 <span class="dv">04</span> <span class="dv">24</span> <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>]<span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb64-12" title="12"><span class="fu"> 115:</span>   e8 fc ff ff ff          <span class="bu">call</span>   <span class="dv">116</span> &lt;test_funcfloatint+<span class="bn">0x28</span>&gt;</a>
<a class="sourceLine" id="cb64-13" title="13"><span class="fu"> 11a:</span>   <span class="dv">83</span> c0 <span class="dv">01</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb64-14" title="14"><span class="fu"> 11d:</span>   <span class="dv">89</span> <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb64-15" title="15"><span class="fu"> 120:</span>   8b <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb64-16" title="16"><span class="fu"> 123:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb64-17" title="17"><span class="fu"> 124:</span>   c3                      <span class="bu">ret</span></a>
<a class="sourceLine" id="cb64-18" title="18"></a>
<a class="sourceLine" id="cb64-19" title="19"><span class="dv">00000099</span> &lt;funcfloatint&gt;:</a>
<a class="sourceLine" id="cb64-20" title="20"><span class="fu">  99:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb64-21" title="21"><span class="fu">  9a:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb64-22" title="22"><span class="fu">  9c:</span>   <span class="dv">83</span> ec <span class="dv">08</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x8</span></a>
<a class="sourceLine" id="cb64-23" title="23"><span class="fu">  9f:</span>   8b <span class="dv">45</span> <span class="dv">08</span>                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x8</span>]</a>
<a class="sourceLine" id="cb64-24" title="24"><span class="fu">  a2:</span>   <span class="dv">83</span> c0 <span class="dv">01</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb64-25" title="25"><span class="fu">  a5:</span>   <span class="dv">89</span> <span class="dv">45</span> fc                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb64-26" title="26"><span class="fu">  a8:</span>   <span class="dt">db</span> <span class="dv">45</span> fc                <span class="bu">fild</span>   <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb64-27" title="27"><span class="fu">  ab:</span>   d9 <span class="dv">45</span> 0c                <span class="bu">fld</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0xc</span>]</a>
<a class="sourceLine" id="cb64-28" title="28"><span class="fu">  ae:</span>   <span class="dt">dd</span> <span class="dv">05</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>       <span class="bu">fld</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">ds</span>:<span class="bn">0x0</span></a>
<a class="sourceLine" id="cb64-29" title="29"><span class="fu">  b4:</span>   de c1                   <span class="bu">faddp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb64-30" title="30"><span class="fu">  b6:</span>   de c9                   <span class="bu">fmulp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb64-31" title="31"><span class="fu">  b8:</span>   8b <span class="dv">45</span> <span class="dv">10</span>                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x10</span>]</a>
<a class="sourceLine" id="cb64-32" title="32"><span class="fu">  bb:</span>   <span class="dv">83</span> c0 <span class="dv">03</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x3</span></a>
<a class="sourceLine" id="cb64-33" title="33"><span class="fu">  be:</span>   <span class="dv">89</span> <span class="dv">45</span> fc                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb64-34" title="34"><span class="fu">  c1:</span>   <span class="dt">db</span> <span class="dv">45</span> fc                <span class="bu">fild</span>   <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb64-35" title="35"><span class="fu">  c4:</span>   de c9                   <span class="bu">fmulp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb64-36" title="36"><span class="fu">  c6:</span>   d9 <span class="dv">45</span> <span class="dv">14</span>                <span class="bu">fld</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x14</span>]</a>
<a class="sourceLine" id="cb64-37" title="37"><span class="fu">  c9:</span>   <span class="dt">dd</span> <span class="dv">05</span> <span class="dv">10</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>       <span class="bu">fld</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">ds</span>:<span class="bn">0x10</span></a>
<a class="sourceLine" id="cb64-38" title="38"><span class="fu">  cf:</span>   de c1                   <span class="bu">faddp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb64-39" title="39"><span class="fu">  d1:</span>   de c9                   <span class="bu">fmulp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb64-40" title="40"><span class="fu">  d3:</span>   d9 7d fa                <span class="bu">fnstcw</span> <span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x6</span>]</a>
<a class="sourceLine" id="cb64-41" title="41"><span class="fu">  d6:</span>   0f b7 <span class="dv">45</span> fa             <span class="bu">movzx</span>  <span class="kw">eax</span>,<span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x6</span>]</a>
<a class="sourceLine" id="cb64-42" title="42"><span class="fu">  da:</span>   b4 0c                   <span class="bu">mov</span><span class="bn">    ah,0xc</span></a>
<a class="sourceLine" id="cb64-43" title="43"><span class="fu">  dc:</span>   <span class="dv">66</span> <span class="dv">89</span> <span class="dv">45</span> f8             <span class="bu">mov</span>    <span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x8</span>],<span class="kw">ax</span></a>
<a class="sourceLine" id="cb64-44" title="44"><span class="fu">  e0:</span>   d9 6d f8                <span class="bu">fldcw</span>  <span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb64-45" title="45"><span class="fu">  e3:</span>   <span class="dt">db</span> 5d fc                <span class="bu">fistp</span>  <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb64-46" title="46"><span class="fu">  e6:</span>   d9 6d fa                <span class="bu">fldcw</span>  <span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x6</span>]</a>
<a class="sourceLine" id="cb64-47" title="47"><span class="fu">  e9:</span>   8b <span class="dv">45</span> fc                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb64-48" title="48"><span class="fu">  ec:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb64-49" title="49"><span class="fu">  ed:</span>   c3                      <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>A mix of floats and integers are both pushed onto the stack as 32-bit values</li>
<li>The logic reading the FPU control word temporarily masks out the Overflow (bit
<ol start="3" type="1">
<li>and Zero Divide (bit 2) exceptions. See the Intel FPU Manual.</li>
</ol></li>
</ul>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+48]</code></td>
<td>EBP</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+44]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+40]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+36]</code></td>
<td>Result <code>int a</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+32]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+28]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+24]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+20]</code></td>
<td><code>funcfloatint</code> Parameter 4, <code>float d = 4.0</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+16]</code></td>
<td><code>funcfloatint</code> Parameter 3, <code>int c = 3</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+12]</code></td>
<td><code>funcfloatint</code> Parameter 2, <code>float b = 2.0</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+8]</code></td>
<td><code>funcfloatint</code> Parameter 1, <code>int a = 1</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address, <code>0x11A</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> preserved by the callee <code>funcfloatint</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP-4]</code></td>
<td>Local stack <code>a + 1</code>, then <code>c + 3</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP-8]</code></td>
<td>addr <code>EBP-6</code> = FPU control word</td>
</tr>
</tbody>
</table>
<h4 id="double-parameters"><span class="header-section-number">5.1.4.7</span> Double Parameters</h4>
<div class="sourceCode" id="cb65"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb65-1" title="1"><span class="dt">double</span> funcdouble(<span class="dt">double</span> a, <span class="dt">double</span> b)</a>
<a class="sourceLine" id="cb65-2" title="2">{</a>
<a class="sourceLine" id="cb65-3" title="3">  <span class="cf">return</span> (a + <span class="dv">2</span>) * (b + <span class="dv">4</span>);</a>
<a class="sourceLine" id="cb65-4" title="4">}</a>
<a class="sourceLine" id="cb65-5" title="5"></a>
<a class="sourceLine" id="cb65-6" title="6"><span class="dt">int</span> test_funcdouble(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb65-7" title="7">{</a>
<a class="sourceLine" id="cb65-8" title="8">  <span class="dt">double</span> a;</a>
<a class="sourceLine" id="cb65-9" title="9">  a = funcdouble(<span class="fl">2.0</span>, <span class="fl">4.0</span>) + <span class="fl">1.0</span>;</a>
<a class="sourceLine" id="cb65-10" title="10">  <span class="cf">return</span> (<span class="dt">int</span>)a;</a>
<a class="sourceLine" id="cb65-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb66-1" title="1"><span class="dv">00000125</span> &lt;test_funcdouble&gt;:</a>
<a class="sourceLine" id="cb66-2" title="2"><span class="fu"> 125:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb66-3" title="3"><span class="fu"> 126:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb66-4" title="4"><span class="fu"> 128:</span>   <span class="dv">83</span> ec <span class="dv">38</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x38</span></a>
<a class="sourceLine" id="cb66-5" title="5"><span class="fu"> 12b:</span>   <span class="dt">dd</span> <span class="dv">05</span> <span class="dv">08</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>       <span class="bu">fld</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">ds</span>:<span class="bn">0x8</span></a>
<a class="sourceLine" id="cb66-6" title="6"><span class="fu"> 131:</span>   <span class="dt">dd</span> 5c <span class="dv">24</span> <span class="dv">08</span>             <span class="bu">fstp</span>   <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x8</span>]</a>
<a class="sourceLine" id="cb66-7" title="7"><span class="fu"> 135:</span>   <span class="dt">dd</span> <span class="dv">05</span> <span class="dv">10</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>       <span class="bu">fld</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">ds</span>:<span class="bn">0x10</span></a>
<a class="sourceLine" id="cb66-8" title="8"><span class="fu"> 13b:</span>   <span class="dt">dd</span> 1c <span class="dv">24</span>                <span class="bu">fstp</span>   <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>]</a>
<a class="sourceLine" id="cb66-9" title="9"><span class="fu"> 13e:</span>   e8 fc ff ff ff          <span class="bu">call</span>   13f &lt;test_funcdouble+<span class="bn">0x1a</span>&gt;</a>
<a class="sourceLine" id="cb66-10" title="10"><span class="fu"> 143:</span>   d9 e8                   <span class="bu">fld1</span></a>
<a class="sourceLine" id="cb66-11" title="11"><span class="fu"> 145:</span>   de c1                   <span class="bu">faddp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb66-12" title="12"><span class="fu"> 147:</span>   <span class="dt">dd</span> 5d f0                <span class="bu">fstp</span>   <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x10</span>]</a>
<a class="sourceLine" id="cb66-13" title="13"><span class="fu"> 14a:</span>   <span class="dt">dd</span> <span class="dv">45</span> f0                <span class="bu">fld</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x10</span>]</a>
<a class="sourceLine" id="cb66-14" title="14"><span class="fu"> 14d:</span>   d9 7d e6                <span class="bu">fnstcw</span> <span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x1a</span>]</a>
<a class="sourceLine" id="cb66-15" title="15"><span class="fu"> 150:</span>   0f b7 <span class="dv">45</span> e6             <span class="bu">movzx</span>  <span class="kw">eax</span>,<span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x1a</span>]</a>
<a class="sourceLine" id="cb66-16" title="16"><span class="fu"> 154:</span>   b4 0c                   <span class="bu">mov</span><span class="bn">    ah,0xc</span></a>
<a class="sourceLine" id="cb66-17" title="17"><span class="fu"> 156:</span>   <span class="dv">66</span> <span class="dv">89</span> <span class="dv">45</span> e4             <span class="bu">mov</span>    <span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x1c</span>],<span class="kw">ax</span></a>
<a class="sourceLine" id="cb66-18" title="18"><span class="fu"> 15a:</span>   d9 6d e4                <span class="bu">fldcw</span>  <span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x1c</span>]</a>
<a class="sourceLine" id="cb66-19" title="19"><span class="fu"> 15d:</span>   <span class="dt">db</span> 5d e0                <span class="bu">fistp</span>  <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x20</span>]</a>
<a class="sourceLine" id="cb66-20" title="20"><span class="fu"> 160:</span>   d9 6d e6                <span class="bu">fldcw</span>  <span class="dt">WORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x1a</span>]</a>
<a class="sourceLine" id="cb66-21" title="21"><span class="fu"> 163:</span>   8b <span class="dv">45</span> e0                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x20</span>]</a>
<a class="sourceLine" id="cb66-22" title="22"><span class="fu"> 166:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb66-23" title="23"><span class="fu"> 167:</span>   c3                      <span class="bu">ret</span></a>
<a class="sourceLine" id="cb66-24" title="24"></a>
<a class="sourceLine" id="cb66-25" title="25">000000ee &lt;funcdouble&gt;:</a>
<a class="sourceLine" id="cb66-26" title="26"><span class="fu">  ee:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb66-27" title="27"><span class="fu">  ef:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb66-28" title="28"><span class="fu">  f1:</span>   <span class="dv">83</span> ec <span class="dv">10</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x10</span></a>
<a class="sourceLine" id="cb66-29" title="29"><span class="fu">  f4:</span>   8b <span class="dv">45</span> <span class="dv">08</span>                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x8</span>]</a>
<a class="sourceLine" id="cb66-30" title="30"><span class="fu">  f7:</span>   <span class="dv">89</span> <span class="dv">45</span> f8                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x8</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb66-31" title="31"><span class="fu">  fa:</span>   8b <span class="dv">45</span> 0c                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0xc</span>]</a>
<a class="sourceLine" id="cb66-32" title="32"><span class="fu">  fd:</span>   <span class="dv">89</span> <span class="dv">45</span> fc                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb66-33" title="33"><span class="fu"> 100:</span>   8b <span class="dv">45</span> <span class="dv">10</span>                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x10</span>]</a>
<a class="sourceLine" id="cb66-34" title="34"><span class="fu"> 103:</span>   <span class="dv">89</span> <span class="dv">45</span> f0                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x10</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb66-35" title="35"><span class="fu"> 106:</span>   8b <span class="dv">45</span> <span class="dv">14</span>                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x14</span>]</a>
<a class="sourceLine" id="cb66-36" title="36"><span class="fu"> 109:</span>   <span class="dv">89</span> <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb66-37" title="37"><span class="fu"> 10c:</span>   <span class="dt">dd</span> <span class="dv">45</span> f8                <span class="bu">fld</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb66-38" title="38"><span class="fu"> 10f:</span>   <span class="dt">dd</span> <span class="dv">05</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>       <span class="bu">fld</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">ds</span>:<span class="bn">0x0</span></a>
<a class="sourceLine" id="cb66-39" title="39"><span class="fu"> 115:</span>   de c1                   <span class="bu">faddp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb66-40" title="40"><span class="fu"> 117:</span>   <span class="dt">dd</span> <span class="dv">45</span> f0                <span class="bu">fld</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x10</span>]</a>
<a class="sourceLine" id="cb66-41" title="41"><span class="fu"> 11a:</span>   <span class="dt">dd</span> <span class="dv">05</span> <span class="dv">10</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>       <span class="bu">fld</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">ds</span>:<span class="bn">0x10</span></a>
<a class="sourceLine" id="cb66-42" title="42"><span class="fu"> 120:</span>   de c1                   <span class="bu">faddp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb66-43" title="43"><span class="fu"> 122:</span>   de c9                   <span class="bu">fmulp</span>  <span class="kw">st</span>(<span class="dv">1</span>),<span class="kw">st</span></a>
<a class="sourceLine" id="cb66-44" title="44"><span class="fu"> 124:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb66-45" title="45"><span class="fu"> 125:</span>   c3                      <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>A mix of floats and integers are both pushed onto the stack as 32-bit values.</li>
<li>The logic reading the FPU control word temporarily masks out the Overflow (bit
<ol start="3" type="1">
<li>and Zero Divide (bit 2) exceptions. See the Intel FPU Manual.</li>
</ol></li>
<li>The type <code>double</code> takes 8-bytes on the stack.</li>
</ul>
<p>The stack in the caller, based on <code>EBP</code> of the callee <code>funcdouble</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+64]</code></td>
<td>EBP</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+60]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+56]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+52]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+48]</code></td>
<td>Result, <code>funcdouble + 1.0</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+44]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+40]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+36]</code></td>
<td>FPU Control Word</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+32]</code></td>
<td>Result <code>(int)a</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+28]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+24]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+20]</code></td>
<td><code>funcdouble</code> parameter 2, high 32-bit</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+16]</code></td>
<td><code>funcdouble</code> parameter 2, low 32-bit</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+12]</code></td>
<td><code>funcdouble</code> parameter 1, high 32-bit</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+8]</code></td>
<td><code>funcdouble</code> parameter 1, low 32-bit</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address, <code>0x11A</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> preserved by the callee <code>funcfloatint</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP-4]</code></td>
<td>Local stack <code>a + 1</code>, then <code>c + 3</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP-8]</code></td>
<td>addr <code>EBP-6</code> = FPU control word</td>
</tr>
</tbody>
</table>
<h4 id="passing-a-struct-by-value"><span class="header-section-number">5.1.4.8</span> Passing a Struct by Value</h4>
<div class="sourceCode" id="cb67"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb67-1" title="1"><span class="kw">struct</span> mystruct {</a>
<a class="sourceLine" id="cb67-2" title="2">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb67-3" title="3">  <span class="dt">int</span> b;</a>
<a class="sourceLine" id="cb67-4" title="4">  <span class="dt">int</span> c;</a>
<a class="sourceLine" id="cb67-5" title="5">  <span class="dt">int</span> d;</a>
<a class="sourceLine" id="cb67-6" title="6">  <span class="dt">int</span> e;</a>
<a class="sourceLine" id="cb67-7" title="7">  <span class="dt">int</span> f;</a>
<a class="sourceLine" id="cb67-8" title="8">};</a>
<a class="sourceLine" id="cb67-9" title="9"></a>
<a class="sourceLine" id="cb67-10" title="10"><span class="dt">int</span> funcstructvalue(<span class="kw">struct</span> mystruct x, <span class="kw">struct</span> mystruct *y)</a>
<a class="sourceLine" id="cb67-11" title="11">{</a>
<a class="sourceLine" id="cb67-12" title="12">  <span class="cf">return</span> x.a + y-&gt;b;</a>
<a class="sourceLine" id="cb67-13" title="13">}</a>
<a class="sourceLine" id="cb67-14" title="14"></a>
<a class="sourceLine" id="cb67-15" title="15"><span class="dt">int</span> test_funcstructvalue(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb67-16" title="16">{</a>
<a class="sourceLine" id="cb67-17" title="17">  <span class="kw">struct</span> mystruct x = {<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>};</a>
<a class="sourceLine" id="cb67-18" title="18">  <span class="kw">struct</span> mystruct y = {<span class="dv">0</span>, };</a>
<a class="sourceLine" id="cb67-19" title="19"></a>
<a class="sourceLine" id="cb67-20" title="20">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb67-21" title="21">  a = funcstructvalue(x, &amp;y) + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb67-22" title="22">  <span class="cf">return</span> a;</a>
<a class="sourceLine" id="cb67-23" title="23">}</a></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb68-1" title="1"><span class="dv">00000168</span> &lt;test_funcstructvalue&gt;:</a>
<a class="sourceLine" id="cb68-2" title="2"><span class="fu"> 168:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb68-3" title="3"><span class="fu"> 169:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb68-4" title="4"><span class="fu"> 16b:</span>   <span class="dv">53</span>                      <span class="bu">push</span>   <span class="kw">ebx</span></a>
<a class="sourceLine" id="cb68-5" title="5"><span class="fu"> 16c:</span>   <span class="dv">83</span> ec <span class="dv">64</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x64</span></a>
<a class="sourceLine" id="cb68-6" title="6"><span class="fu"> 16f:</span>   c7 <span class="dv">45</span> c4 <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x3c</span>]<span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb68-7" title="7"><span class="fu"> 176:</span>   c7 <span class="dv">45</span> c8 <span class="dv">02</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x38</span>]<span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb68-8" title="8"><span class="fu"> 17d:</span>   c7 <span class="dv">45</span> cc <span class="dv">03</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x34</span>]<span class="bn">,0x3</span></a>
<a class="sourceLine" id="cb68-9" title="9"><span class="fu"> 184:</span>   c7 <span class="dv">45</span> d0 <span class="dv">04</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x30</span>]<span class="bn">,0x4</span></a>
<a class="sourceLine" id="cb68-10" title="10"><span class="fu"> 18b:</span>   c7 <span class="dv">45</span> d4 <span class="dv">05</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x2c</span>]<span class="bn">,0x5</span></a>
<a class="sourceLine" id="cb68-11" title="11"><span class="fu"> 192:</span>   c7 <span class="dv">45</span> d8 <span class="dv">06</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x28</span>]<span class="bn">,0x6</span></a>
<a class="sourceLine" id="cb68-12" title="12"><span class="fu"> 199:</span>   8d <span class="dv">55</span> dc                <span class="bu">lea</span>    <span class="kw">edx</span>,[<span class="kw">ebp</span><span class="bn">-0x24</span>]</a>
<a class="sourceLine" id="cb68-13" title="13"><span class="fu"> 19c:</span>   b9 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>          <span class="bu">mov</span>    <span class="kw">ecx</span><span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb68-14" title="14"><span class="fu"> 1a1:</span>   b8 <span class="dv">18</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>          <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x18</span></a>
<a class="sourceLine" id="cb68-15" title="15"><span class="fu"> 1a6:</span>   <span class="dv">89</span> c3                   <span class="bu">mov</span>    <span class="kw">ebx</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb68-16" title="16"><span class="fu"> 1a8:</span>   <span class="dv">83</span> e3 fc                <span class="bu">and</span>    <span class="kw">ebx</span>,<span class="bn">0xfffffffc</span></a>
<a class="sourceLine" id="cb68-17" title="17"><span class="fu"> 1ab:</span>   b8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>          <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb68-18" title="18"><span class="fu"> 1b0:</span>   <span class="dv">89</span> 0c <span class="dv">02</span>                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">edx</span>+<span class="kw">eax</span>*<span class="dv">1</span>],<span class="kw">ecx</span></a>
<a class="sourceLine" id="cb68-19" title="19"><span class="fu"> 1b3:</span>   <span class="dv">83</span> c0 <span class="dv">04</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x4</span></a>
<a class="sourceLine" id="cb68-20" title="20"><span class="fu"> 1b6:</span>   <span class="dv">39</span> d8                   <span class="bu">cmp</span>    <span class="kw">eax</span>,<span class="kw">ebx</span></a>
<a class="sourceLine" id="cb68-21" title="21"><span class="fu"> 1b8:</span>   <span class="dv">72</span> f6                   <span class="bu">jb</span>     1b0 &lt;test_funcstructvalue+<span class="bn">0x48</span>&gt;</a>
<a class="sourceLine" id="cb68-22" title="22"><span class="fu"> 1ba:</span>   <span class="dv">01</span> c2                   <span class="bu">add</span>    <span class="kw">edx</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb68-23" title="23"><span class="fu"> 1bc:</span>   8d <span class="dv">45</span> dc                <span class="bu">lea</span>    <span class="kw">eax</span>,[<span class="kw">ebp</span><span class="bn">-0x24</span>]</a>
<a class="sourceLine" id="cb68-24" title="24"><span class="fu"> 1bf:</span>   <span class="dv">89</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">18</span>             <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x18</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb68-25" title="25"><span class="fu"> 1c3:</span>   8b <span class="dv">45</span> c4                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x3c</span>]</a>
<a class="sourceLine" id="cb68-26" title="26"><span class="fu"> 1c6:</span>   <span class="dv">89</span> <span class="dv">04</span> <span class="dv">24</span>                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb68-27" title="27"><span class="fu"> 1c9:</span>   8b <span class="dv">45</span> c8                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x38</span>]</a>
<a class="sourceLine" id="cb68-28" title="28"><span class="fu"> 1cc:</span>   <span class="dv">89</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">04</span>             <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb68-29" title="29"><span class="fu"> 1d0:</span>   8b <span class="dv">45</span> cc                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x34</span>]</a>
<a class="sourceLine" id="cb68-30" title="30"><span class="fu"> 1d3:</span>   <span class="dv">89</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">08</span>             <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x8</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb68-31" title="31"><span class="fu"> 1d7:</span>   8b <span class="dv">45</span> d0                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x30</span>]</a>
<a class="sourceLine" id="cb68-32" title="32"><span class="fu"> 1da:</span>   <span class="dv">89</span> <span class="dv">44</span> <span class="dv">24</span> 0c             <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0xc</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb68-33" title="33"><span class="fu"> 1de:</span>   8b <span class="dv">45</span> d4                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x2c</span>]</a>
<a class="sourceLine" id="cb68-34" title="34"><span class="fu"> 1e1:</span>   <span class="dv">89</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">10</span>             <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x10</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb68-35" title="35"><span class="fu"> 1e5:</span>   8b <span class="dv">45</span> d8                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x28</span>]</a>
<a class="sourceLine" id="cb68-36" title="36"><span class="fu"> 1e8:</span>   <span class="dv">89</span> <span class="dv">44</span> <span class="dv">24</span> <span class="dv">14</span>             <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x14</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb68-37" title="37"><span class="fu"> 1ec:</span>   e8 fc ff ff ff          <span class="bu">call</span>   1ed &lt;test_funcstructvalue+<span class="bn">0x85</span>&gt;</a>
<a class="sourceLine" id="cb68-38" title="38"><span class="fu"> 1f1:</span>   <span class="dv">83</span> c0 <span class="dv">01</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb68-39" title="39"><span class="fu"> 1f4:</span>   <span class="dv">89</span> <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb68-40" title="40"><span class="fu"> 1f7:</span>   8b <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb68-41" title="41"><span class="fu"> 1fa:</span>   <span class="dv">83</span> c4 <span class="dv">64</span>                <span class="bu">add</span>    <span class="kw">esp</span><span class="bn">,0x64</span></a>
<a class="sourceLine" id="cb68-42" title="42"><span class="fu"> 1fd:</span>   5b                      <span class="bu">pop</span>    <span class="kw">ebx</span></a>
<a class="sourceLine" id="cb68-43" title="43"><span class="fu"> 1fe:</span>   5d                      <span class="bu">pop</span>    <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb68-44" title="44"><span class="fu"> 1ff:</span>   c3                      <span class="bu">ret</span></a>
<a class="sourceLine" id="cb68-45" title="45"></a>
<a class="sourceLine" id="cb68-46" title="46"><span class="dv">00000126</span> &lt;funcstructvalue&gt;:</a>
<a class="sourceLine" id="cb68-47" title="47"><span class="fu"> 126:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb68-48" title="48"><span class="fu"> 127:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb68-49" title="49"><span class="fu"> 129:</span>   8b <span class="dv">55</span> <span class="dv">08</span>                <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x8</span>]</a>
<a class="sourceLine" id="cb68-50" title="50"><span class="fu"> 12c:</span>   8b <span class="dv">45</span> <span class="dv">20</span>                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x20</span>]</a>
<a class="sourceLine" id="cb68-51" title="51"><span class="fu"> 12f:</span>   8b <span class="dv">40</span> <span class="dv">04</span>                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">eax</span>+<span class="bn">0x4</span>]</a>
<a class="sourceLine" id="cb68-52" title="52"><span class="fu"> 132:</span>   <span class="dv">01</span> d0                   <span class="bu">add</span>    <span class="kw">eax</span>,<span class="kw">edx</span></a>
<a class="sourceLine" id="cb68-53" title="53"><span class="fu"> 134:</span>   5d                      <span class="bu">pop</span>    <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb68-54" title="54"><span class="fu"> 135:</span>   c3                      <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>Code lines <code>16f-192</code> initialises <code>struct mystruct x = {1, 2, 3, 4, 5, 6}</code>.</li>
<li>Code lines <code>199-1ba</code> initialise <code>struct mystruct y = {0, }</code>.</li>
<li>Code lines <code>1bc-1bf</code> stores the pointer to y on the stack as parameter 2.</li>
<li>Code lines <code>1c3-1e8</code> copies x to the stack for parameter 1 and is unrolled.</li>
<li>So the parameter x is passed on the stack, parameter 2 is immediately after the struct.</li>
<li>The register <code>EBX</code> is stored on the stack as it must be preserved between function calls.</li>
</ul>
<p>The stack in the caller, based on <code>EBP</code> of the callee <code>funcstructvalue</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+112]</code></td>
<td>EBP</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+108]</code></td>
<td>EBX</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+104]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+100]</code></td>
<td>int a = result + 1</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+96]</code></td>
<td>y.f = 0</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+92]</code></td>
<td>y.e = 0</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+88]</code></td>
<td>y.d = 0</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+84]</code></td>
<td>y.c = 0</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+80]</code></td>
<td>y.b = 0</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+76]</code></td>
<td>y.a = 0</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+72]</code></td>
<td>x.f = 6</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+68]</code></td>
<td>x.e = 5</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+64]</code></td>
<td>x.d = 4</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+60]</code></td>
<td>x.c = 3</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+56]</code></td>
<td>x.b = 2</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+52]</code></td>
<td>x.a = 1</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+48]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+44]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+40]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+36]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+32]</code></td>
<td>Parameter 2, <code>*y</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+28]</code></td>
<td>x.f</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+24]</code></td>
<td>x.e</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+20]</code></td>
<td>x.d</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+16]</code></td>
<td>x.c</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+12]</code></td>
<td>x.b</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+8]</code></td>
<td>Parameter 1, <code>x.a</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address, <code>0x1F1</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> preserved by the callee <code>funcstructvalue</code></td>
</tr>
</tbody>
</table>
<h4 id="returning-a-struct-by-value"><span class="header-section-number">5.1.4.9</span> Returning a Struct by Value</h4>
<p>Returning a struct by value is the most complicated calling method in the Sys V ABI.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb69-1" title="1"><span class="kw">struct</span> mystruct {</a>
<a class="sourceLine" id="cb69-2" title="2">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb69-3" title="3">  <span class="dt">int</span> b;</a>
<a class="sourceLine" id="cb69-4" title="4">  <span class="dt">int</span> c;</a>
<a class="sourceLine" id="cb69-5" title="5">  <span class="dt">int</span> d;</a>
<a class="sourceLine" id="cb69-6" title="6">  <span class="dt">int</span> e;</a>
<a class="sourceLine" id="cb69-7" title="7">  <span class="dt">int</span> f;</a>
<a class="sourceLine" id="cb69-8" title="8">};</a>
<a class="sourceLine" id="cb69-9" title="9"></a>
<a class="sourceLine" id="cb69-10" title="10"><span class="kw">struct</span> mystruct funcstructret(<span class="dt">int</span> a, <span class="dt">int</span> b)</a>
<a class="sourceLine" id="cb69-11" title="11">{</a>
<a class="sourceLine" id="cb69-12" title="12">  <span class="kw">struct</span> mystruct r = {<span class="dv">0</span>, };</a>
<a class="sourceLine" id="cb69-13" title="13">  r.a = a;</a>
<a class="sourceLine" id="cb69-14" title="14">  r.b = b;</a>
<a class="sourceLine" id="cb69-15" title="15">  <span class="cf">return</span> r;</a>
<a class="sourceLine" id="cb69-16" title="16">}</a>
<a class="sourceLine" id="cb69-17" title="17"></a>
<a class="sourceLine" id="cb69-18" title="18"><span class="dt">int</span> test_funcstructret(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb69-19" title="19">{</a>
<a class="sourceLine" id="cb69-20" title="20">  <span class="kw">struct</span> mystruct x;</a>
<a class="sourceLine" id="cb69-21" title="21">  x = funcstructret(<span class="dv">1</span>, <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb69-22" title="22">  <span class="cf">return</span> x.a;</a>
<a class="sourceLine" id="cb69-23" title="23">}</a></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb70-1" title="1"><span class="dv">00000200</span> &lt;test_funcstructret&gt;:</a>
<a class="sourceLine" id="cb70-2" title="2"><span class="fu"> 200:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb70-3" title="3"><span class="fu"> 201:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb70-4" title="4"><span class="fu"> 203:</span>   <span class="dv">83</span> ec <span class="dv">38</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x38</span></a>
<a class="sourceLine" id="cb70-5" title="5"><span class="fu"> 206:</span>   8d <span class="dv">45</span> e0                <span class="bu">lea</span>    <span class="kw">eax</span>,[<span class="kw">ebp</span><span class="bn">-0x20</span>]</a>
<a class="sourceLine" id="cb70-6" title="6"><span class="fu"> 209:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">08</span> <span class="dv">02</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x8</span>]<span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb70-7" title="7"><span class="fu"> 210:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb70-8" title="8"><span class="fu"> 211:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">04</span> <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x4</span>]<span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb70-9" title="9"><span class="fu"> 218:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb70-10" title="10"><span class="fu"> 219:</span>   <span class="dv">89</span> <span class="dv">04</span> <span class="dv">24</span>                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb70-11" title="11"><span class="fu"> 21c:</span>   e8 fc ff ff ff          <span class="bu">call</span>   21d &lt;test_funcstructret+<span class="bn">0x1d</span>&gt;</a>
<a class="sourceLine" id="cb70-12" title="12"><span class="fu"> 221:</span>   <span class="dv">83</span> ec <span class="dv">04</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x4</span></a>
<a class="sourceLine" id="cb70-13" title="13"><span class="fu"> 224:</span>   8b <span class="dv">45</span> e0                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x20</span>]</a>
<a class="sourceLine" id="cb70-14" title="14"><span class="fu"> 227:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb70-15" title="15"><span class="fu"> 228:</span>   c3                      <span class="bu">ret</span></a>
<a class="sourceLine" id="cb70-16" title="16"></a>
<a class="sourceLine" id="cb70-17" title="17"><span class="dv">00000136</span> &lt;funcstructret&gt;:</a>
<a class="sourceLine" id="cb70-18" title="18"><span class="fu"> 136:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb70-19" title="19"><span class="fu"> 137:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb70-20" title="20"><span class="fu"> 139:</span>   <span class="dv">53</span>                      <span class="bu">push</span>   <span class="kw">ebx</span></a>
<a class="sourceLine" id="cb70-21" title="21"><span class="fu"> 13a:</span>   <span class="dv">83</span> ec <span class="dv">20</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x20</span></a>
<a class="sourceLine" id="cb70-22" title="22"><span class="fu"> 13d:</span>   8d <span class="dv">55</span> e4                <span class="bu">lea</span>    <span class="kw">edx</span>,[<span class="kw">ebp</span><span class="bn">-0x1c</span>]</a>
<a class="sourceLine" id="cb70-23" title="23"><span class="fu"> 140:</span>   b9 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>          <span class="bu">mov</span>    <span class="kw">ecx</span><span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb70-24" title="24"><span class="fu"> 145:</span>   b8 <span class="dv">18</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>          <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x18</span></a>
<a class="sourceLine" id="cb70-25" title="25"><span class="fu"> 14a:</span>   <span class="dv">89</span> c3                   <span class="bu">mov</span>    <span class="kw">ebx</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb70-26" title="26"><span class="fu"> 14c:</span>   <span class="dv">83</span> e3 fc                <span class="bu">and</span>    <span class="kw">ebx</span>,<span class="bn">0xfffffffc</span></a>
<a class="sourceLine" id="cb70-27" title="27"><span class="fu"> 14f:</span>   b8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>          <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb70-28" title="28"><span class="fu"> 154:</span>   <span class="dv">89</span> 0c <span class="dv">02</span>                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">edx</span>+<span class="kw">eax</span>*<span class="dv">1</span>],<span class="kw">ecx</span></a>
<a class="sourceLine" id="cb70-29" title="29"><span class="fu"> 157:</span>   <span class="dv">83</span> c0 <span class="dv">04</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x4</span></a>
<a class="sourceLine" id="cb70-30" title="30"><span class="fu"> 15a:</span>   <span class="dv">39</span> d8                   <span class="bu">cmp</span>    <span class="kw">eax</span>,<span class="kw">ebx</span></a>
<a class="sourceLine" id="cb70-31" title="31"><span class="fu"> 15c:</span>   <span class="dv">72</span> f6                   <span class="bu">jb</span>     <span class="dv">154</span> &lt;funcstructret+<span class="bn">0x1e</span>&gt;</a>
<a class="sourceLine" id="cb70-32" title="32"><span class="fu"> 15e:</span>   <span class="dv">01</span> c2                   <span class="bu">add</span>    <span class="kw">edx</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb70-33" title="33"><span class="fu"> 160:</span>   8b <span class="dv">45</span> 0c                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0xc</span>]</a>
<a class="sourceLine" id="cb70-34" title="34"><span class="fu"> 163:</span>   <span class="dv">89</span> <span class="dv">45</span> e4                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x1c</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb70-35" title="35"><span class="fu"> 166:</span>   8b <span class="dv">45</span> <span class="dv">10</span>                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x10</span>]</a>
<a class="sourceLine" id="cb70-36" title="36"><span class="fu"> 169:</span>   <span class="dv">89</span> <span class="dv">45</span> e8                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x18</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb70-37" title="37"><span class="fu"> 16c:</span>   8b <span class="dv">45</span> <span class="dv">08</span>                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x8</span>]</a>
<a class="sourceLine" id="cb70-38" title="38"><span class="fu"> 16f:</span>   8b <span class="dv">55</span> e4                <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x1c</span>]</a>
<a class="sourceLine" id="cb70-39" title="39"><span class="fu"> 172:</span>   <span class="dv">89</span> <span class="dv">10</span>                   <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">eax</span>],<span class="kw">edx</span></a>
<a class="sourceLine" id="cb70-40" title="40"><span class="fu"> 174:</span>   8b <span class="dv">55</span> e8                <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x18</span>]</a>
<a class="sourceLine" id="cb70-41" title="41"><span class="fu"> 177:</span>   <span class="dv">89</span> <span class="dv">50</span> <span class="dv">04</span>                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">eax</span>+<span class="bn">0x4</span>],<span class="kw">edx</span></a>
<a class="sourceLine" id="cb70-42" title="42"><span class="fu"> 17a:</span>   8b <span class="dv">55</span> ec                <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x14</span>]</a>
<a class="sourceLine" id="cb70-43" title="43"><span class="fu"> 17d:</span>   <span class="dv">89</span> <span class="dv">50</span> <span class="dv">08</span>                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">eax</span>+<span class="bn">0x8</span>],<span class="kw">edx</span></a>
<a class="sourceLine" id="cb70-44" title="44"><span class="fu"> 180:</span>   8b <span class="dv">55</span> f0                <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x10</span>]</a>
<a class="sourceLine" id="cb70-45" title="45"><span class="fu"> 183:</span>   <span class="dv">89</span> <span class="dv">50</span> 0c                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">eax</span>+<span class="bn">0xc</span>],<span class="kw">edx</span></a>
<a class="sourceLine" id="cb70-46" title="46"><span class="fu"> 186:</span>   8b <span class="dv">55</span> f4                <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb70-47" title="47"><span class="fu"> 189:</span>   <span class="dv">89</span> <span class="dv">50</span> <span class="dv">10</span>                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">eax</span>+<span class="bn">0x10</span>],<span class="kw">edx</span></a>
<a class="sourceLine" id="cb70-48" title="48"><span class="fu"> 18c:</span>   8b <span class="dv">55</span> f8                <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb70-49" title="49"><span class="fu"> 18f:</span>   <span class="dv">89</span> <span class="dv">50</span> <span class="dv">14</span>                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">eax</span>+<span class="bn">0x14</span>],<span class="kw">edx</span></a>
<a class="sourceLine" id="cb70-50" title="50"><span class="fu"> 192:</span>   8b <span class="dv">45</span> <span class="dv">08</span>                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x8</span>]</a>
<a class="sourceLine" id="cb70-51" title="51"><span class="fu"> 195:</span>   <span class="dv">83</span> c4 <span class="dv">20</span>                <span class="bu">add</span>    <span class="kw">esp</span><span class="bn">,0x20</span></a>
<a class="sourceLine" id="cb70-52" title="52"><span class="fu"> 198:</span>   5b                      <span class="bu">pop</span>    <span class="kw">ebx</span></a>
<a class="sourceLine" id="cb70-53" title="53"><span class="fu"> 199:</span>   5d                      <span class="bu">pop</span>    <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb70-54" title="54"><span class="fu"> 19a:</span>   c2 <span class="dv">04</span> <span class="dv">00</span>                <span class="bu">ret</span><span class="bn">    0x4</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The first (hidden) parameter is a pointer to the callers stack, where the result should be given.</li>
<li>The return struct is not initialised by the caller.</li>
<li>Code lines <code>13a-15e</code> initialise <code>struct mystruct r = {0, }</code>.</li>
<li>Code lines <code>160-163</code> copy parameter a, <code>r.a = a</code>.</li>
<li>Code lines <code>166-169</code> copy parameter b, <code>r.b = b</code>.</li>
<li>Code lines <code>16c-18f</code> copy the local variable <code>r</code> to the pointer for the return struct parameter 0. Note, we’ve called this parameter 0, as it’s not explicit, but passed on the stack as if a pointer were given.</li>
<li>Code line <code>192</code> prepares the return value, which is parameter 0, or the pointer to the return struct as per the Sys V ABI.</li>
<li>The callee removes parameter 0 from the stack. This is different to the case if a function pointer was explicitly given in function signature. Thus, on return to the caller, <code>ESP</code> points to the first parameter (and not the pointer to the return value).</li>
</ul>
<p>The stack in the caller, based on <code>EBP</code> of the callee <code>funcstructret</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+64]</code></td>
<td><code>EBP</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+60]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+56]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+52]</code></td>
<td><code>return.f</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+48]</code></td>
<td><code>return.e</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+44]</code></td>
<td><code>return.d</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+40]</code></td>
<td><code>return.c</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+36]</code></td>
<td><code>return.b</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+32]</code></td>
<td><code>struct mystruct return</code>.a</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+28]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+24]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+20]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+16]</code></td>
<td>Parameter 2, value 2</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+12]</code></td>
<td>Parameter 1, value 1</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+8]</code></td>
<td>Parameter 0, pointer to return struct <code>EBP-32</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address, <code>0x221</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> preserved by the callee <code>funcstructret</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP-4]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP-8]</code></td>
<td>r.f</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP-12]</code></td>
<td>r.e</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP-16]</code></td>
<td>r.d</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP-20]</code></td>
<td>r.c</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP-24]</code></td>
<td>r.b</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP-28]</code></td>
<td>r.a</td>
</tr>
</tbody>
</table>
<h4 id="varargs"><span class="header-section-number">5.1.4.10</span> VarArgs</h4>
<div class="sourceCode" id="cb71"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb71-1" title="1"><span class="dt">int</span> funcvarargs(<span class="dt">int</span> cnt, ...)</a>
<a class="sourceLine" id="cb71-2" title="2">{</a>
<a class="sourceLine" id="cb71-3" title="3">  <span class="dt">va_list</span> argptr;</a>
<a class="sourceLine" id="cb71-4" title="4">  va_start(argptr, cnt);</a>
<a class="sourceLine" id="cb71-5" title="5">  <span class="dt">int</span> i, j = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb71-6" title="6"></a>
<a class="sourceLine" id="cb71-7" title="7">  <span class="cf">for</span> (i = <span class="dv">0</span>; i &lt; cnt; i++) j += va_arg(argptr, <span class="dt">int</span>);</a>
<a class="sourceLine" id="cb71-8" title="8">  <span class="cf">return</span> j;</a>
<a class="sourceLine" id="cb71-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb72-1" title="1">0000019d &lt;funcvarargs&gt;:</a>
<a class="sourceLine" id="cb72-2" title="2"><span class="fu"> 19d:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb72-3" title="3"><span class="fu"> 19e:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb72-4" title="4"><span class="fu"> 1a0:</span>   <span class="dv">83</span> ec <span class="dv">10</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x10</span></a>
<a class="sourceLine" id="cb72-5" title="5"><span class="fu"> 1a3:</span>   8d <span class="dv">55</span> 0c                <span class="bu">lea</span>    <span class="kw">edx</span>,[<span class="kw">ebp</span>+<span class="bn">0xc</span>]</a>
<a class="sourceLine" id="cb72-6" title="6"><span class="fu"> 1a6:</span>   8d <span class="dv">45</span> f4                <span class="bu">lea</span>    <span class="kw">eax</span>,[<span class="kw">ebp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb72-7" title="7"><span class="fu"> 1a9:</span>   <span class="dv">89</span> <span class="dv">10</span>                   <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">eax</span>],<span class="kw">edx</span></a>
<a class="sourceLine" id="cb72-8" title="8"><span class="fu"> 1ab:</span>   c7 <span class="dv">45</span> fc <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>]<span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb72-9" title="9"><span class="fu"> 1b2:</span>   c7 <span class="dv">45</span> f8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x8</span>]<span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb72-10" title="10"><span class="fu"> 1b9:</span>   eb <span class="dv">12</span>                   <span class="bu">jmp</span>    1cd &lt;funcvarargs+<span class="bn">0x30</span>&gt;</a>
<a class="sourceLine" id="cb72-11" title="11"><span class="fu"> 1bb:</span>   8b <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb72-12" title="12"><span class="fu"> 1be:</span>   8d <span class="dv">50</span> <span class="dv">04</span>                <span class="bu">lea</span>    <span class="kw">edx</span>,[<span class="kw">eax</span>+<span class="bn">0x4</span>]</a>
<a class="sourceLine" id="cb72-13" title="13"><span class="fu"> 1c1:</span>   <span class="dv">89</span> <span class="dv">55</span> f4                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>],<span class="kw">edx</span></a>
<a class="sourceLine" id="cb72-14" title="14"><span class="fu"> 1c4:</span>   8b <span class="dv">00</span>                   <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">eax</span>]</a>
<a class="sourceLine" id="cb72-15" title="15"><span class="fu"> 1c6:</span>   <span class="dv">01</span> <span class="dv">45</span> fc                <span class="bu">add</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb72-16" title="16"><span class="fu"> 1c9:</span>   <span class="dv">83</span> <span class="dv">45</span> f8 <span class="dv">01</span>             <span class="bu">add</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x8</span>]<span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb72-17" title="17"><span class="fu"> 1cd:</span>   8b <span class="dv">45</span> f8                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb72-18" title="18"><span class="fu"> 1d0:</span>   3b <span class="dv">45</span> <span class="dv">08</span>                <span class="bu">cmp</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span>+<span class="bn">0x8</span>]</a>
<a class="sourceLine" id="cb72-19" title="19"><span class="fu"> 1d3:</span>   7c e6                   <span class="bu">jl</span>     1bb &lt;funcvarargs+<span class="bn">0x1e</span>&gt;</a>
<a class="sourceLine" id="cb72-20" title="20"><span class="fu"> 1d5:</span>   8b <span class="dv">45</span> fc                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb72-21" title="21"><span class="fu"> 1d8:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb72-22" title="22"><span class="fu"> 1d9:</span>   c3                      <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The instruction <code>va_list argptr</code> allocates stack space as a pointer</li>
<li>The instruction <code>va_start(argptr, cnt)</code> sets <code>argptr</code> starting at parameter 2</li>
<li>There are no implicit instructions or values on the stack to indicate how many parameters there are. Thus it’s easy to override the stack if this function reads too many parameters!</li>
</ul>
<p>The stack in the caller, based on <code>EBP</code> of the callee <code>funcvarargs</code> looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dword ptr [EBP+28]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+24]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+20]</code></td>
<td>Parameter 4</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+16]</code></td>
<td>Parameter 3</td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+12]</code></td>
<td>Parameter 2</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP+8]</code></td>
<td>Parameter 1, <code>cnt</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP+4]</code></td>
<td>Callers <code>EIP</code> return address a</td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP]</code></td>
<td>Callers <code>EBP</code> preserved by the callee <code>funcvarargs</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP-4]</code></td>
<td><code>int j</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP-8]</code></td>
<td><code>int i</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [EBP-12]</code></td>
<td><code>argptr</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [EBP-16]</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>The code shows an important point from a security perspective. Take the <code>printf</code> instruction, which is also variadic. You should never accept a user provided string which can affect the number of parameters that are to read. e.g if the user were to enter a string in a textbox, you would happily read more data than is allocated on the stack. Your program should check all inputs and then call the variadic function.</p>
<h5 id="a-single-parameter"><span class="header-section-number">5.1.4.10.1</span> A Single Parameter</h5>
<div class="sourceCode" id="cb73"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb73-1" title="1"><span class="dt">int</span> test_funcvarargs1(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb73-2" title="2">{</a>
<a class="sourceLine" id="cb73-3" title="3">   <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb73-4" title="4">   a = funcvarargs(<span class="dv">1</span>) + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb73-5" title="5">   <span class="cf">return</span> a;</a>
<a class="sourceLine" id="cb73-6" title="6">}</a></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb74-1" title="1"><span class="dv">00000229</span> &lt;test_funcvarargs1&gt;:</a>
<a class="sourceLine" id="cb74-2" title="2"><span class="fu"> 229:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb74-3" title="3"><span class="fu"> 22a:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb74-4" title="4"><span class="fu"> 22c:</span>   <span class="dv">83</span> ec <span class="dv">28</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x28</span></a>
<a class="sourceLine" id="cb74-5" title="5"><span class="fu"> 22f:</span>   c7 <span class="dv">04</span> <span class="dv">24</span> <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>]<span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb74-6" title="6"><span class="fu"> 236:</span>   e8 fc ff ff ff          <span class="bu">call</span>   <span class="dv">237</span> &lt;test_funcvarargs1+<span class="bn">0xe</span>&gt;</a>
<a class="sourceLine" id="cb74-7" title="7"><span class="fu"> 23b:</span>   <span class="dv">83</span> c0 <span class="dv">01</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb74-8" title="8"><span class="fu"> 23e:</span>   <span class="dv">89</span> <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb74-9" title="9"><span class="fu"> 241:</span>   8b <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb74-10" title="10"><span class="fu"> 244:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb74-11" title="11"><span class="fu"> 245:</span>   c3                      <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>For one parameter, only one value is pushed on the stack.</li>
</ul>
<h5 id="four-parameters"><span class="header-section-number">5.1.4.10.2</span> Four Parameters</h5>
<div class="sourceCode" id="cb75"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb75-1" title="1"><span class="dt">int</span> test_funcvarargs4(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb75-2" title="2">{</a>
<a class="sourceLine" id="cb75-3" title="3">   <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb75-4" title="4">   a = funcvarargs(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>) + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb75-5" title="5">   <span class="cf">return</span> a;</a>
<a class="sourceLine" id="cb75-6" title="6">}</a></code></pre></div>
<div class="sourceCode" id="cb76"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb76-1" title="1"><span class="dv">00000246</span> &lt;test_funcvarargs4&gt;:</a>
<a class="sourceLine" id="cb76-2" title="2"><span class="fu"> 246:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb76-3" title="3"><span class="fu"> 247:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb76-4" title="4"><span class="fu"> 249:</span>   <span class="dv">83</span> ec <span class="dv">38</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x38</span></a>
<a class="sourceLine" id="cb76-5" title="5"><span class="fu"> 24c:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">10</span> <span class="dv">04</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x10</span>]<span class="bn">,0x4</span></a>
<a class="sourceLine" id="cb76-6" title="6"><span class="fu"> 253:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb76-7" title="7"><span class="fu"> 254:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> 0c <span class="dv">03</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0xc</span>]<span class="bn">,0x3</span></a>
<a class="sourceLine" id="cb76-8" title="8"><span class="fu"> 25b:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb76-9" title="9"><span class="fu"> 25c:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">08</span> <span class="dv">02</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x8</span>]<span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb76-10" title="10"><span class="fu"> 263:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb76-11" title="11"><span class="fu"> 264:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">04</span> <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x4</span>]<span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb76-12" title="12"><span class="fu"> 26b:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb76-13" title="13"><span class="fu"> 26c:</span>   c7 <span class="dv">04</span> <span class="dv">24</span> <span class="dv">04</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>]<span class="bn">,0x4</span></a>
<a class="sourceLine" id="cb76-14" title="14"><span class="fu"> 273:</span>   e8 fc ff ff ff          <span class="bu">call</span>   <span class="dv">274</span> &lt;test_funcvarargs4+<span class="bn">0x2e</span>&gt;</a>
<a class="sourceLine" id="cb76-15" title="15"><span class="fu"> 278:</span>   <span class="dv">83</span> c0 <span class="dv">01</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb76-16" title="16"><span class="fu"> 27b:</span>   <span class="dv">89</span> <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb76-17" title="17"><span class="fu"> 27e:</span>   8b <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb76-18" title="18"><span class="fu"> 281:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb76-19" title="19"><span class="fu"> 282:</span>   c3                      <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>As to be expected, values are pushed on the stack so the first parameter is at the lowest address.</li>
</ul>
<h5 id="six-parameters"><span class="header-section-number">5.1.4.10.3</span> Six Parameters</h5>
<div class="sourceCode" id="cb77"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb77-1" title="1"><span class="dt">int</span> test_funcvarargs6(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb77-2" title="2">{</a>
<a class="sourceLine" id="cb77-3" title="3">   <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb77-4" title="4">   a = funcvarargs(<span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">12</span>) + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb77-5" title="5">   <span class="cf">return</span> a;</a>
<a class="sourceLine" id="cb77-6" title="6">}</a></code></pre></div>
<div class="sourceCode" id="cb78"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb78-1" title="1"><span class="dv">00000283</span> &lt;test_funcvarargs6&gt;:</a>
<a class="sourceLine" id="cb78-2" title="2"><span class="fu"> 283:</span>   <span class="dv">55</span>                      <span class="bu">push</span>   <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb78-3" title="3"><span class="fu"> 284:</span>   <span class="dv">89</span> e5                   <span class="bu">mov</span>    <span class="kw">ebp</span>,<span class="kw">esp</span></a>
<a class="sourceLine" id="cb78-4" title="4"><span class="fu"> 286:</span>   <span class="dv">83</span> ec <span class="dv">38</span>                <span class="bu">sub</span>    <span class="kw">esp</span><span class="bn">,0x38</span></a>
<a class="sourceLine" id="cb78-5" title="5"><span class="fu"> 289:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">18</span> 0c <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x18</span>],<span class="bn">0xc</span></a>
<a class="sourceLine" id="cb78-6" title="6"><span class="fu"> 290:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb78-7" title="7"><span class="fu"> 291:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">14</span> 0a <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x14</span>],<span class="bn">0xa</span></a>
<a class="sourceLine" id="cb78-8" title="8"><span class="fu"> 298:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb78-9" title="9"><span class="fu"> 299:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">10</span> <span class="dv">08</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x10</span>]<span class="bn">,0x8</span></a>
<a class="sourceLine" id="cb78-10" title="10"><span class="fu"> 2a0:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb78-11" title="11"><span class="fu"> 2a1:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> 0c <span class="dv">06</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0xc</span>]<span class="bn">,0x6</span></a>
<a class="sourceLine" id="cb78-12" title="12"><span class="fu"> 2a8:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb78-13" title="13"><span class="fu"> 2a9:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">08</span> <span class="dv">04</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x8</span>]<span class="bn">,0x4</span></a>
<a class="sourceLine" id="cb78-14" title="14"><span class="fu"> 2b0:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb78-15" title="15"><span class="fu"> 2b1:</span>   c7 <span class="dv">44</span> <span class="dv">24</span> <span class="dv">04</span> <span class="dv">02</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>+<span class="bn">0x4</span>]<span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb78-16" title="16"><span class="fu"> 2b8:</span>   <span class="dv">00</span></a>
<a class="sourceLine" id="cb78-17" title="17"><span class="fu"> 2b9:</span>   c7 <span class="dv">04</span> <span class="dv">24</span> <span class="dv">06</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>    <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">esp</span>]<span class="bn">,0x6</span></a>
<a class="sourceLine" id="cb78-18" title="18"><span class="fu"> 2c0:</span>   e8 fc ff ff ff          <span class="bu">call</span>   2c1 &lt;test_funcvarargs6+<span class="bn">0x3e</span>&gt;</a>
<a class="sourceLine" id="cb78-19" title="19"><span class="fu"> 2c5:</span>   <span class="dv">83</span> c0 <span class="dv">01</span>                <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb78-20" title="20"><span class="fu"> 2c8:</span>   <span class="dv">89</span> <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb78-21" title="21"><span class="fu"> 2cb:</span>   8b <span class="dv">45</span> f4                <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">ebp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb78-22" title="22"><span class="fu"> 2ce:</span>   c9                      <span class="bu">leave</span></a>
<a class="sourceLine" id="cb78-23" title="23"><span class="fu"> 2cf:</span>   c3                      <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>As to be expected, values are pushed on the stack so the first parameter is at the lowest address.</li>
</ul>
<h2 id="gcc-64-bit-9.3.0-ubuntu-20.04"><span class="header-section-number">5.2</span> GCC: 64-bit 9.3.0 Ubuntu 20.04</h2>
<h3 id="naming-convention-3"><span class="header-section-number">5.2.1</span> Naming Convention</h3>
<p>The names of functions when calling using <code>extern &quot;C&quot;</code> are as is.</p>
<h3 id="register-usage"><span class="header-section-number">5.2.2</span> Register Usage</h3>
<p>The following registers are considered scratch registers, the callee doesn’t need to preserve their values before and after the function call.</p>
<table>
<colgroup>
<col style="width: 14%"></col>
<col style="width: 71%"></col>
<col style="width: 13%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Register</th>
<th>Usage</th>
<th>Must Preserve</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>RAX</code></td>
<td>Varargs vector register count or scratch on input. Result on output.</td>
<td>No</td>
</tr>
<tr class="even">
<td><code>RBX</code></td>
<td></td>
<td>Yes</td>
</tr>
<tr class="odd">
<td><code>RCX</code></td>
<td>Integer Parameter #4.</td>
<td>No</td>
</tr>
<tr class="even">
<td><code>RDX</code></td>
<td>Integer Parameter #3. (Optional) result on output.</td>
<td>No</td>
</tr>
<tr class="odd">
<td><code>RSP</code></td>
<td>Stack pointer.</td>
<td>Yes</td>
</tr>
<tr class="even">
<td><code>RBP</code></td>
<td>Stack Frame Pointer.</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td><code>RSI</code></td>
<td>Integer Parameter #2.</td>
<td>No</td>
</tr>
<tr class="even">
<td><code>RDI</code></td>
<td>Integer Parameter #1.</td>
<td>No</td>
</tr>
<tr class="odd">
<td><code>R8</code></td>
<td>Integer Parameter #5.</td>
<td>No</td>
</tr>
<tr class="even">
<td><code>R8</code></td>
<td>Integer Parameter #6.</td>
<td>No</td>
</tr>
<tr class="odd">
<td><code>R10</code></td>
<td>Functions static chain pointer</td>
<td>No</td>
</tr>
<tr class="even">
<td><code>R11</code></td>
<td>scratch</td>
<td>No</td>
</tr>
<tr class="odd">
<td><code>R12</code>-<code>R14</code></td>
<td></td>
<td>Yes</td>
</tr>
<tr class="even">
<td><code>R15</code></td>
<td>(Optional) Global Offset Table Base Pointer</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td><code>XMM0</code>-<code>XMM1</code></td>
<td>Float Parameter #1, #2. Result on output</td>
<td>No</td>
</tr>
<tr class="even">
<td><code>XMM2</code>-<code>XMM7</code></td>
<td>Float Parameter #3-#8.</td>
<td>No</td>
</tr>
<tr class="odd">
<td><code>XMM8</code>-<code>XMM15</code></td>
<td>scratch</td>
<td>No</td>
</tr>
<tr class="even">
<td><code>st0</code>-<code>st1</code></td>
<td>scratch. Result on output <code>long double</code>.</td>
<td>No</td>
</tr>
<tr class="odd">
<td><code>st2</code>-<code>st7</code></td>
<td>scratch</td>
<td>No</td>
</tr>
<tr class="even">
<td>x87 sw</td>
<td>x87 status word</td>
<td>No</td>
</tr>
<tr class="odd">
<td>x87 cw</td>
<td>x87 control world</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h3 id="stack-alignment"><span class="header-section-number">5.2.3</span> Stack Alignment</h3>
<p>The stack frames are expected to be aligned on 16-byte boundaries.</p>
<h3 id="the-stack-red-zone"><span class="header-section-number">5.2.4</span> The Stack Red Zone</h3>
<p>The Sys V ABI specifies a <em>red zone</em> for 64-bit, which is 128 bytes below the stack pointer register <code>RSP</code> (e.g. from the current address, to <code>RSP</code> - 128). As the function might push and pop from the stack, so changes the red zone.</p>
<p>The Red Zone is important that it may not be modified by interrupt handlers or signal handlers. This allows functions an optimization that it doesn’t necessarily have to allocate space for the stack if it is less than 128 bytes.</p>
<h3 id="parameter-passing"><span class="header-section-number">5.2.5</span> Parameter Passing</h3>
<p>The first 6 integer parameters (<code>bool</code>, <code>char</code>, <code>short</code>, <code>int</code>, <code>long</code>, <code>long long</code> and pointers) of a function are passed via the registers <code>RDI</code>, <code>RSI</code>, <code>RDX</code>, <code>RCX</code>, <code>R8</code> and <code>R9</code>.</p>
<p>Arguments <code>float</code>, <code>double</code> are passed into <code>XMM0</code>-<code>XMM7</code>.</p>
<h3 id="intel-cet-instructions"><span class="header-section-number">5.2.6</span> Intel CET Instructions</h3>
<p>Many functions, when dumped in their assembly form, show the <code>endbr64</code> instruction at the start of each function. This is part of Intel’s Control-flow Enforcement Technology. The <code>endbr64</code> and <code>endbr32</code> is equivalent to a <code>nop</code> instruction on processors that do not support <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/technical-look-control-flow-enforcement-technology.html">CET</a>.</p>
<p>This function is emitted in GCC 8 and later.</p>
<h3 id="examples-3"><span class="header-section-number">5.2.7</span> Examples</h3>
<p>The examples provided are compiled using the GCC compiler. Disassembly of the functions is done on the object files before linking, thus the <code>call</code> instructions reference function names but the offsets have not yet been patched by the linker.</p>
<h4 id="bit-integer-return-value-2"><span class="header-section-number">5.2.7.1</span> 32-bit Integer Return Value</h4>
<div class="sourceCode" id="cb79"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb79-1" title="1"><span class="dt">int</span> funcintr(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb79-2" title="2">{</a>
<a class="sourceLine" id="cb79-3" title="3">  <span class="cf">return</span> <span class="dv">42</span>;</a>
<a class="sourceLine" id="cb79-4" title="4">}</a>
<a class="sourceLine" id="cb79-5" title="5"></a>
<a class="sourceLine" id="cb79-6" title="6"><span class="dt">int</span> test_funcintr(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb79-7" title="7">{</a>
<a class="sourceLine" id="cb79-8" title="8">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb79-9" title="9">  a = funcintr() + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb79-10" title="10">  <span class="cf">return</span> a;</a>
<a class="sourceLine" id="cb79-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb80"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb80-1" title="1">000000000000145b &lt;test_funcintr&gt;:</a>
<a class="sourceLine" id="cb80-2" title="2"><span class="fu">    145b:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb80-3" title="3"><span class="fu">    145f:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb80-4" title="4"><span class="fu">    1460:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb80-5" title="5"><span class="fu">    1463:</span> <span class="dv">48</span> <span class="dv">83</span> ec <span class="dv">10</span>           <span class="bu">sub</span>    <span class="kw">rsp</span><span class="bn">,0x10</span></a>
<a class="sourceLine" id="cb80-6" title="6"><span class="fu">    1467:</span> e8 <span class="dt">dd</span> fc ff ff        <span class="bu">call</span>   <span class="dv">1149</span> &lt;funcintr&gt;</a>
<a class="sourceLine" id="cb80-7" title="7"><span class="fu">    146c:</span> <span class="dv">83</span> c0 <span class="dv">01</span>              <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb80-8" title="8"><span class="fu">    146f:</span> <span class="dv">89</span> <span class="dv">45</span> fc              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb80-9" title="9"><span class="fu">    1472:</span> 8b <span class="dv">45</span> fc              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb80-10" title="10"><span class="fu">    1475:</span> c9                    <span class="bu">leave</span></a>
<a class="sourceLine" id="cb80-11" title="11"><span class="fu">    1476:</span> c3                    <span class="bu">ret</span></a>
<a class="sourceLine" id="cb80-12" title="12"></a>
<a class="sourceLine" id="cb80-13" title="13"><span class="dv">0000000000001149</span> &lt;funcintr&gt;:</a>
<a class="sourceLine" id="cb80-14" title="14"><span class="fu">    1149:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb80-15" title="15"><span class="fu">    114d:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb80-16" title="16"><span class="fu">    114e:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb80-17" title="17"><span class="fu">    1151:</span> b8 2a <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>        <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x2a</span></a>
<a class="sourceLine" id="cb80-18" title="18"><span class="fu">    1156:</span> 5d                    <span class="bu">pop</span>    <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb80-19" title="19"><span class="fu">    1157:</span> c3                    <span class="bu">ret</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>The result is placed in the register <code>EAX</code>, which is the 32-bit version.</li>
<li>The caller has allocated 16-bytes stack for itself, which is used to hold the variable <code>a</code> (<code>[rbp-0x4]</code>).</li>
<li>The second <code>mov</code> instruction at line <code>1472</code> is generated by the <code>return a;</code> instruction, that must put the value of <code>a</code> into <code>EAX</code>.</li>
</ul>
<p>The callee doesn’t have any parameters and doesn’t use the stack except to store the stack frame pointer, so we don’t describe the stack frame here.</p>
<h4 id="bit-integer-return-value-3"><span class="header-section-number">5.2.7.2</span> 64-bit Integer Return Value</h4>
<h5 id="bit-return-in-full-64-bits-1"><span class="header-section-number">5.2.7.2.1</span> 64-bit return in full 64-bits</h5>
<div class="sourceCode" id="cb81"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb81-1" title="1"><span class="dt">uint64_t</span> funcint64r(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb81-2" title="2">{</a>
<a class="sourceLine" id="cb81-3" title="3">  <span class="cf">return</span> <span class="bn">0x4200000000</span>;</a>
<a class="sourceLine" id="cb81-4" title="4">}</a>
<a class="sourceLine" id="cb81-5" title="5"></a>
<a class="sourceLine" id="cb81-6" title="6"><span class="dt">int</span> test_funcint64r(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb81-7" title="7">{</a>
<a class="sourceLine" id="cb81-8" title="8">  <span class="dt">uint64_t</span> a;</a>
<a class="sourceLine" id="cb81-9" title="9">  a = funcint64r() + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb81-10" title="10">  <span class="cf">return</span> (<span class="dt">int</span>)a;</a>
<a class="sourceLine" id="cb81-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb82-1" title="1"><span class="dv">0000000000001477</span> &lt;test_funcint64r&gt;:</a>
<a class="sourceLine" id="cb82-2" title="2"><span class="fu">    1477:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb82-3" title="3"><span class="fu">    147b:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb82-4" title="4"><span class="fu">    147c:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb82-5" title="5"><span class="fu">    147f:</span> <span class="dv">48</span> <span class="dv">83</span> ec <span class="dv">10</span>           <span class="bu">sub</span>    <span class="kw">rsp</span><span class="bn">,0x10</span></a>
<a class="sourceLine" id="cb82-6" title="6"><span class="fu">    1483:</span> e8 d0 fc ff ff        <span class="bu">call</span>   <span class="dv">1158</span> &lt;funcint64r&gt;</a>
<a class="sourceLine" id="cb82-7" title="7"><span class="fu">    1488:</span> <span class="dv">48</span> <span class="dv">83</span> c0 <span class="dv">01</span>           <span class="bu">add</span>    <span class="kw">rax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb82-8" title="8"><span class="fu">    148c:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">45</span> f8           <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb82-9" title="9"><span class="fu">    1490:</span> <span class="dv">48</span> 8b <span class="dv">45</span> f8           <span class="bu">mov</span>    <span class="kw">rax</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb82-10" title="10"><span class="fu">    1494:</span> c9                    <span class="bu">leave</span></a>
<a class="sourceLine" id="cb82-11" title="11"><span class="fu">    1495:</span> c3                    <span class="bu">ret</span></a>
<a class="sourceLine" id="cb82-12" title="12"></a>
<a class="sourceLine" id="cb82-13" title="13"><span class="dv">0000000000001158</span> &lt;funcint64r&gt;:</a>
<a class="sourceLine" id="cb82-14" title="14"><span class="fu">    1158:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb82-15" title="15"><span class="fu">    115c:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb82-16" title="16"><span class="fu">    115d:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb82-17" title="17"><span class="fu">    1160:</span> <span class="dv">48</span> b8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">42</span>  movabs <span class="kw">rax</span><span class="bn">,0x4200000000</span></a>
<a class="sourceLine" id="cb82-18" title="18"><span class="fu">    1167:</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb82-19" title="19"><span class="fu">    116a:</span> 5d                    <span class="bu">pop</span>    <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb82-20" title="20"><span class="fu">    116b:</span> c3                    <span class="bu">ret</span></a></code></pre></div>
<h5 id="bit-return-needing-only-32-bits-1"><span class="header-section-number">5.2.7.2.2</span> 64-bit Return Needing only 32-bits</h5>
<div class="sourceCode" id="cb83"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb83-1" title="1"><span class="dt">uint64_t</span> funcint64r2(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb83-2" title="2">{</a>
<a class="sourceLine" id="cb83-3" title="3">  <span class="cf">return</span> <span class="dv">42</span>;</a>
<a class="sourceLine" id="cb83-4" title="4">}</a>
<a class="sourceLine" id="cb83-5" title="5"></a>
<a class="sourceLine" id="cb83-6" title="6"><span class="dt">int</span> test_funcint64r2(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb83-7" title="7">{</a>
<a class="sourceLine" id="cb83-8" title="8">  <span class="dt">uint64_t</span> a;</a>
<a class="sourceLine" id="cb83-9" title="9">  a = funcint64r2() + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb83-10" title="10">  <span class="cf">return</span> (<span class="dt">int</span>)a;</a>
<a class="sourceLine" id="cb83-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb84-1" title="1"><span class="dv">0000000000001496</span> &lt;test_funcint64r2&gt;:</a>
<a class="sourceLine" id="cb84-2" title="2"><span class="fu">    1496:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb84-3" title="3"><span class="fu">    149a:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb84-4" title="4"><span class="fu">    149b:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb84-5" title="5"><span class="fu">    149e:</span> <span class="dv">48</span> <span class="dv">83</span> ec <span class="dv">10</span>           <span class="bu">sub</span>    <span class="kw">rsp</span><span class="bn">,0x10</span></a>
<a class="sourceLine" id="cb84-6" title="6"><span class="fu">    14a2:</span> e8 c5 fc ff ff        <span class="bu">call</span>   116c &lt;funcint64r2&gt;</a>
<a class="sourceLine" id="cb84-7" title="7"><span class="fu">    14a7:</span> <span class="dv">48</span> <span class="dv">83</span> c0 <span class="dv">01</span>           <span class="bu">add</span>    <span class="kw">rax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb84-8" title="8"><span class="fu">    14ab:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">45</span> f8           <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb84-9" title="9"><span class="fu">    14af:</span> <span class="dv">48</span> 8b <span class="dv">45</span> f8           <span class="bu">mov</span>    <span class="kw">rax</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb84-10" title="10"><span class="fu">    14b3:</span> c9                    <span class="bu">leave</span></a>
<a class="sourceLine" id="cb84-11" title="11"><span class="fu">    14b4:</span> c3                    <span class="bu">ret</span></a>
<a class="sourceLine" id="cb84-12" title="12"></a>
<a class="sourceLine" id="cb84-13" title="13">000000000000116c &lt;funcint64r2&gt;:</a>
<a class="sourceLine" id="cb84-14" title="14"><span class="fu">    116c:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb84-15" title="15"><span class="fu">    1170:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb84-16" title="16"><span class="fu">    1171:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb84-17" title="17"><span class="fu">    1174:</span> b8 2a <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>        <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x2a</span></a>
<a class="sourceLine" id="cb84-18" title="18"><span class="fu">    1179:</span> 5d                    <span class="bu">pop</span>    <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb84-19" title="19"><span class="fu">    117a:</span> c3                    <span class="bu">ret</span></a></code></pre></div>
<p>Observations:</p>
<ul>
<li>The function <code>mov eax,0x2a</code> automatically zeroes the upper 32-bits, and although it’s written as a 32-bit instruction, it performs the desired result of copying the value 42 into the 64-bit register correctly. Thus this is the same as moving the value 42 into <code>RAX</code> but requires fewer bytes to do so.</li>
<li>Even though the result should return a 32-bit value, we see that the compiler still returns the 64-bit register <code>RAX</code>. As such, this function looks identical to one that returns a 64-bit value.</li>
</ul>
<h4 id="integer-parameters-1"><span class="header-section-number">5.2.7.3</span> Integer Parameters</h4>
<div class="sourceCode" id="cb85"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb85-1" title="1"><span class="dt">int</span> funcint(<span class="dt">int</span> a, <span class="dt">int</span> b, <span class="dt">int</span> c)</a>
<a class="sourceLine" id="cb85-2" title="2">{</a>
<a class="sourceLine" id="cb85-3" title="3">  <span class="cf">return</span> (a + <span class="dv">1</span>) * (b + <span class="dv">2</span>) * (c + <span class="dv">3</span>);</a>
<a class="sourceLine" id="cb85-4" title="4">}</a>
<a class="sourceLine" id="cb85-5" title="5"></a>
<a class="sourceLine" id="cb85-6" title="6"><span class="dt">int</span> test_funcint(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb85-7" title="7">{</a>
<a class="sourceLine" id="cb85-8" title="8">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb85-9" title="9">  a = funcint(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>) + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb85-10" title="10">  <span class="cf">return</span> a;</a>
<a class="sourceLine" id="cb85-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb86"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb86-1" title="1">00000000000014b5 &lt;test_funcint&gt;:</a>
<a class="sourceLine" id="cb86-2" title="2"><span class="fu">    14b5:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb86-3" title="3"><span class="fu">    14b9:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb86-4" title="4"><span class="fu">    14ba:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb86-5" title="5"><span class="fu">    14bd:</span> <span class="dv">48</span> <span class="dv">83</span> ec <span class="dv">10</span>           <span class="bu">sub</span>    <span class="kw">rsp</span><span class="bn">,0x10</span></a>
<a class="sourceLine" id="cb86-6" title="6"><span class="fu">    14c1:</span> ba <span class="dv">03</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>        <span class="bu">mov</span>    <span class="kw">edx</span><span class="bn">,0x3</span></a>
<a class="sourceLine" id="cb86-7" title="7"><span class="fu">    14c6:</span> be <span class="dv">02</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>        <span class="bu">mov</span>    <span class="kw">esi</span><span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb86-8" title="8"><span class="fu">    14cb:</span> bf <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>        <span class="bu">mov</span>    <span class="kw">edi</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb86-9" title="9"><span class="fu">    14d0:</span> e8 a6 fc ff ff        <span class="bu">call</span>   117b &lt;funcint&gt;</a>
<a class="sourceLine" id="cb86-10" title="10"><span class="fu">    14d5:</span> <span class="dv">83</span> c0 <span class="dv">01</span>              <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb86-11" title="11"><span class="fu">    14d8:</span> <span class="dv">89</span> <span class="dv">45</span> fc              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb86-12" title="12"><span class="fu">    14db:</span> 8b <span class="dv">45</span> fc              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb86-13" title="13"><span class="fu">    14de:</span> c9                    <span class="bu">leave</span></a>
<a class="sourceLine" id="cb86-14" title="14"><span class="fu">    14df:</span> c3                    <span class="bu">ret</span></a>
<a class="sourceLine" id="cb86-15" title="15"></a>
<a class="sourceLine" id="cb86-16" title="16">000000000000117b &lt;funcint&gt;:</a>
<a class="sourceLine" id="cb86-17" title="17"><span class="fu">    117b:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb86-18" title="18"><span class="fu">    117f:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb86-19" title="19"><span class="fu">    1180:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb86-20" title="20"><span class="fu">    1183:</span> <span class="dv">89</span> 7d fc              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>],<span class="kw">edi</span></a>
<a class="sourceLine" id="cb86-21" title="21"><span class="fu">    1186:</span> <span class="dv">89</span> <span class="dv">75</span> f8              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>],<span class="kw">esi</span></a>
<a class="sourceLine" id="cb86-22" title="22"><span class="fu">    1189:</span> <span class="dv">89</span> <span class="dv">55</span> f4              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xc</span>],<span class="kw">edx</span></a>
<a class="sourceLine" id="cb86-23" title="23"><span class="fu">    118c:</span> 8b <span class="dv">45</span> fc              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb86-24" title="24"><span class="fu">    118f:</span> 8d <span class="dv">50</span> <span class="dv">01</span>              <span class="bu">lea</span>    <span class="kw">edx</span>,[<span class="kw">rax</span>+<span class="bn">0x1</span>]</a>
<a class="sourceLine" id="cb86-25" title="25"><span class="fu">    1192:</span> 8b <span class="dv">45</span> f8              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb86-26" title="26"><span class="fu">    1195:</span> <span class="dv">83</span> c0 <span class="dv">02</span>              <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb86-27" title="27"><span class="fu">    1198:</span> 0f af c2              <span class="bu">imul</span>   <span class="kw">eax</span>,<span class="kw">edx</span></a>
<a class="sourceLine" id="cb86-28" title="28"><span class="fu">    119b:</span> 8b <span class="dv">55</span> f4              <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb86-29" title="29"><span class="fu">    119e:</span> <span class="dv">83</span> c2 <span class="dv">03</span>              <span class="bu">add</span>    <span class="kw">edx</span><span class="bn">,0x3</span></a>
<a class="sourceLine" id="cb86-30" title="30"><span class="fu">    11a1:</span> 0f af c2              <span class="bu">imul</span>   <span class="kw">eax</span>,<span class="kw">edx</span></a>
<a class="sourceLine" id="cb86-31" title="31"><span class="fu">    11a4:</span> 5d                    <span class="bu">pop</span>    <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb86-32" title="32"><span class="fu">    11a5:</span> c3                    <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The caller puts the parameters into registers <code>RDI</code>, <code>RSI</code>, <code>RDX</code>. It is up to the callee to copy it onto its own stack. If there were six parameters, it would continue in <code>RCX</code>, <code>R8</code> and <code>R9</code>.</li>
<li>The callee pushes the value onto the stack (or more correctly, it copies it into the memory onto the stack but doesn’t update the stack pointer). This is put in the red zone of the function stack.</li>
<li>The first parameter has the highest address (see stack frame below)</li>
</ul>
<p>The stack frame of <code>funcint</code>, referenced by <code>RBP</code>, looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RBP+8]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP]</code></td>
<td>Callers <code>RBP</code> preserved by the callee <code>funcint</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP-4]</code></td>
<td><code>funcint</code> Parameter 1, <code>int a</code> copied from <code>EDI</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP-8]</code></td>
<td><code>funcint</code> Parameter 2, <code>int b</code> copied from <code>ESI</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP-12]</code></td>
<td><code>funcint</code> Parameter 3, <code>int c</code> copied from <code>EDX</code></td>
</tr>
</tbody>
</table>
<h4 id="char-parameters-1"><span class="header-section-number">5.2.7.4</span> Char Parameters</h4>
<div class="sourceCode" id="cb87"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb87-1" title="1"><span class="dt">int</span> funcchar(<span class="dt">char</span> a, <span class="dt">char</span> b)</a>
<a class="sourceLine" id="cb87-2" title="2">{</a>
<a class="sourceLine" id="cb87-3" title="3">  <span class="cf">return</span> (a + <span class="dv">1</span>) * (b + <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb87-4" title="4">}</a>
<a class="sourceLine" id="cb87-5" title="5"></a>
<a class="sourceLine" id="cb87-6" title="6"><span class="dt">int</span> test_funcchar(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb87-7" title="7">{</a>
<a class="sourceLine" id="cb87-8" title="8">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb87-9" title="9">  a = funcchar(<span class="dv">1</span>, <span class="dv">2</span>) + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb87-10" title="10">  <span class="cf">return</span> a;</a>
<a class="sourceLine" id="cb87-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb88"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb88-1" title="1"><span class="fl">00000000000014e0</span> &lt;test_funcchar&gt;:</a>
<a class="sourceLine" id="cb88-2" title="2"><span class="fu">    14e0:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb88-3" title="3"><span class="fu">    14e4:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb88-4" title="4"><span class="fu">    14e5:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb88-5" title="5"><span class="fu">    14e8:</span> <span class="dv">48</span> <span class="dv">83</span> ec <span class="dv">10</span>           <span class="bu">sub</span>    <span class="kw">rsp</span><span class="bn">,0x10</span></a>
<a class="sourceLine" id="cb88-6" title="6"><span class="fu">    14ec:</span> be <span class="dv">02</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>        <span class="bu">mov</span>    <span class="kw">esi</span><span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb88-7" title="7"><span class="fu">    14f1:</span> bf <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>        <span class="bu">mov</span>    <span class="kw">edi</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb88-8" title="8"><span class="fu">    14f6:</span> e8 ab fc ff ff        <span class="bu">call</span>   11a6 &lt;funcchar&gt;</a>
<a class="sourceLine" id="cb88-9" title="9"><span class="fu">    14fb:</span> <span class="dv">83</span> c0 <span class="dv">01</span>              <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb88-10" title="10"><span class="fu">    14fe:</span> <span class="dv">89</span> <span class="dv">45</span> fc              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb88-11" title="11"><span class="fu">    1501:</span> 8b <span class="dv">45</span> fc              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb88-12" title="12"><span class="fu">    1504:</span> c9                    <span class="bu">leave</span></a>
<a class="sourceLine" id="cb88-13" title="13"><span class="fu">    1505:</span> c3                    <span class="bu">ret</span></a>
<a class="sourceLine" id="cb88-14" title="14"></a>
<a class="sourceLine" id="cb88-15" title="15">00000000000011a6 &lt;funcchar&gt;:</a>
<a class="sourceLine" id="cb88-16" title="16"><span class="fu">    11a6:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb88-17" title="17"><span class="fu">    11aa:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb88-18" title="18"><span class="fu">    11ab:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb88-19" title="19"><span class="fu">    11ae:</span> <span class="dv">89</span> fa                 <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="kw">edi</span></a>
<a class="sourceLine" id="cb88-20" title="20"><span class="fu">    11b0:</span> <span class="dv">89</span> f0                 <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="kw">esi</span></a>
<a class="sourceLine" id="cb88-21" title="21"><span class="fu">    11b2:</span> <span class="dv">88</span> <span class="dv">55</span> fc              <span class="bu">mov</span>    <span class="dt">BYTE</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>],<span class="kw">dl</span></a>
<a class="sourceLine" id="cb88-22" title="22"><span class="fu">    11b5:</span> <span class="dv">88</span> <span class="dv">45</span> f8              <span class="bu">mov</span>    <span class="dt">BYTE</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>],<span class="kw">al</span></a>
<a class="sourceLine" id="cb88-23" title="23"><span class="fu">    11b8:</span> 0f be <span class="dv">45</span> fc           <span class="bu">movsx</span>  <span class="kw">eax</span>,<span class="dt">BYTE</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb88-24" title="24"><span class="fu">    11bc:</span> 8d <span class="dv">50</span> <span class="dv">01</span>              <span class="bu">lea</span>    <span class="kw">edx</span>,[<span class="kw">rax</span>+<span class="bn">0x1</span>]</a>
<a class="sourceLine" id="cb88-25" title="25"><span class="fu">    11bf:</span> 0f be <span class="dv">45</span> f8           <span class="bu">movsx</span>  <span class="kw">eax</span>,<span class="dt">BYTE</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb88-26" title="26"><span class="fu">    11c3:</span> <span class="dv">83</span> c0 <span class="dv">02</span>              <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb88-27" title="27"><span class="fu">    11c6:</span> 0f af c2              <span class="bu">imul</span>   <span class="kw">eax</span>,<span class="kw">edx</span></a>
<a class="sourceLine" id="cb88-28" title="28"><span class="fu">    11c9:</span> 5d                    <span class="bu">pop</span>    <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb88-29" title="29"><span class="fu">    11ca:</span> c3                    <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The first parameters are copied into <code>RDI</code> and <code>ESI</code>.</li>
<li>The functions local stack is used to store the parameters, but aren’t part of the Sys V ABI. This is put in the red zone of the function stack.</li>
</ul>
<p>The stack frame of <code>funcchar</code>, referenced by <code>RBP</code>, looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RBP+8]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP]</code></td>
<td>Callers <code>RBP</code> preserved by the callee <code>funcchar</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP-4]</code></td>
<td><code>funcchar</code> Parameter 1, <code>char a</code> copied from <code>EDI</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP-8]</code></td>
<td><code>funcchar</code> Parameter 2, <code>char b</code> copied from <code>ESI</code></td>
</tr>
</tbody>
</table>
<h4 id="float-parameters-1"><span class="header-section-number">5.2.7.5</span> Float Parameters</h4>
<div class="sourceCode" id="cb89"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb89-1" title="1"><span class="dt">float</span> funcfloat(<span class="dt">float</span> a, <span class="dt">float</span> b, <span class="dt">float</span> c)</a>
<a class="sourceLine" id="cb89-2" title="2">{</a>
<a class="sourceLine" id="cb89-3" title="3">  <span class="cf">return</span> (a + <span class="fl">1.0</span>) * (b + <span class="fl">2.0</span>) * (c + <span class="fl">3.0</span>);</a>
<a class="sourceLine" id="cb89-4" title="4">}</a>
<a class="sourceLine" id="cb89-5" title="5"></a>
<a class="sourceLine" id="cb89-6" title="6"><span class="dt">int</span> test_funcfloat(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb89-7" title="7">{</a>
<a class="sourceLine" id="cb89-8" title="8">  <span class="dt">float</span> a;</a>
<a class="sourceLine" id="cb89-9" title="9">  a = funcfloat(<span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">3.0</span>) + <span class="fl">4.0</span>;</a>
<a class="sourceLine" id="cb89-10" title="10">  <span class="cf">return</span> (<span class="dt">int</span>)a;</a>
<a class="sourceLine" id="cb89-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb90"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb90-1" title="1"><span class="dv">0000000000001506</span> &lt;test_funcfloat&gt;:</a>
<a class="sourceLine" id="cb90-2" title="2"><span class="fu">    1506:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb90-3" title="3"><span class="fu">    150a:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb90-4" title="4"><span class="fu">    150b:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb90-5" title="5"><span class="fu">    150e:</span> <span class="dv">48</span> <span class="dv">83</span> ec <span class="dv">10</span>           <span class="bu">sub</span>    <span class="kw">rsp</span><span class="bn">,0x10</span></a>
<a class="sourceLine" id="cb90-6" title="6"><span class="fu">    1512:</span> f3 0f <span class="dv">10</span> <span class="dv">15</span> 0e<span class="bn"> 0b </span><span class="dv">00</span>  <span class="bu">movss</span>  <span class="kw">xmm2</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xb0e</span>]        # <span class="dv">2028</span> &lt;_IO_stdin_used+<span class="bn">0x28</span>&gt;</a>
<a class="sourceLine" id="cb90-7" title="7"><span class="fu">    1519:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb90-8" title="8"><span class="fu">    151a:</span> f3 0f <span class="dv">10</span> 0d 0a<span class="bn"> 0b </span><span class="dv">00</span>  <span class="bu">movss</span>  <span class="kw">xmm1</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xb0a</span>]        # 202c &lt;_IO_stdin_used+<span class="bn">0x2c</span>&gt;</a>
<a class="sourceLine" id="cb90-9" title="9"><span class="fu">    1521:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb90-10" title="10"><span class="fu">    1522:</span> f3 0f <span class="dv">10</span> <span class="dv">05</span> <span class="dv">06</span><span class="bn"> 0b </span><span class="dv">00</span>  <span class="bu">movss</span>  <span class="kw">xmm0</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xb06</span>]        # <span class="dv">2030</span> &lt;_IO_stdin_used+<span class="bn">0x30</span>&gt;</a>
<a class="sourceLine" id="cb90-11" title="11"><span class="fu">    1529:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb90-12" title="12"><span class="fu">    152a:</span> e8 9c fc ff ff        <span class="bu">call</span>   11cb &lt;funcfloat&gt;</a>
<a class="sourceLine" id="cb90-13" title="13"><span class="fu">    152f:</span> f3 0f <span class="dv">10</span> 0d fd 0a <span class="dv">00</span>  <span class="bu">movss</span>  <span class="kw">xmm1</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xafd</span>]        # <span class="dv">2034</span> &lt;_IO_stdin_used+<span class="bn">0x34</span>&gt;</a>
<a class="sourceLine" id="cb90-14" title="14"><span class="fu">    1536:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb90-15" title="15"><span class="fu">    1537:</span> f3 0f <span class="dv">58</span> c1           <span class="bu">addss</span>  <span class="kw">xmm0</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb90-16" title="16"><span class="fu">    153b:</span> f3 0f <span class="dv">11</span> <span class="dv">45</span> fc        <span class="bu">movss</span>  <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb90-17" title="17"><span class="fu">    1540:</span> f3 0f <span class="dv">10</span> <span class="dv">45</span> fc        <span class="bu">movss</span>  <span class="kw">xmm0</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb90-18" title="18"><span class="fu">    1545:</span> f3 0f 2c c0           <span class="bu">cvttss2si</span> <span class="kw">eax</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb90-19" title="19"><span class="fu">    1549:</span> c9                    <span class="bu">leave</span></a>
<a class="sourceLine" id="cb90-20" title="20"><span class="fu">    154a:</span> c3                    <span class="bu">ret</span></a>
<a class="sourceLine" id="cb90-21" title="21"></a>
<a class="sourceLine" id="cb90-22" title="22">00000000000011cb &lt;funcfloat&gt;:</a>
<a class="sourceLine" id="cb90-23" title="23"><span class="fu">    11cb:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb90-24" title="24"><span class="fu">    11cf:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb90-25" title="25"><span class="fu">    11d0:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb90-26" title="26"><span class="fu">    11d3:</span> f3 0f <span class="dv">11</span> <span class="dv">45</span> fc        <span class="bu">movss</span>  <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb90-27" title="27"><span class="fu">    11d8:</span> f3 0f <span class="dv">11</span> 4d f8        <span class="bu">movss</span>  <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>],<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb90-28" title="28"><span class="fu">    11dd:</span> f3 0f <span class="dv">11</span> <span class="dv">55</span> f4        <span class="bu">movss</span>  <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xc</span>],<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb90-29" title="29"><span class="fu">    11e2:</span> f3 0f 5a 4d fc        <span class="bu">cvtss2sd</span> <span class="kw">xmm1</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb90-30" title="30"><span class="fu">    11e7:</span> f2 0f <span class="dv">10</span> <span class="dv">05</span> <span class="dv">19</span> 0e <span class="dv">00</span>  <span class="bu">movsd</span>  <span class="kw">xmm0</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xe19</span>]        # <span class="dv">2008</span> &lt;_IO_stdin_used+<span class="bn">0x8</span>&gt;</a>
<a class="sourceLine" id="cb90-31" title="31"><span class="fu">    11ee:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb90-32" title="32"><span class="fu">    11ef:</span> f2 0f <span class="dv">58</span> c8           <span class="bu">addsd</span>  <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb90-33" title="33"><span class="fu">    11f3:</span> f3 0f 5a <span class="dv">55</span> f8        <span class="bu">cvtss2sd</span> <span class="kw">xmm2</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb90-34" title="34"><span class="fu">    11f8:</span> f2 0f <span class="dv">10</span> <span class="dv">05</span> <span class="dv">10</span> 0e <span class="dv">00</span>  <span class="bu">movsd</span>  <span class="kw">xmm0</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xe10</span>]        # <span class="dv">2010</span> &lt;_IO_stdin_used+<span class="bn">0x10</span>&gt;</a>
<a class="sourceLine" id="cb90-35" title="35"><span class="fu">    11ff:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb90-36" title="36"><span class="fu">    1200:</span> f2 0f <span class="dv">58</span> c2           <span class="bu">addsd</span>  <span class="kw">xmm0</span>,<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb90-37" title="37"><span class="fu">    1204:</span> f2 0f <span class="dv">59</span> c8           <span class="bu">mulsd</span>  <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb90-38" title="38"><span class="fu">    1208:</span> f3 0f 5a <span class="dv">55</span> f4        <span class="bu">cvtss2sd</span> <span class="kw">xmm2</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb90-39" title="39"><span class="fu">    120d:</span> f2 0f <span class="dv">10</span> <span class="dv">05</span> <span class="dv">03</span> 0e <span class="dv">00</span>  <span class="bu">movsd</span>  <span class="kw">xmm0</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xe03</span>]        # <span class="dv">2018</span> &lt;_IO_stdin_used+<span class="bn">0x18</span>&gt;</a>
<a class="sourceLine" id="cb90-40" title="40"><span class="fu">    1214:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb90-41" title="41"><span class="fu">    1215:</span> f2 0f <span class="dv">58</span> c2           <span class="bu">addsd</span>  <span class="kw">xmm0</span>,<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb90-42" title="42"><span class="fu">    1219:</span> f2 0f <span class="dv">59</span> c1           <span class="bu">mulsd</span>  <span class="kw">xmm0</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb90-43" title="43"><span class="fu">    121d:</span> f2 0f 5a c0           <span class="bu">cvtsd2ss</span> <span class="kw">xmm0</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb90-44" title="44"><span class="fu">    1221:</span> 5d                    <span class="bu">pop</span>    <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb90-45" title="45"><span class="fu">    1222:</span> c3                    <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The parameters are passed into <code>XMM0</code>-<code>XMM2</code>.</li>
<li>The result is returned to the caller in <code>XMM0</code>.</li>
<li>The functions local stack is used to store the parameters, but aren’t part of the Sys V ABI. This is put in the red zone of the function stack.</li>
<li>The constants are stored in memory as a QWORD and copied into register, and the parameters are promoted to a double in this code.</li>
</ul>
<p>The stack frame of <code>funcfloat</code>, referenced by <code>RBP</code>, looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RBP+8]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP]</code></td>
<td>Callers <code>RBP</code> preserved by the callee <code>funcfloat</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP-4]</code></td>
<td><code>funcfloat</code> Parameter 1, <code>float a</code> copied from <code>XMM0</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP-8]</code></td>
<td><code>funcfloat</code> Parameter 2, <code>float b</code> copied from <code>XMM1</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RPB-12]</code></td>
<td><code>funcfloat</code> Parameter 3, <code>float c</code> copied from <code>XMM2</code></td>
</tr>
</tbody>
</table>
<h4 id="mixed-float-and-integer-parameters-1"><span class="header-section-number">5.2.7.6</span> Mixed Float and Integer Parameters</h4>
<div class="sourceCode" id="cb91"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb91-1" title="1"><span class="dt">int</span> funcfloatint(<span class="dt">int</span> a, <span class="dt">float</span> b, <span class="dt">int</span> c, <span class="dt">float</span> d)</a>
<a class="sourceLine" id="cb91-2" title="2">{</a>
<a class="sourceLine" id="cb91-3" title="3">  <span class="cf">return</span> (a + <span class="dv">1</span>) * (b + <span class="fl">2.0</span>) * (c + <span class="dv">3</span>) * (d + <span class="fl">4.0</span>);</a>
<a class="sourceLine" id="cb91-4" title="4">}</a>
<a class="sourceLine" id="cb91-5" title="5"></a>
<a class="sourceLine" id="cb91-6" title="6"><span class="dt">int</span> test_funcfloatint(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb91-7" title="7">{</a>
<a class="sourceLine" id="cb91-8" title="8">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb91-9" title="9">  a = funcfloatint(<span class="dv">1</span>, <span class="fl">2.0</span>, <span class="dv">3</span>, <span class="fl">4.0</span>) + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb91-10" title="10">  <span class="cf">return</span> a;</a>
<a class="sourceLine" id="cb91-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb92"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb92-1" title="1">000000000000154b &lt;test_funcfloatint&gt;:</a>
<a class="sourceLine" id="cb92-2" title="2"><span class="fu">    154b:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb92-3" title="3"><span class="fu">    154f:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb92-4" title="4"><span class="fu">    1550:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb92-5" title="5"><span class="fu">    1553:</span> <span class="dv">48</span> <span class="dv">83</span> ec <span class="dv">10</span>           <span class="bu">sub</span>    <span class="kw">rsp</span><span class="bn">,0x10</span></a>
<a class="sourceLine" id="cb92-6" title="6"><span class="fu">    1557:</span> f3 0f <span class="dv">10</span> 0d d5 0a <span class="dv">00</span>  <span class="bu">movss</span>  <span class="kw">xmm1</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xad5</span>]        # <span class="dv">2034</span> &lt;_IO_stdin_used+<span class="bn">0x34</span>&gt;</a>
<a class="sourceLine" id="cb92-7" title="7"><span class="fu">    155e:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb92-8" title="8"><span class="fu">    155f:</span> be <span class="dv">03</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>        <span class="bu">mov</span>    <span class="kw">esi</span><span class="bn">,0x3</span></a>
<a class="sourceLine" id="cb92-9" title="9"><span class="fu">    1564:</span> f3 0f <span class="dv">10</span> <span class="dv">05</span> c0 0a <span class="dv">00</span>  <span class="bu">movss</span>  <span class="kw">xmm0</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xac0</span>]        # 202c &lt;_IO_stdin_used+<span class="bn">0x2c</span>&gt;</a>
<a class="sourceLine" id="cb92-10" title="10"><span class="fu">    156b:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb92-11" title="11"><span class="fu">    156c:</span> bf <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>        <span class="bu">mov</span>    <span class="kw">edi</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb92-12" title="12"><span class="fu">    1571:</span> e8 ad fc ff ff        <span class="bu">call</span>   <span class="dv">1223</span> &lt;funcfloatint&gt;</a>
<a class="sourceLine" id="cb92-13" title="13"><span class="fu">    1576:</span> <span class="dv">83</span> c0 <span class="dv">01</span>              <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb92-14" title="14"><span class="fu">    1579:</span> <span class="dv">89</span> <span class="dv">45</span> fc              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb92-15" title="15"><span class="fu">    157c:</span> 8b <span class="dv">45</span> fc              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb92-16" title="16"><span class="fu">    157f:</span> c9                    <span class="bu">leave</span></a>
<a class="sourceLine" id="cb92-17" title="17"><span class="fu">    1580:</span> c3                    <span class="bu">ret</span></a>
<a class="sourceLine" id="cb92-18" title="18"></a>
<a class="sourceLine" id="cb92-19" title="19"><span class="dv">0000000000001223</span> &lt;funcfloatint&gt;:</a>
<a class="sourceLine" id="cb92-20" title="20"><span class="fu">    1223:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb92-21" title="21"><span class="fu">    1227:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb92-22" title="22"><span class="fu">    1228:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb92-23" title="23"><span class="fu">    122b:</span> <span class="dv">89</span> 7d fc              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>],<span class="kw">edi</span></a>
<a class="sourceLine" id="cb92-24" title="24"><span class="fu">    122e:</span> f3 0f <span class="dv">11</span> <span class="dv">45</span> f8        <span class="bu">movss</span>  <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb92-25" title="25"><span class="fu">    1233:</span> <span class="dv">89</span> <span class="dv">75</span> f4              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xc</span>],<span class="kw">esi</span></a>
<a class="sourceLine" id="cb92-26" title="26"><span class="fu">    1236:</span> f3 0f <span class="dv">11</span> 4d f0        <span class="bu">movss</span>  <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x10</span>],<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb92-27" title="27"><span class="fu">    123b:</span> 8b <span class="dv">45</span> fc              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb92-28" title="28"><span class="fu">    123e:</span> <span class="dv">83</span> c0 <span class="dv">01</span>              <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb92-29" title="29"><span class="fu">    1241:</span> f2 0f 2a c8           <span class="bu">cvtsi2sd</span> <span class="kw">xmm1</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb92-30" title="30"><span class="fu">    1245:</span> f3 0f 5a <span class="dv">55</span> f8        <span class="bu">cvtss2sd</span> <span class="kw">xmm2</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb92-31" title="31"><span class="fu">    124a:</span> f2 0f <span class="dv">10</span> <span class="dv">05</span> be 0d <span class="dv">00</span>  <span class="bu">movsd</span>  <span class="kw">xmm0</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xdbe</span>]        # <span class="dv">2010</span> &lt;_IO_stdin_used+<span class="bn">0x10</span>&gt;</a>
<a class="sourceLine" id="cb92-32" title="32"><span class="fu">    1251:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb92-33" title="33"><span class="fu">    1252:</span> f2 0f <span class="dv">58</span> c2           <span class="bu">addsd</span>  <span class="kw">xmm0</span>,<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb92-34" title="34"><span class="fu">    1256:</span> f2 0f <span class="dv">59</span> c8           <span class="bu">mulsd</span>  <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb92-35" title="35"><span class="fu">    125a:</span> 8b <span class="dv">45</span> f4              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xc</span>]</a>
<a class="sourceLine" id="cb92-36" title="36"><span class="fu">    125d:</span> <span class="dv">83</span> c0 <span class="dv">03</span>              <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x3</span></a>
<a class="sourceLine" id="cb92-37" title="37"><span class="fu">    1260:</span> f2 0f 2a c0           <span class="bu">cvtsi2sd</span> <span class="kw">xmm0</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb92-38" title="38"><span class="fu">    1264:</span> f2 0f <span class="dv">59</span> c8           <span class="bu">mulsd</span>  <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb92-39" title="39"><span class="fu">    1268:</span> f3 0f 5a <span class="dv">55</span> f0        <span class="bu">cvtss2sd</span> <span class="kw">xmm2</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x10</span>]</a>
<a class="sourceLine" id="cb92-40" title="40"><span class="fu">    126d:</span> f2 0f <span class="dv">10</span> <span class="dv">05</span> ab 0d <span class="dv">00</span>  <span class="bu">movsd</span>  <span class="kw">xmm0</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xdab</span>]        # <span class="dv">2020</span> &lt;_IO_stdin_used+<span class="bn">0x20</span>&gt;</a>
<a class="sourceLine" id="cb92-41" title="41"><span class="fu">    1274:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb92-42" title="42"><span class="fu">    1275:</span> f2 0f <span class="dv">58</span> c2           <span class="bu">addsd</span>  <span class="kw">xmm0</span>,<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb92-43" title="43"><span class="fu">    1279:</span> f2 0f <span class="dv">59</span> c1           <span class="bu">mulsd</span>  <span class="kw">xmm0</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb92-44" title="44"><span class="fu">    127d:</span> f2 0f 2c c0           <span class="bu">cvttsd2si</span> <span class="kw">eax</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb92-45" title="45"><span class="fu">    1281:</span> 5d                    <span class="bu">pop</span>    <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb92-46" title="46"><span class="fu">    1282:</span> c3                    <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The parameters are passed into <code>XMM0</code>-<code>XMM1</code>, <code>ESI</code>, <code>EDI</code>.</li>
<li>The result is returned to the caller in <code>EAX</code>.</li>
<li>The functions local stack is used to store the parameters, but aren’t part of the Sys V ABI. This is put in the red zone of the function stack.</li>
<li>The constants are stored in memory as a QWORD and copied into register, and the parameters are promoted to a double in this code.</li>
</ul>
<p>The stack frame of <code>funcfloatint</code>, referenced by <code>RBP</code>, looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RBP+8]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP]</code></td>
<td>Callers <code>RBP</code> preserved by the callee <code>funcfloatint</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP-4]</code></td>
<td><code>funcfloatint</code> Parameter 1, <code>int a</code> copied from <code>EDI</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP-8]</code></td>
<td><code>funcfloatint</code> Parameter 2, <code>float b</code> copied from <code>XMM0</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RPB-12]</code></td>
<td><code>funcfloatint</code> Parameter 3, <code>int c</code> copied from <code>ESI</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP-16]</code></td>
<td><code>funcfloatint</code> Parameter 4, <code>float c</code> copied from <code>XMM1</code></td>
</tr>
</tbody>
</table>
<h4 id="double-parameters-1"><span class="header-section-number">5.2.7.7</span> Double Parameters</h4>
<div class="sourceCode" id="cb93"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb93-1" title="1"><span class="dt">double</span> funcdouble(<span class="dt">double</span> a, <span class="dt">double</span> b)</a>
<a class="sourceLine" id="cb93-2" title="2">{</a>
<a class="sourceLine" id="cb93-3" title="3">  <span class="cf">return</span> (a + <span class="dv">2</span>) * (b + <span class="dv">4</span>);</a>
<a class="sourceLine" id="cb93-4" title="4">}</a>
<a class="sourceLine" id="cb93-5" title="5"></a>
<a class="sourceLine" id="cb93-6" title="6"><span class="dt">int</span> test_funcdouble(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb93-7" title="7">{</a>
<a class="sourceLine" id="cb93-8" title="8">  <span class="dt">double</span> a;</a>
<a class="sourceLine" id="cb93-9" title="9">  a = funcdouble(<span class="fl">2.0</span>, <span class="fl">4.0</span>) + <span class="fl">1.0</span>;</a>
<a class="sourceLine" id="cb93-10" title="10">  <span class="cf">return</span> (<span class="dt">int</span>)a;</a>
<a class="sourceLine" id="cb93-11" title="11">}</a></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb94-1" title="1"><span class="dv">0000000000001581</span> &lt;test_funcdouble&gt;:</a>
<a class="sourceLine" id="cb94-2" title="2"><span class="fu">    1581:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb94-3" title="3"><span class="fu">    1585:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb94-4" title="4"><span class="fu">    1586:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb94-5" title="5"><span class="fu">    1589:</span> <span class="dv">48</span> <span class="dv">83</span> ec <span class="dv">10</span>           <span class="bu">sub</span>    <span class="kw">rsp</span><span class="bn">,0x10</span></a>
<a class="sourceLine" id="cb94-6" title="6"><span class="fu">    158d:</span> f2 0f <span class="dv">10</span> <span class="dv">05</span> a3 0a <span class="dv">00</span>  <span class="bu">movsd</span>  <span class="kw">xmm0</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xaa3</span>]        # <span class="dv">2038</span> &lt;_IO_stdin_used+<span class="bn">0x38</span>&gt;</a>
<a class="sourceLine" id="cb94-7" title="7"><span class="fu">    1594:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb94-8" title="8"><span class="fu">    1595:</span> <span class="dv">48</span> 8b <span class="dv">05</span> a4 0a <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="kw">rax</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xaa4</span>]        # <span class="dv">2040</span> &lt;_IO_stdin_used+<span class="bn">0x40</span>&gt;</a>
<a class="sourceLine" id="cb94-9" title="9"><span class="fu">    159c:</span> <span class="dv">66</span> 0f <span class="dv">28</span> c8           <span class="bu">movapd</span> <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb94-10" title="10"><span class="fu">    15a0:</span> <span class="dv">66</span> <span class="dv">48</span> 0f 6e c0        <span class="bu">movq</span>   <span class="kw">xmm0</span>,<span class="kw">rax</span></a>
<a class="sourceLine" id="cb94-11" title="11"><span class="fu">    15a5:</span> e8 d9 fc ff ff        <span class="bu">call</span>   <span class="dv">1283</span> &lt;funcdouble&gt;</a>
<a class="sourceLine" id="cb94-12" title="12"><span class="fu">    15aa:</span> f2 0f <span class="dv">10</span> 0d <span class="dv">96</span> 0a <span class="dv">00</span>  <span class="bu">movsd</span>  <span class="kw">xmm1</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xa96</span>]        # <span class="dv">2048</span> &lt;_IO_stdin_used+<span class="bn">0x48</span>&gt;</a>
<a class="sourceLine" id="cb94-13" title="13"><span class="fu">    15b1:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb94-14" title="14"><span class="fu">    15b2:</span> f2 0f <span class="dv">58</span> c1           <span class="bu">addsd</span>  <span class="kw">xmm0</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb94-15" title="15"><span class="fu">    15b6:</span> f2 0f <span class="dv">11</span> <span class="dv">45</span> f8        <span class="bu">movsd</span>  <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb94-16" title="16"><span class="fu">    15bb:</span> f2 0f <span class="dv">10</span> <span class="dv">45</span> f8        <span class="bu">movsd</span>  <span class="kw">xmm0</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb94-17" title="17"><span class="fu">    15c0:</span> f2 0f 2c c0           <span class="bu">cvttsd2si</span> <span class="kw">eax</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb94-18" title="18"><span class="fu">    15c4:</span> c9                    <span class="bu">leave</span></a>
<a class="sourceLine" id="cb94-19" title="19"><span class="fu">    15c5:</span> c3                    <span class="bu">ret</span></a>
<a class="sourceLine" id="cb94-20" title="20"></a>
<a class="sourceLine" id="cb94-21" title="21"><span class="dv">0000000000001283</span> &lt;funcdouble&gt;:</a>
<a class="sourceLine" id="cb94-22" title="22"><span class="fu">    1283:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb94-23" title="23"><span class="fu">    1287:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb94-24" title="24"><span class="fu">    1288:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb94-25" title="25"><span class="fu">    128b:</span> f2 0f <span class="dv">11</span> <span class="dv">45</span> f8        <span class="bu">movsd</span>  <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb94-26" title="26"><span class="fu">    1290:</span> f2 0f <span class="dv">11</span> 4d f0        <span class="bu">movsd</span>  <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x10</span>],<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb94-27" title="27"><span class="fu">    1295:</span> f2 0f <span class="dv">10</span> 4d f8        <span class="bu">movsd</span>  <span class="kw">xmm1</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb94-28" title="28"><span class="fu">    129a:</span> f2 0f <span class="dv">10</span> <span class="dv">05</span> 6e 0d <span class="dv">00</span>  <span class="bu">movsd</span>  <span class="kw">xmm0</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xd6e</span>]        # <span class="dv">2010</span> &lt;_IO_stdin_used+<span class="bn">0x10</span>&gt;</a>
<a class="sourceLine" id="cb94-29" title="29"><span class="fu">    12a1:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb94-30" title="30"><span class="fu">    12a2:</span> f2 0f <span class="dv">58</span> c8           <span class="bu">addsd</span>  <span class="kw">xmm1</span>,<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb94-31" title="31"><span class="fu">    12a6:</span> f2 0f <span class="dv">10</span> <span class="dv">55</span> f0        <span class="bu">movsd</span>  <span class="kw">xmm2</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x10</span>]</a>
<a class="sourceLine" id="cb94-32" title="32"><span class="fu">    12ab:</span> f2 0f <span class="dv">10</span> <span class="dv">05</span> 6d 0d <span class="dv">00</span>  <span class="bu">movsd</span>  <span class="kw">xmm0</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [rip+<span class="bn">0xd6d</span>]        # <span class="dv">2020</span> &lt;_IO_stdin_used+<span class="bn">0x20</span>&gt;</a>
<a class="sourceLine" id="cb94-33" title="33"><span class="fu">    12b2:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb94-34" title="34"><span class="fu">    12b3:</span> f2 0f <span class="dv">58</span> c2           <span class="bu">addsd</span>  <span class="kw">xmm0</span>,<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb94-35" title="35"><span class="fu">    12b7:</span> f2 0f <span class="dv">59</span> c1           <span class="bu">mulsd</span>  <span class="kw">xmm0</span>,<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb94-36" title="36"><span class="fu">    12bb:</span> 5d                    <span class="bu">pop</span>    <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb94-37" title="37"><span class="fu">    12bc:</span> c3                    <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The parameters are passed into <code>XMM0</code>-<code>XMM1</code>.</li>
<li>The result is returned to the caller in <code>EAX</code>.</li>
<li>The functions local stack is used to store the parameters, but aren’t part of the Sys V ABI. This is put in the red zone of the function stack.</li>
</ul>
<p>The stack frame of <code>funcdouble</code>, referenced by <code>RBP</code>, looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RBP+8]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP]</code></td>
<td>Callers <code>RBP</code> preserved by the callee <code>funcdouble</code></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP-8]</code></td>
<td><code>funcdouble</code> Parameter 1, <code>double a</code> copied from <code>XMM0</code></td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP-16]</code></td>
<td><code>funcdouble</code> Parameter 2, <code>double b</code> copied from <code>XMM1</code></td>
</tr>
</tbody>
</table>
<h4 id="passing-a-struct-by-value-1"><span class="header-section-number">5.2.7.8</span> Passing a Struct by Value</h4>
<div class="sourceCode" id="cb95"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb95-1" title="1"><span class="kw">struct</span> mystruct {</a>
<a class="sourceLine" id="cb95-2" title="2">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb95-3" title="3">  <span class="dt">int</span> b;</a>
<a class="sourceLine" id="cb95-4" title="4">  <span class="dt">int</span> c;</a>
<a class="sourceLine" id="cb95-5" title="5">  <span class="dt">int</span> d;</a>
<a class="sourceLine" id="cb95-6" title="6">  <span class="dt">int</span> e;</a>
<a class="sourceLine" id="cb95-7" title="7">  <span class="dt">int</span> f;</a>
<a class="sourceLine" id="cb95-8" title="8">};</a>
<a class="sourceLine" id="cb95-9" title="9"></a>
<a class="sourceLine" id="cb95-10" title="10"><span class="dt">int</span> funcstructvalue(<span class="kw">struct</span> mystruct x, <span class="kw">struct</span> mystruct *y)</a>
<a class="sourceLine" id="cb95-11" title="11">{</a>
<a class="sourceLine" id="cb95-12" title="12">  <span class="cf">return</span> x.a + y-&gt;b;</a>
<a class="sourceLine" id="cb95-13" title="13">}</a>
<a class="sourceLine" id="cb95-14" title="14"></a>
<a class="sourceLine" id="cb95-15" title="15"><span class="dt">int</span> test_funcstructvalue(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb95-16" title="16">{</a>
<a class="sourceLine" id="cb95-17" title="17">  <span class="kw">struct</span> mystruct x = {<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>};</a>
<a class="sourceLine" id="cb95-18" title="18">  <span class="kw">struct</span> mystruct y = {<span class="dv">0</span>, };</a>
<a class="sourceLine" id="cb95-19" title="19"></a>
<a class="sourceLine" id="cb95-20" title="20">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb95-21" title="21">  a = funcstructvalue(x, &amp;y) + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb95-22" title="22">  <span class="cf">return</span> a;</a>
<a class="sourceLine" id="cb95-23" title="23">}</a></code></pre></div>
<div class="sourceCode" id="cb96"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb96-1" title="1">00000000000015c6 &lt;test_funcstructvalue&gt;:</a>
<a class="sourceLine" id="cb96-2" title="2"><span class="fu">    15c6:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb96-3" title="3"><span class="fu">    15ca:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb96-4" title="4"><span class="fu">    15cb:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb96-5" title="5"><span class="fu">    15ce:</span> <span class="dv">48</span> <span class="dv">83</span> ec <span class="dv">50</span>           <span class="bu">sub</span>    <span class="kw">rsp</span><span class="bn">,0x50</span></a>
<a class="sourceLine" id="cb96-6" title="6"><span class="fu">    15d2:</span> <span class="dv">64</span> <span class="dv">48</span> 8b <span class="dv">04</span> <span class="dv">25</span> <span class="dv">28</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="kw">rax</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">fs</span>:<span class="bn">0x28</span></a>
<a class="sourceLine" id="cb96-7" title="7"><span class="fu">    15d9:</span> <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb96-8" title="8"><span class="fu">    15db:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">45</span> f8           <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb96-9" title="9"><span class="fu">    15df:</span> <span class="dv">31</span> c0                 <span class="bu">xor</span>    <span class="kw">eax</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb96-10" title="10"><span class="fu">    15e1:</span> c7 <span class="dv">45</span> c0 <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x40</span>]<span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb96-11" title="11"><span class="fu">    15e8:</span> c7 <span class="dv">45</span> c4 <span class="dv">02</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x3c</span>]<span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb96-12" title="12"><span class="fu">    15ef:</span> c7 <span class="dv">45</span> c8 <span class="dv">03</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x38</span>]<span class="bn">,0x3</span></a>
<a class="sourceLine" id="cb96-13" title="13"><span class="fu">    15f6:</span> c7 <span class="dv">45</span> cc <span class="dv">04</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x34</span>]<span class="bn">,0x4</span></a>
<a class="sourceLine" id="cb96-14" title="14"><span class="fu">    15fd:</span> c7 <span class="dv">45</span> d0 <span class="dv">05</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x30</span>]<span class="bn">,0x5</span></a>
<a class="sourceLine" id="cb96-15" title="15"><span class="fu">    1604:</span> c7 <span class="dv">45</span> d4 <span class="dv">06</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x2c</span>]<span class="bn">,0x6</span></a>
<a class="sourceLine" id="cb96-16" title="16"><span class="fu">    160b:</span> <span class="dv">48</span> c7 <span class="dv">45</span> e0 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x20</span>]<span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb96-17" title="17"><span class="fu">    1612:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb96-18" title="18"><span class="fu">    1613:</span> <span class="dv">48</span> c7 <span class="dv">45</span> e8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x18</span>]<span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb96-19" title="19"><span class="fu">    161a:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb96-20" title="20"><span class="fu">    161b:</span> <span class="dv">48</span> c7 <span class="dv">45</span> f0 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x10</span>]<span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb96-21" title="21"><span class="fu">    1622:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb96-22" title="22"><span class="fu">    1623:</span> <span class="dv">48</span> 8d <span class="dv">45</span> e0           <span class="bu">lea</span>    <span class="kw">rax</span>,[<span class="kw">rbp</span><span class="bn">-0x20</span>]</a>
<a class="sourceLine" id="cb96-23" title="23"><span class="fu">    1627:</span> <span class="dv">48</span> <span class="dv">83</span> ec <span class="dv">08</span>           <span class="bu">sub</span>    <span class="kw">rsp</span><span class="bn">,0x8</span></a>
<a class="sourceLine" id="cb96-24" title="24"><span class="fu">    162b:</span> ff <span class="dv">75</span> d0              <span class="bu">push</span>   <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x30</span>]</a>
<a class="sourceLine" id="cb96-25" title="25"><span class="fu">    162e:</span> ff <span class="dv">75</span> c8              <span class="bu">push</span>   <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x38</span>]</a>
<a class="sourceLine" id="cb96-26" title="26"><span class="fu">    1631:</span> ff <span class="dv">75</span> c0              <span class="bu">push</span>   <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x40</span>]</a>
<a class="sourceLine" id="cb96-27" title="27"><span class="fu">    1634:</span> <span class="dv">48</span> <span class="dv">89</span> c7              <span class="bu">mov</span>    <span class="kw">rdi</span>,<span class="kw">rax</span></a>
<a class="sourceLine" id="cb96-28" title="28"><span class="fu">    1637:</span> e8 <span class="dv">81</span> fc ff ff        <span class="bu">call</span>   12bd &lt;funcstructvalue&gt;</a>
<a class="sourceLine" id="cb96-29" title="29"><span class="fu">    163c:</span> <span class="dv">48</span> <span class="dv">83</span> c4 <span class="dv">20</span>           <span class="bu">add</span>    <span class="kw">rsp</span><span class="bn">,0x20</span></a>
<a class="sourceLine" id="cb96-30" title="30"><span class="fu">    1640:</span> <span class="dv">83</span> c0 <span class="dv">01</span>              <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb96-31" title="31"><span class="fu">    1643:</span> <span class="dv">89</span> <span class="dv">45</span> bc              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x44</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb96-32" title="32"><span class="fu">    1646:</span> 8b <span class="dv">45</span> bc              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x44</span>]</a>
<a class="sourceLine" id="cb96-33" title="33"><span class="fu">    1649:</span> <span class="dv">48</span> 8b <span class="dv">55</span> f8           <span class="bu">mov</span>    <span class="kw">rdx</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb96-34" title="34"><span class="fu">    164d:</span> <span class="dv">64</span> <span class="dv">48</span> <span class="dv">33</span> <span class="dv">14</span> <span class="dv">25</span> <span class="dv">28</span> <span class="dv">00</span>  <span class="bu">xor</span>    <span class="kw">rdx</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">fs</span>:<span class="bn">0x28</span></a>
<a class="sourceLine" id="cb96-35" title="35"><span class="fu">    1654:</span> <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb96-36" title="36"><span class="fu">    1656:</span> <span class="dv">74</span> <span class="dv">05</span>                 <span class="bu">je</span>     165d &lt;test_funcstructvalue+<span class="bn">0x97</span>&gt;</a>
<a class="sourceLine" id="cb96-37" title="37"><span class="fu">    1658:</span> e8 f3 f9 ff ff        <span class="bu">call</span>   <span class="dv">1050</span> &lt;__stack_chk_fail@plt&gt;</a>
<a class="sourceLine" id="cb96-38" title="38"><span class="fu">    165d:</span> c9                    <span class="bu">leave</span></a>
<a class="sourceLine" id="cb96-39" title="39"><span class="fu">    165e:</span> c3                    <span class="bu">ret</span></a>
<a class="sourceLine" id="cb96-40" title="40"></a>
<a class="sourceLine" id="cb96-41" title="41">00000000000012bd &lt;funcstructvalue&gt;:</a>
<a class="sourceLine" id="cb96-42" title="42"><span class="fu">    12bd:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb96-43" title="43"><span class="fu">    12c1:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb96-44" title="44"><span class="fu">    12c2:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb96-45" title="45"><span class="fu">    12c5:</span> <span class="dv">48</span> <span class="dv">89</span> 7d f8           <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>],<span class="kw">rdi</span></a>
<a class="sourceLine" id="cb96-46" title="46"><span class="fu">    12c9:</span> 8b <span class="dv">55</span> <span class="dv">10</span>              <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span>+<span class="bn">0x10</span>]</a>
<a class="sourceLine" id="cb96-47" title="47"><span class="fu">    12cc:</span> <span class="dv">48</span> 8b <span class="dv">45</span> f8           <span class="bu">mov</span>    <span class="kw">rax</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb96-48" title="48"><span class="fu">    12d0:</span> 8b <span class="dv">40</span> <span class="dv">04</span>              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rax</span>+<span class="bn">0x4</span>]</a>
<a class="sourceLine" id="cb96-49" title="49"><span class="fu">    12d3:</span> <span class="dv">01</span> d0                 <span class="bu">add</span>    <span class="kw">eax</span>,<span class="kw">edx</span></a>
<a class="sourceLine" id="cb96-50" title="50"><span class="fu">    12d5:</span> 5d                    <span class="bu">pop</span>    <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb96-51" title="51"><span class="fu">    12d6:</span> c3                    <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The stack frame uses memory arguments to pass the struct x by value.</li>
<li>The caller moves the memory to the stack, and then adjusts the stack pointer, instead of an explicit push, but it has the same effect in memory.</li>
</ul>
<p>The stack frame of <code>funcstructvalue</code>, referenced by <code>RBP</code>, looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RBP+128]</code></td>
<td>RBP</td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP+120]</code></td>
<td>FS:0x28 stack guard</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP+112]</code></td>
<td>y.e = y.f = 0</td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP+104]</code></td>
<td>y.c = y.d = 0</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP+96]</code></td>
<td>y.a = y.b = 0</td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP+88]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP+84]</code></td>
<td>x.f = 6</td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP+80]</code></td>
<td>x.e = 5</td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP+76]</code></td>
<td>x.d = 4</td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP+72]</code></td>
<td>x.c = 3</td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP+68]</code></td>
<td>x.b = 2</td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP+64]</code></td>
<td>x.a = 1</td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP+60]</code></td>
<td>int a</td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP+56]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP+48]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP+40]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP+36]</code></td>
<td>x.f = 6</td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP+32]</code></td>
<td>x.e = 5</td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP+28]</code></td>
<td>x.d = 4</td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP+24]</code></td>
<td>x.c = 3</td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP+20]</code></td>
<td>x.b = 2</td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP+16]</code></td>
<td>Parameter 1, x.a = 1</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP+8]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP]</code></td>
<td>Callers <code>RBP</code> preserved by the callee <code>funcstructvalue</code></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP-8]</code></td>
<td>Pointer <code>*y</code></td>
</tr>
</tbody>
</table>
<p>Observations</p>
<ul>
<li>The pointer to <code>struct y</code> is put in <code>RAX</code> on line <code>1623</code>, which is then put into <code>RDI</code> for the first parameter on line <code>1634</code>.</li>
<li>The <code>struct x</code> is copied from the stack of <code>test_funcstructvalue</code> to the stack for <code>funcstructvalue</code> from <code>RBP</code> + 16 to <code>RBP</code> + 40.</li>
<li>We see that the <code>y-&gt;b</code> is accessed <code>RBP</code> + 100.</li>
<li>The caller at address <code>163c</code> clears the parameter stack of 32 bytes.</li>
</ul>
<p>It’s interesting to see the usage of the <code>FS</code> selector register. From <a href="https://stackoverflow.com/questions/10325713/why-does-this-memory-address-fs0x28-fs0x28-have-a-random-value">Stack Overflow</a>, this is described as</p>
<blockquote>
<p>Specifically what’s taking place, is that <code>FS:0x28</code> on Linux is storing a special sentinel stack-guard value, and the code is performing a stack-guard check. For instance, if you look further in your code, you’ll see that the value at <code>FS:0x28</code> is stored on the stack, and then the contents of the stack are recalled and an XOR is performed with the original value at <code>FS:0x28</code>. If the two values are equal, which means that the zero-bit has been set because <code>XOR</code>’ing two of the same values results in a zero-value, then we jump to the test routine, otherwise we jump to a special function that indicates that the stack was somehow corrupted, and the sentinel value stored on the stack was changed.</p>
</blockquote>
<p>This can be disabled with <code>-fno-stack-protector</code>.</p>
<h4 id="returning-a-struct-by-value-1"><span class="header-section-number">5.2.7.9</span> Returning a Struct by Value</h4>
<div class="sourceCode" id="cb97"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb97-1" title="1"><span class="kw">struct</span> mystruct {</a>
<a class="sourceLine" id="cb97-2" title="2">  <span class="dt">int</span> a;</a>
<a class="sourceLine" id="cb97-3" title="3">  <span class="dt">int</span> b;</a>
<a class="sourceLine" id="cb97-4" title="4">  <span class="dt">int</span> c;</a>
<a class="sourceLine" id="cb97-5" title="5">  <span class="dt">int</span> d;</a>
<a class="sourceLine" id="cb97-6" title="6">  <span class="dt">int</span> e;</a>
<a class="sourceLine" id="cb97-7" title="7">  <span class="dt">int</span> f;</a>
<a class="sourceLine" id="cb97-8" title="8">};</a>
<a class="sourceLine" id="cb97-9" title="9"></a>
<a class="sourceLine" id="cb97-10" title="10"><span class="kw">struct</span> mystruct funcstructret(<span class="dt">int</span> a, <span class="dt">int</span> b)</a>
<a class="sourceLine" id="cb97-11" title="11">{</a>
<a class="sourceLine" id="cb97-12" title="12">  <span class="kw">struct</span> mystruct r = {<span class="dv">0</span>, };</a>
<a class="sourceLine" id="cb97-13" title="13">  r.a = a;</a>
<a class="sourceLine" id="cb97-14" title="14">  r.b = b;</a>
<a class="sourceLine" id="cb97-15" title="15">  <span class="cf">return</span> r;</a>
<a class="sourceLine" id="cb97-16" title="16">}</a>
<a class="sourceLine" id="cb97-17" title="17"></a>
<a class="sourceLine" id="cb97-18" title="18"><span class="dt">int</span> test_funcstructret(<span class="dt">void</span>)</a>
<a class="sourceLine" id="cb97-19" title="19">{</a>
<a class="sourceLine" id="cb97-20" title="20">  <span class="kw">struct</span> mystruct x;</a>
<a class="sourceLine" id="cb97-21" title="21">  x = funcstructret(<span class="dv">1</span>, <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb97-22" title="22">  <span class="cf">return</span> x.a;</a>
<a class="sourceLine" id="cb97-23" title="23">}</a></code></pre></div>
<div class="sourceCode" id="cb98"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb98-1" title="1">000000000000165f &lt;test_funcstructret&gt;:</a>
<a class="sourceLine" id="cb98-2" title="2"><span class="fu">    165f:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb98-3" title="3"><span class="fu">    1663:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb98-4" title="4"><span class="fu">    1664:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb98-5" title="5"><span class="fu">    1667:</span> <span class="dv">48</span> <span class="dv">83</span> ec <span class="dv">20</span>           <span class="bu">sub</span>    <span class="kw">rsp</span><span class="bn">,0x20</span></a>
<a class="sourceLine" id="cb98-6" title="6"><span class="fu">    166b:</span> <span class="dv">64</span> <span class="dv">48</span> 8b <span class="dv">04</span> <span class="dv">25</span> <span class="dv">28</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="kw">rax</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">fs</span>:<span class="bn">0x28</span></a>
<a class="sourceLine" id="cb98-7" title="7"><span class="fu">    1672:</span> <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb98-8" title="8"><span class="fu">    1674:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">45</span> f8           <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb98-9" title="9"><span class="fu">    1678:</span> <span class="dv">31</span> c0                 <span class="bu">xor</span>    <span class="kw">eax</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb98-10" title="10"><span class="fu">    167a:</span> <span class="dv">48</span> 8d <span class="dv">45</span> e0           <span class="bu">lea</span>    <span class="kw">rax</span>,[<span class="kw">rbp</span><span class="bn">-0x20</span>]</a>
<a class="sourceLine" id="cb98-11" title="11"><span class="fu">    167e:</span> ba <span class="dv">02</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>        <span class="bu">mov</span>    <span class="kw">edx</span><span class="bn">,0x2</span></a>
<a class="sourceLine" id="cb98-12" title="12"><span class="fu">    1683:</span> be <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>        <span class="bu">mov</span>    <span class="kw">esi</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb98-13" title="13"><span class="fu">    1688:</span> <span class="dv">48</span> <span class="dv">89</span> c7              <span class="bu">mov</span>    <span class="kw">rdi</span>,<span class="kw">rax</span></a>
<a class="sourceLine" id="cb98-14" title="14"><span class="fu">    168b:</span> e8 <span class="dv">47</span> fc ff ff        <span class="bu">call</span>   12d7 &lt;funcstructret&gt;</a>
<a class="sourceLine" id="cb98-15" title="15"><span class="fu">    1690:</span> 8b <span class="dv">45</span> e0              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x20</span>]</a>
<a class="sourceLine" id="cb98-16" title="16"><span class="fu">    1693:</span> <span class="dv">48</span> 8b 4d f8           <span class="bu">mov</span>    <span class="kw">rcx</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x8</span>]</a>
<a class="sourceLine" id="cb98-17" title="17"><span class="fu">    1697:</span> <span class="dv">64</span> <span class="dv">48</span> <span class="dv">33</span> 0c <span class="dv">25</span> <span class="dv">28</span> <span class="dv">00</span>  <span class="bu">xor</span>    <span class="kw">rcx</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">fs</span>:<span class="bn">0x28</span></a>
<a class="sourceLine" id="cb98-18" title="18"><span class="fu">    169e:</span> <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb98-19" title="19"><span class="fu">    16a0:</span> <span class="dv">74</span> <span class="dv">05</span>                 <span class="bu">je</span>     16a7 &lt;test_funcstructret+<span class="bn">0x48</span>&gt;</a>
<a class="sourceLine" id="cb98-20" title="20"><span class="fu">    16a2:</span> e8 a9 f9 ff ff        <span class="bu">call</span>   <span class="dv">1050</span> &lt;__stack_chk_fail@plt&gt;</a>
<a class="sourceLine" id="cb98-21" title="21"><span class="fu">    16a7:</span> c9                    <span class="bu">leave</span></a>
<a class="sourceLine" id="cb98-22" title="22"><span class="fu">    16a8:</span> c3                    <span class="bu">ret</span></a>
<a class="sourceLine" id="cb98-23" title="23"></a>
<a class="sourceLine" id="cb98-24" title="24">00000000000012d7 &lt;funcstructret&gt;:</a>
<a class="sourceLine" id="cb98-25" title="25"><span class="fu">    12d7:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb98-26" title="26"><span class="fu">    12db:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb98-27" title="27"><span class="fu">    12dc:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb98-28" title="28"><span class="fu">    12df:</span> <span class="dv">48</span> <span class="dv">89</span> 7d d8           <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x28</span>],<span class="kw">rdi</span></a>
<a class="sourceLine" id="cb98-29" title="29"><span class="fu">    12e3:</span> <span class="dv">89</span> <span class="dv">75</span> d4              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x2c</span>],<span class="kw">esi</span></a>
<a class="sourceLine" id="cb98-30" title="30"><span class="fu">    12e6:</span> <span class="dv">89</span> <span class="dv">55</span> d0              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x30</span>],<span class="kw">edx</span></a>
<a class="sourceLine" id="cb98-31" title="31"><span class="fu">    12e9:</span> <span class="dv">48</span> c7 <span class="dv">45</span> e0 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x20</span>]<span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb98-32" title="32"><span class="fu">    12f0:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb98-33" title="33"><span class="fu">    12f1:</span> <span class="dv">48</span> c7 <span class="dv">45</span> e8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x18</span>]<span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb98-34" title="34"><span class="fu">    12f8:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb98-35" title="35"><span class="fu">    12f9:</span> <span class="dv">48</span> c7 <span class="dv">45</span> f0 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x10</span>]<span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb98-36" title="36"><span class="fu">    1300:</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb98-37" title="37"><span class="fu">    1301:</span> 8b <span class="dv">45</span> d4              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x2c</span>]</a>
<a class="sourceLine" id="cb98-38" title="38"><span class="fu">    1304:</span> <span class="dv">89</span> <span class="dv">45</span> e0              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x20</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb98-39" title="39"><span class="fu">    1307:</span> 8b <span class="dv">45</span> d0              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x30</span>]</a>
<a class="sourceLine" id="cb98-40" title="40"><span class="fu">    130a:</span> <span class="dv">89</span> <span class="dv">45</span> e4              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x1c</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb98-41" title="41"><span class="fu">    130d:</span> <span class="dv">48</span> 8b 4d d8           <span class="bu">mov</span>    <span class="kw">rcx</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x28</span>]</a>
<a class="sourceLine" id="cb98-42" title="42"><span class="fu">    1311:</span> <span class="dv">48</span> 8b <span class="dv">45</span> e0           <span class="bu">mov</span>    <span class="kw">rax</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x20</span>]</a>
<a class="sourceLine" id="cb98-43" title="43"><span class="fu">    1315:</span> <span class="dv">48</span> 8b <span class="dv">55</span> e8           <span class="bu">mov</span>    <span class="kw">rdx</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x18</span>]</a>
<a class="sourceLine" id="cb98-44" title="44"><span class="fu">    1319:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">01</span>              <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rcx</span>],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb98-45" title="45"><span class="fu">    131c:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">51</span> <span class="dv">08</span>           <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rcx</span>+<span class="bn">0x8</span>],<span class="kw">rdx</span></a>
<a class="sourceLine" id="cb98-46" title="46"><span class="fu">    1320:</span> <span class="dv">48</span> 8b <span class="dv">45</span> f0           <span class="bu">mov</span>    <span class="kw">rax</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x10</span>]</a>
<a class="sourceLine" id="cb98-47" title="47"><span class="fu">    1324:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">41</span> <span class="dv">10</span>           <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rcx</span>+<span class="bn">0x10</span>],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb98-48" title="48"><span class="fu">    1328:</span> <span class="dv">48</span> 8b <span class="dv">45</span> d8           <span class="bu">mov</span>    <span class="kw">rax</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x28</span>]</a>
<a class="sourceLine" id="cb98-49" title="49"><span class="fu">    132c:</span> 5d                    <span class="bu">pop</span>    <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb98-50" title="50"><span class="fu">    132d:</span> c3                    <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>The first parameter is the pointer to the return struct, so that <code>funcstructret</code> copies the structure into the address pointed to by <code>RDI</code>. This is memory allocated on the stack of the function <code>funcstructret</code>.</li>
<li>The first and second parameter are passed as though they are the second and third parameters of the function call in <code>ESI</code> and <code>EDX</code>.</li>
<li>The local copy <code>mystruct r</code> is updated, and then at the end of the function, it is copied into the first parameter, which is the pointer.</li>
<li>This shows that it is certainly more efficient to pass the pointer <code>mystruct x</code> to <code>funcstructret</code> and let it write directly into the result, than the indirect way of writing to the local stack, and then writing to the stack of the caller.</li>
</ul>
<p>The stack frame of <code>funcstructret</code>, referenced by <code>RBP</code>, looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RBP+48]</code></td>
<td><code>RBP</code></td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP+40]</code></td>
<td>FS:0x28 stack guard</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP+32]</code></td>
<td><code>struct mystruct x</code></td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP+24]</code></td>
<td><code>struct mystruct x</code></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP+16]</code></td>
<td><code>struct mystruct x</code></td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP+8]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP]</code></td>
<td>Callers <code>RBP</code> preserved by the callee <code>funcvarargs</code></td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP-8]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP-16]</code></td>
<td><code>struct mystruct r</code>, 0x00</td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP-24]</code></td>
<td><code>struct mystruct r</code>, 0x00</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP-32]</code></td>
<td><code>struct mystruct r</code>, 0x00</td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP-40]</code></td>
<td>pointer to return value in caller’s stack <code>RBP+16</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP-44]</code></td>
<td><code>int a</code>, Parameter 1.</td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP-48]</code></td>
<td><code>int b</code>, Parameter 2.</td>
</tr>
</tbody>
</table>
<h4 id="varargs-1"><span class="header-section-number">5.2.7.10</span> VarArgs</h4>
<div class="sourceCode" id="cb99"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb99-1" title="1"><span class="dt">int</span> funcvarargs(<span class="dt">int</span> cnt, ...)</a>
<a class="sourceLine" id="cb99-2" title="2">{</a>
<a class="sourceLine" id="cb99-3" title="3">  <span class="dt">va_list</span> argptr;</a>
<a class="sourceLine" id="cb99-4" title="4">  va_start(argptr, cnt);</a>
<a class="sourceLine" id="cb99-5" title="5">  <span class="dt">int</span> i, j = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb99-6" title="6"></a>
<a class="sourceLine" id="cb99-7" title="7">  <span class="cf">for</span> (i = <span class="dv">0</span>; i &lt; cnt; i++) j += va_arg(argptr, <span class="dt">int</span>);</a>
<a class="sourceLine" id="cb99-8" title="8">  <span class="cf">return</span> j;</a>
<a class="sourceLine" id="cb99-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode asm"><code class="sourceCode fasm"><a class="sourceLine" id="cb100-1" title="1">00000000000016a9 &lt;test_funcvarargs1&gt;:</a>
<a class="sourceLine" id="cb100-2" title="2"><span class="fu">    16a9:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb100-3" title="3"><span class="fu">    16ad:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb100-4" title="4"><span class="fu">    16ae:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb100-5" title="5"><span class="fu">    16b1:</span> <span class="dv">48</span> <span class="dv">83</span> ec <span class="dv">10</span>           <span class="bu">sub</span>    <span class="kw">rsp</span><span class="bn">,0x10</span></a>
<a class="sourceLine" id="cb100-6" title="6"><span class="fu">    16b5:</span> bf <span class="dv">01</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>        <span class="bu">mov</span>    <span class="kw">edi</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb100-7" title="7"><span class="fu">    16ba:</span> b8 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>        <span class="bu">mov</span>    <span class="kw">eax</span><span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb100-8" title="8"><span class="fu">    16bf:</span> e8 6a fc ff ff        <span class="bu">call</span>   132e &lt;funcvarargs&gt;</a>
<a class="sourceLine" id="cb100-9" title="9"><span class="fu">    16c4:</span> <span class="dv">83</span> c0 <span class="dv">01</span>              <span class="bu">add</span>    <span class="kw">eax</span><span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb100-10" title="10"><span class="fu">    16c7:</span> <span class="dv">89</span> <span class="dv">45</span> fc              <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb100-11" title="11"><span class="fu">    16ca:</span> 8b <span class="dv">45</span> fc              <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x4</span>]</a>
<a class="sourceLine" id="cb100-12" title="12"><span class="fu">    16cd:</span> c9                    <span class="bu">leave</span></a>
<a class="sourceLine" id="cb100-13" title="13"><span class="fu">    16ce:</span> c3                    <span class="bu">ret</span></a>
<a class="sourceLine" id="cb100-14" title="14"></a>
<a class="sourceLine" id="cb100-15" title="15">000000000000132e &lt;funcvarargs&gt;:</a>
<a class="sourceLine" id="cb100-16" title="16"><span class="fu">    132e:</span> f3 0f 1e fa           endbr64</a>
<a class="sourceLine" id="cb100-17" title="17"><span class="fu">    1332:</span> <span class="dv">55</span>                    <span class="bu">push</span>   <span class="kw">rbp</span></a>
<a class="sourceLine" id="cb100-18" title="18"><span class="fu">    1333:</span> <span class="dv">48</span> <span class="dv">89</span> e5              <span class="bu">mov</span>    <span class="kw">rbp</span>,<span class="kw">rsp</span></a>
<a class="sourceLine" id="cb100-19" title="19"><span class="fu">    1336:</span> <span class="dv">48</span> <span class="dv">81</span> ec f0 <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span>  <span class="bu">sub</span>    <span class="kw">rsp</span>,<span class="bn">0xf0</span></a>
<a class="sourceLine" id="cb100-20" title="20"><span class="fu">    133d:</span> <span class="dv">89</span> bd 1c ff ff ff     <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xe4</span>],<span class="kw">edi</span></a>
<a class="sourceLine" id="cb100-21" title="21"><span class="fu">    1343:</span> <span class="dv">48</span> <span class="dv">89</span> b5 <span class="dv">58</span> ff ff ff  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xa8</span>],<span class="kw">rsi</span></a>
<a class="sourceLine" id="cb100-22" title="22"><span class="fu">    134a:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">95</span> <span class="dv">60</span> ff ff ff  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xa0</span>],<span class="kw">rdx</span></a>
<a class="sourceLine" id="cb100-23" title="23"><span class="fu">    1351:</span> <span class="dv">48</span> <span class="dv">89</span> 8d <span class="dv">68</span> ff ff ff  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x98</span>],<span class="kw">rcx</span></a>
<a class="sourceLine" id="cb100-24" title="24"><span class="fu">    1358:</span> 4c <span class="dv">89</span> <span class="dv">85</span> <span class="dv">70</span> ff ff ff  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x90</span>],<span class="kw">r8</span></a>
<a class="sourceLine" id="cb100-25" title="25"><span class="fu">    135f:</span> 4c <span class="dv">89</span> 8d <span class="dv">78</span> ff ff ff  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x88</span>],<span class="kw">r9</span></a>
<a class="sourceLine" id="cb100-26" title="26"><span class="fu">    1366:</span> <span class="dv">84</span> c0                 <span class="bu">test</span>   <span class="kw">al</span>,<span class="kw">al</span></a>
<a class="sourceLine" id="cb100-27" title="27"><span class="fu">    1368:</span> <span class="dv">74</span> <span class="dv">20</span>                 <span class="bu">je</span>     138a &lt;funcvarargs+<span class="bn">0x5c</span>&gt;</a>
<a class="sourceLine" id="cb100-28" title="28"><span class="fu">    136a:</span> 0f <span class="dv">29</span> <span class="dv">45</span> <span class="dv">80</span>           <span class="bu">movaps</span> XMMWORD <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x80</span>],<span class="kw">xmm0</span></a>
<a class="sourceLine" id="cb100-29" title="29"><span class="fu">    136e:</span> 0f <span class="dv">29</span> 4d <span class="dv">90</span>           <span class="bu">movaps</span> XMMWORD <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x70</span>],<span class="kw">xmm1</span></a>
<a class="sourceLine" id="cb100-30" title="30"><span class="fu">    1372:</span> 0f <span class="dv">29</span> <span class="dv">55</span> a0           <span class="bu">movaps</span> XMMWORD <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x60</span>],<span class="kw">xmm2</span></a>
<a class="sourceLine" id="cb100-31" title="31"><span class="fu">    1376:</span> 0f <span class="dv">29</span> 5d b0           <span class="bu">movaps</span> XMMWORD <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x50</span>],<span class="kw">xmm3</span></a>
<a class="sourceLine" id="cb100-32" title="32"><span class="fu">    137a:</span> 0f <span class="dv">29</span> <span class="dv">65</span> c0           <span class="bu">movaps</span> XMMWORD <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x40</span>],<span class="kw">xmm4</span></a>
<a class="sourceLine" id="cb100-33" title="33"><span class="fu">    137e:</span> 0f <span class="dv">29</span> 6d d0           <span class="bu">movaps</span> XMMWORD <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x30</span>],<span class="kw">xmm5</span></a>
<a class="sourceLine" id="cb100-34" title="34"><span class="fu">    1382:</span> 0f <span class="dv">29</span> <span class="dv">75</span> e0           <span class="bu">movaps</span> XMMWORD <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x20</span>],<span class="kw">xmm6</span></a>
<a class="sourceLine" id="cb100-35" title="35"><span class="fu">    1386:</span> 0f <span class="dv">29</span> 7d f0           <span class="bu">movaps</span> XMMWORD <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0x10</span>],<span class="kw">xmm7</span></a>
<a class="sourceLine" id="cb100-36" title="36"><span class="fu">    138a:</span> <span class="dv">64</span> <span class="dv">48</span> 8b <span class="dv">04</span> <span class="dv">25</span> <span class="dv">28</span> <span class="dv">00</span>  <span class="bu">mov</span>    <span class="kw">rax</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">fs</span>:<span class="bn">0x28</span></a>
<a class="sourceLine" id="cb100-37" title="37"><span class="fu">    1391:</span> <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb100-38" title="38"><span class="fu">    1393:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">85</span> <span class="dv">48</span> ff ff ff  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xb8</span>],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb100-39" title="39"><span class="fu">    139a:</span> <span class="dv">31</span> c0                 <span class="bu">xor</span>    <span class="kw">eax</span>,<span class="kw">eax</span></a>
<a class="sourceLine" id="cb100-40" title="40"><span class="fu">    139c:</span> c7 <span class="dv">85</span> <span class="dv">30</span> ff ff ff <span class="dv">08</span>  <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xd0</span>]<span class="bn">,0x8</span></a>
<a class="sourceLine" id="cb100-41" title="41"><span class="fu">    13a3:</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb100-42" title="42"><span class="fu">    13a6:</span> c7 <span class="dv">85</span> <span class="dv">34</span> ff ff ff <span class="dv">30</span>  <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xcc</span>]<span class="bn">,0x30</span></a>
<a class="sourceLine" id="cb100-43" title="43"><span class="fu">    13ad:</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb100-44" title="44"><span class="fu">    13b0:</span> <span class="dv">48</span> 8d <span class="dv">45</span> <span class="dv">10</span>           <span class="bu">lea</span>    <span class="kw">rax</span>,[<span class="kw">rbp</span>+<span class="bn">0x10</span>]</a>
<a class="sourceLine" id="cb100-45" title="45"><span class="fu">    13b4:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">85</span> <span class="dv">38</span> ff ff ff  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xc8</span>],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb100-46" title="46"><span class="fu">    13bb:</span> <span class="dv">48</span> 8d <span class="dv">85</span> <span class="dv">50</span> ff ff ff  <span class="bu">lea</span>    <span class="kw">rax</span>,[<span class="kw">rbp</span><span class="bn">-0xb0</span>]</a>
<a class="sourceLine" id="cb100-47" title="47"><span class="fu">    13c2:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">85</span> <span class="dv">40</span> ff ff ff  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xc0</span>],<span class="kw">rax</span></a>
<a class="sourceLine" id="cb100-48" title="48"><span class="fu">    13c9:</span> c7 <span class="dv">85</span> 2c ff ff ff <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xd4</span>]<span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb100-49" title="49"><span class="fu">    13d0:</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb100-50" title="50"><span class="fu">    13d3:</span> c7 <span class="dv">85</span> <span class="dv">28</span> ff ff ff <span class="dv">00</span>  <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xd8</span>]<span class="bn">,0x0</span></a>
<a class="sourceLine" id="cb100-51" title="51"><span class="fu">    13da:</span> <span class="dv">00</span> <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb100-52" title="52"><span class="fu">    13dd:</span> eb 4f                 <span class="bu">jmp</span>    142e &lt;funcvarargs+<span class="bn">0x100</span>&gt;</a>
<a class="sourceLine" id="cb100-53" title="53"><span class="fu">    13df:</span> 8b <span class="dv">85</span> <span class="dv">30</span> ff ff ff     <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xd0</span>]</a>
<a class="sourceLine" id="cb100-54" title="54"><span class="fu">    13e5:</span> <span class="dv">83</span> f8 2f              <span class="bu">cmp</span>    <span class="kw">eax</span><span class="bn">,0x2f</span></a>
<a class="sourceLine" id="cb100-55" title="55"><span class="fu">    13e8:</span> <span class="dv">77</span> <span class="dv">23</span>                 <span class="bu">ja</span>     140d &lt;funcvarargs+<span class="bn">0xdf</span>&gt;</a>
<a class="sourceLine" id="cb100-56" title="56"><span class="fu">    13ea:</span> <span class="dv">48</span> 8b <span class="dv">85</span> <span class="dv">40</span> ff ff ff  <span class="bu">mov</span>    <span class="kw">rax</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xc0</span>]</a>
<a class="sourceLine" id="cb100-57" title="57"><span class="fu">    13f1:</span> 8b <span class="dv">95</span> <span class="dv">30</span> ff ff ff     <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xd0</span>]</a>
<a class="sourceLine" id="cb100-58" title="58"><span class="fu">    13f7:</span> <span class="dv">89</span> d2                 <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="kw">edx</span></a>
<a class="sourceLine" id="cb100-59" title="59"><span class="fu">    13f9:</span> <span class="dv">48</span> <span class="dv">01</span> d0              <span class="bu">add</span>    <span class="kw">rax</span>,<span class="kw">rdx</span></a>
<a class="sourceLine" id="cb100-60" title="60"><span class="fu">    13fc:</span> 8b <span class="dv">95</span> <span class="dv">30</span> ff ff ff     <span class="bu">mov</span>    <span class="kw">edx</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xd0</span>]</a>
<a class="sourceLine" id="cb100-61" title="61"><span class="fu">    1402:</span> <span class="dv">83</span> c2 <span class="dv">08</span>              <span class="bu">add</span>    <span class="kw">edx</span><span class="bn">,0x8</span></a>
<a class="sourceLine" id="cb100-62" title="62"><span class="fu">    1405:</span> <span class="dv">89</span> <span class="dv">95</span> <span class="dv">30</span> ff ff ff     <span class="bu">mov</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xd0</span>],<span class="kw">edx</span></a>
<a class="sourceLine" id="cb100-63" title="63"><span class="fu">    140b:</span> eb <span class="dv">12</span>                 <span class="bu">jmp</span>    141f &lt;funcvarargs+<span class="bn">0xf1</span>&gt;</a>
<a class="sourceLine" id="cb100-64" title="64"><span class="fu">    140d:</span> <span class="dv">48</span> 8b <span class="dv">85</span> <span class="dv">38</span> ff ff ff  <span class="bu">mov</span>    <span class="kw">rax</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xc8</span>]</a>
<a class="sourceLine" id="cb100-65" title="65"><span class="fu">    1414:</span> <span class="dv">48</span> 8d <span class="dv">50</span> <span class="dv">08</span>           <span class="bu">lea</span>    <span class="kw">rdx</span>,[<span class="kw">rax</span>+<span class="bn">0x8</span>]</a>
<a class="sourceLine" id="cb100-66" title="66"><span class="fu">    1418:</span> <span class="dv">48</span> <span class="dv">89</span> <span class="dv">95</span> <span class="dv">38</span> ff ff ff  <span class="bu">mov</span>    <span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xc8</span>],<span class="kw">rdx</span></a>
<a class="sourceLine" id="cb100-67" title="67"><span class="fu">    141f:</span> 8b <span class="dv">00</span>                 <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rax</span>]</a>
<a class="sourceLine" id="cb100-68" title="68"><span class="fu">    1421:</span> <span class="dv">01</span> <span class="dv">85</span> 2c ff ff ff     <span class="bu">add</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xd4</span>],<span class="kw">eax</span></a>
<a class="sourceLine" id="cb100-69" title="69"><span class="fu">    1427:</span> <span class="dv">83</span> <span class="dv">85</span> <span class="dv">28</span> ff ff ff <span class="dv">01</span>  <span class="bu">add</span>    <span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xd8</span>]<span class="bn">,0x1</span></a>
<a class="sourceLine" id="cb100-70" title="70"><span class="fu">    142e:</span> 8b <span class="dv">85</span> <span class="dv">28</span> ff ff ff     <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xd8</span>]</a>
<a class="sourceLine" id="cb100-71" title="71"><span class="fu">    1434:</span> 3b <span class="dv">85</span> 1c ff ff ff     <span class="bu">cmp</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xe4</span>]</a>
<a class="sourceLine" id="cb100-72" title="72"><span class="fu">    143a:</span> 7c a3                 <span class="bu">jl</span>     13df &lt;funcvarargs+<span class="bn">0xb1</span>&gt;</a>
<a class="sourceLine" id="cb100-73" title="73"><span class="fu">    143c:</span> 8b <span class="dv">85</span> 2c ff ff ff     <span class="bu">mov</span>    <span class="kw">eax</span>,<span class="dt">DWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xd4</span>]</a>
<a class="sourceLine" id="cb100-74" title="74"><span class="fu">    1442:</span> <span class="dv">48</span> 8b 8d <span class="dv">48</span> ff ff ff  <span class="bu">mov</span>    <span class="kw">rcx</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> [<span class="kw">rbp</span><span class="bn">-0xb8</span>]</a>
<a class="sourceLine" id="cb100-75" title="75"><span class="fu">    1449:</span> <span class="dv">64</span> <span class="dv">48</span> <span class="dv">33</span> 0c <span class="dv">25</span> <span class="dv">28</span> <span class="dv">00</span>  <span class="bu">xor</span>    <span class="kw">rcx</span>,<span class="dt">QWORD</span> <span class="dt">PTR</span> <span class="kw">fs</span>:<span class="bn">0x28</span></a>
<a class="sourceLine" id="cb100-76" title="76"><span class="fu">    1450:</span> <span class="dv">00</span> <span class="dv">00</span></a>
<a class="sourceLine" id="cb100-77" title="77"><span class="fu">    1452:</span> <span class="dv">74</span> <span class="dv">05</span>                 <span class="bu">je</span>     <span class="dv">1459</span> &lt;funcvarargs+<span class="bn">0x12b</span>&gt;</a>
<a class="sourceLine" id="cb100-78" title="78"><span class="fu">    1454:</span> e8 f7 fb ff ff        <span class="bu">call</span>   <span class="dv">1050</span> &lt;__stack_chk_fail@plt&gt;</a>
<a class="sourceLine" id="cb100-79" title="79"><span class="fu">    1459:</span> c9                    <span class="bu">leave</span></a>
<a class="sourceLine" id="cb100-80" title="80"><span class="fu">    145a:</span> c3                    <span class="bu">ret</span></a></code></pre></div>
<p>Observations</p>
<ul>
<li>We see that line <code>1366</code> tests the number of vector registers (SSE) that are used (<code>XMM0</code>-<code>XMM7</code>), and if it’s not zero, then all registers are pushed on the stack.</li>
<li>The code is much larger than for the 32-bit case, as the <code>va_list</code> either points to an array of saved registers, or to the callers stack. The ABI section 3.5.7 describes the data structure and algorithm in detail. This is because the code needs to push the register values on the stack locally, or use the callers stack, as needed.</li>
<li>The register save area for this decompiled code is 176 bytes. The Sys V ABI defines 288 bytes, which this implementation doesn’t use <code>XMM8</code>-<code>XMM15</code>. Adding 8 registers * 16 bytes to 176 gives 288 bytes.</li>
<li>Don’t use <code>varargs</code> if it can be avoided for high performance code.</li>
</ul>
<p>The stack frame of <code>funcvarargs</code>, referenced by <code>RBP</code>, looks like</p>
<table>
<thead>
<tr class="header">
<th>Offset</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>qword ptr [RBP+32]</code></td>
<td><code>RBP</code></td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP+24]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP+16]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP+8]</code></td>
<td>Callers <code>RIP</code> return address</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP]</code></td>
<td>Callers <code>RBP</code> preserved by the callee <code>funcvarargs</code></td>
</tr>
<tr class="even">
<td><code>oword ptr [RBP-16]</code></td>
<td><code>XMM7</code></td>
</tr>
<tr class="odd">
<td><code>oword ptr [RBP-32]</code></td>
<td><code>XMM6</code></td>
</tr>
<tr class="even">
<td><code>oword ptr [RBP-48]</code></td>
<td><code>XMM5</code></td>
</tr>
<tr class="odd">
<td><code>oword ptr [RBP-64]</code></td>
<td><code>XMM4</code></td>
</tr>
<tr class="even">
<td><code>oword ptr [RBP-80]</code></td>
<td><code>XMM3</code></td>
</tr>
<tr class="odd">
<td><code>oword ptr [RBP-96]</code></td>
<td><code>XMM2</code></td>
</tr>
<tr class="even">
<td><code>oword ptr [RBP-112]</code></td>
<td><code>XMM1</code></td>
</tr>
<tr class="odd">
<td><code>oword ptr [RBP-128]</code></td>
<td><code>XMM0</code></td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP-136]</code></td>
<td><code>R9</code></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP-144]</code></td>
<td><code>R8</code></td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP-152]</code></td>
<td><code>RCX</code></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP-160]</code></td>
<td><code>RDX</code></td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP-168]</code></td>
<td><code>RSI</code></td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP-176]</code></td>
<td>empty (defined as <code>RDI</code>)</td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP-184]</code></td>
<td>FS:0x28 stack guard</td>
</tr>
<tr class="odd">
<td><code>qword ptr [RBP-192]</code></td>
<td><code>va_list.reg_save_area</code>, initialized to <code>RBP-176</code></td>
</tr>
<tr class="even">
<td><code>qword ptr [RBP-200]</code></td>
<td><code>va_list.overflow_arg_area</code>, initialized to <code>RBP+16</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP-204]</code></td>
<td><code>va_list.fp_offset</code> of 48 bytes offset to <code>RBP-128</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP-208]</code></td>
<td><code>va_list.gp_offset</code> of 8 bytes offset to <code>RBP-168</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP-212]</code></td>
<td><code>int j</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP-216]</code></td>
<td><code>int i</code></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP-220]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP-224]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP-228]</code></td>
<td><code>int cnt</code>, from <code>RDI</code></td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP-232]</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>dword ptr [RBP-236]</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dword ptr [RBP-240]</code></td>
<td>RSP points here</td>
</tr>
</tbody>
</table>
</body>
</html>
